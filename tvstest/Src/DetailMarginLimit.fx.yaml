DetailMarginLimit As screen:
    Fill: =RGBA(248, 248, 249, 1)
    OnHidden: |-
        =Set(isLoadingCompletedML, false);
        Set(submitEvent, 0);
        Set(saveEvent, 0);
    OnVisible: |+
        =UpdateContext({ShowNotification: false});
        Set(isLoadingCompletedML, false);
        If(!("VIEW" in LookUp(currenUserV2.permissionList, process_code = "Process4", action) && currenUserV2.status = "ACTIVE"), Select(ButtonMR));
        Set(isLoading, true);
        
        // set data table
        Set(dataDefault, [{
            id: "",
            record_id: "5ac4269d-c356-4bfb-9d4c-9edf5741f6cf",
            ticker: "",
            max_margin_ratio_cp: "",
            max_margined_amt_per_client_cp: "",
            max_margined_amt_all_client_cp: "",
            proposed_margin_ratio: "",
            proposed_margined_loan_amt_per_client: "",
            proposed_margined_loan_amt_all_client: "",
            research_opinion: "",
            proposed_margin_ratio_re: "",
            proposed_margined_loan_amt_per_client_re: "",
            proposed_margined_loan_amt_all_client_re: "",
            comment_re: "",
            risk_management_opinion: "",
            proposed_margin_ratio_rm: "",
            proposed_margined_loan_amt_per_client_rm: "",
            proposed_margined_loan_amt_all_client_rm: "",
            proposed_margined_qty_all_client_rm: "",
            proposed_margined_qty_one_client_rm: "",
            comment_rm: ""
          }]);
        Set(dataRecordTable, dataDefault);
        // end set data table
        
        // set type
        Set(typeOneClient, marginType = "One Client");
        Set(typeOneStock, marginType = "One Stock");
        Set(typeManyStock, marginType <> "One Stock" && marginType <> "One Client");
        // end set type
        
        // call api
        Concurrent(
            Set(equityAmountFormatted, 'TVS->FindCurrentEquityProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close,envDEV,envTEST,envUAT1,envUAT2).equity),
            If(!typeOneClient, ClearCollect(PolicyList1, 'TVS->GetCurrentPolicyList'.Run(resKeyOpenAll.open, resKeyOpenAll.close,envDEV,envTEST,envUAT1,envUAT2).listCurrentPolicy)),
            If(!typeOneClient, ClearCollect(unTradingList,'TVS->GetCurrentUnTradingList'.Run(resKeyOpenAll.open, resKeyOpenAll.close,envDEV,envTEST,envUAT1,envUAT2).listUnTrading)),
            If(!IsBlank(First(marginDetail1.proposal).id),
            ClearCollect(approvelLog, 'TVS->GetApprovalLogProcess4'.Run(First(marginDetail1.proposal).id, envDEV, envTEST, envUAT1, envUAT2, resKeyOpenAll.open, resKeyOpenAll.close))
        ));
        
        //marginDetail.status
        Set(statusRecord, marginDetail.status);
        //Set InStep
        Switch(statusRecord,
        Blank(),
        Set(inStepTable, "BrokerageProposal"),
        "DRAFT",
        Set(inStepTable, "BrokerageProposal"),
        "PENDING_RESEARCHS_OPINION",
        Set(inStepTable, "ResearchOpinion"),
        "PENDING_RISK_MANAGERMENTS_OPINION",
        Set(inStepTable, "RiskManagementOpinion"),
        Set(inStepTable, "ApproveTheProposal")
        );
        
        Set(isLoadingCompletedML, true);
        // end call api
        
        Set(isSubmited, false);
        If(!("VIEW" in LookUp(currenUserV2.permissionList, process_code = "Process4", action) && currenUserV2.status = "ACTIVE"), Select(Button2_MR));
        Set(resSaveProposal, Blank());
        Set(DealDetailTab, 1);
        Set(isSubmited, false);
        Set(submitEvent, 0);
        Set(saveEvent, 0);
        //Clear(MarginLimitPolicyList);
        Reset(MarginRatioCheckbox);
        Reset(MarginedAmtPerClientCheckbox);
        Reset(MarginedAmtAllClientCheckbox);
        Reset(Cmt_Input);
        Reset(PIR_Input);
        Reset(PML_Input);
        Reset(SendTo_input);
        Reset(Subject_inpt);
        Reset(AttachFile_6);
        Reset(AttachFile_5);
        Set(numbericMaxMlInput, Blank());
        Set(numbericProposalMlLabel, Blank());
        Set(numbericProposalInterestRateInput, Blank());
        Set(numbericPMlInput, Blank());
        Set(MenuSelect,"Business process");
        Set(MenuSelect2,"Margin Limit Approval Process");
        Set(HeaderText,If(IsBlank(marginDetail), "Create", btnApprove_2.Visible, "Approve", (SaveButton_4.Visible || btnSubmit_2.Visible), "Update", ""));
        
        If(IsBlank(marginDetail1), Set(oneClientRMOption, Blank()), Set(oneClientRMOption,  First(marginDetail1.brokerage).risk_management_opinion));
        ClearCollect(listTabMargin,[{text: "Proposal Information", tab: 1},{text: "Approval Logs", tab: 3}]);
        Clear(listPolicyEmail);
        If(marginDetail.status in ["PENDING_UPDATE_CHANGES", "APPROVED"] && !typeOneClient, Set(DealDetailTab, 2);
            ForAll(marginDetail1.brokerage,
            Collect(ticketList,{ticket:ThisRecord.ticker});
            Collect(listPolicyEmail, {guid:GUID(),stock_no:ThisRecord.ticker,
                market: ThisRecord.market_cp,
                be_margin_ratio: ThisRecord.max_margin_ratio_cp,
                be_qty_per_client: ThisRecord.max_margined_qty_per_client_cp,
                be_qty_all_client: ThisRecord.max_margined_qty_all_client_cp,
                be_loan_per_client: ThisRecord.max_margined_amt_per_client_cp,
                be_loan_all_client: ThisRecord.max_margined_amt_all_client_cp,
                af_margin_ratio: ThisRecord.proposed_margin_ratio_rm,
                af_qty_per_client: ThisRecord.proposed_margined_qty_one_client_rm,
                af_qty_all_client: ThisRecord.proposed_margined_qty_all_client_rm,
                af_loan_per_client: ThisRecord.proposed_margined_loan_amt_per_client_rm,
                af_loan_all_client : ThisRecord.proposed_margined_loan_amt_all_client_rm,
                id: ThisRecord.id
            }));
        );
        
        If(CountRows(marginDetail1.updateChange) > 0 && marginDetail.status = "APPROVED",
        ForAll(marginDetail1.updateChange As item,
        UpdateIf(listPolicyEmail As item2, item.b_id = item2.id, 
            {af_margin_ratio: item.after_margin_ratio, 
            af_qty_per_client: item.after_quantity_per_client,
            af_qty_all_client: item.after_quantity_all_client,
            af_loan_per_client: item.after_loan_per_client, 
            af_loan_all_client: item.after_loan_all_client});
        ));
        
        
        // check permission
        Set(isRiskManager, "RISK_MANAGER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action));
        Set(isResearchCreate, "RESEARCH_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action));
        Set(isBrokerage, "BROKER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action));
        Set(isCEO, "CEO_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action));
        Set(isVice, "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action));
        Set(isUpdateChange, "RISK_MANAGER_SENIOR" in LookUp(currenUserV2.permissionList,process_code = "Process4",action));
        Set(isDetailRecord, !IsBlank(marginDetail));
        Set(showProgress, false );
        Set(IndexML, 0);
        Set(ratioShowDropdown, false);
        // end check permission
        
        // check disable
        Set(isDisableTable, !(marginDetail.status in ["DRAFT", "PENDING_RISK_MANAGERMENTS_OPINION", "PENDING_RESEARCHS_OPINION"] || IsBlank(marginDetail.status)));
        // end-check disable
        
        Set(resCreateProposal, Blank());
        Set(proposalInfoEdit, {proposal_status: "DRAFT", proposal_old_status: "DRAFT"});
        Set(marginLimitType, If(IsBlank(marginDetail), marginLimitType, marginDetail.type_of_proposal));
        Set(isShowApprove, false );
        
        Set(isShowSubmitButton, true);
        Set(isShowSaveButton, true);
        Set(isShowDeleteButton, false);
        Set(isShowApproveButton, false);
        Set(isShowRejectButton, true);
        Set(isShowReviseButton, false);
        Set(numberText, "1,000,000");
        
        // variable
        Set(billion, 1000000000);
        Set(dataDetailMr, First(marginDetail1.brokerage));
        // one client
        Set(valueProposedMarginLimitAmount, Value(dataDetailMr.proposed_margin_limit_amount));
        // one client - br > 4ty nhung -rm <= 4 ty
        Set(valueProposedMarginLimitAmountRm, Value(dataDetailMr.proposed_margin_limit_amount_rm));
        // stock
        Set(isRatioChecked, First(marginDetail1.proposal).margin_ratio_check = "1");
        // end variable
        
        If(!typeOneClient,
            Set(dataDetailStock, First(Filter(MarginLimitPolicyList, Max(Value(RMO_proposed_margined_amt_all_client)))));
            Set(valueMaxCheckStock, dataDetailStock.RMO_proposed_margined_amt_all_client);
        );
        
        Set(typeChecking, First(marginDetail1.proposal).type_checking);
        
        If(IsBlank(First(marginDetail1.proposal).status) || First(marginDetail1.proposal).status in ["", "DRAFT", "PENDING_RISK_MANAGERMENTS_OPINION", "PENDING_RESEARCHS_OPINION"],
            If(typeOneClient, ClearCollect(ShowByGroup, ["BKR", "RM", "AR"]), ClearCollect(ShowByGroup, ["BKR", "RS", "RM", "AR"])),
            Switch(typeChecking,
            Blank(),
            ClearCollect(ShowByGroup, ["BKR"]),
            "OC-TH1",
            ClearCollect(ShowByGroup, ["BKR", "RM"]),
            "OC-TH2",
            ClearCollect(ShowByGroup, ["BKR", "RM", "AR", "DCEO"]),
            "OC-TH3",
            ClearCollect(ShowByGroup, ["BKR", "RM", "AR", "DCEO", "IC", "CEO"]),
            "ST-TH1",
            ClearCollect(ShowByGroup, ["BKR", "RS", "RM", "AR", "IC", "CEO", "SEND"]),
            "ST-TH2",
            ClearCollect(ShowByGroup, ["BKR", "RS", "RM", "AR", "IC", "CEO", "SC", "SEND"]),
            "ST-TH3",
            ClearCollect(ShowByGroup, ["BKR", "RS", "RM", "AR", "IC", "CEO", "SC", "SEND"]),
            "R",
            ClearCollect(ShowByGroup, ["BKR", "RS", "RM", "AR", "IC", "SEND"])
            )
        );
        
        // max_margin_limit_amount OC - RM
        Set(OriginalText, Substitute(First(marginDetail1.proposal).max_margin_limit_amount, ",", ""));
        Set(FirstDotIndex, Find(".", OriginalText));Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
        If(!IsNumeric(ModifiedText), Substitute(First(marginDetail1.proposal).max_margin_limit_amount, First(marginDetail1.proposal).max_margin_limit_amount, "");Set(maxMarginLimitAmount, Blank()),
        Set(maxMarginLimitAmount, ModifiedText));
        // end max_margin_limit_amount OC - RM
        
        // proposed_margin_limit_amount OC - RM
        Set(OriginalText, Substitute(First(marginDetail1.brokerage).proposed_margin_limit_amount, ",", ""));
        Set(FirstDotIndex, Find(".", OriginalText));Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
        If(!IsNumeric(ModifiedText), Substitute(First(marginDetail1.brokerage).proposed_margin_limit_amount, First(marginDetail1.brokerage).proposed_margin_limit_amount, "");Set(proposedMarginLimitAmount, Blank()),
        Set(proposedMarginLimitAmount, ModifiedText));
        // end proposed_margin_limit_amount OC - RM
        
        // proposed_margin_limit_amount_rm OC - RM
        Set(OriginalText, Substitute(First(marginDetail1.brokerage).proposed_margin_limit_amount_rm, ",", ""));
        Set(FirstDotIndex, Find(".", OriginalText));Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
        If(!IsNumeric(ModifiedText), Substitute(First(marginDetail1.brokerage).proposed_margin_limit_amount_rm, First(marginDetail1.brokerage).proposed_margin_limit_amount_rm, "");Set(proposedMarginLimitAmountRm, Blank()),
        Set(proposedMarginLimitAmountRm, ModifiedText));
        // end proposed_margin_limit_amount_rm OC - RM
        
        // rate OC - RM
        Set(OriginalText, Substitute(First(marginDetail1.brokerage).proposed_interest_rate_rm, ",", ""));
        Set(FirstDotIndex, Find(".", OriginalText));Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
        If(!IsNumeric(ModifiedText), Substitute(First(marginDetail1.brokerage).proposed_interest_rate_rm, First(marginDetail1.brokerage).proposed_interest_rate_rm, "");Set(proposedInterestRateRm, Blank()),
        Set(proposedInterestRateRm, ModifiedText));
        // end rate OC - RM
        
        // rate OC - BR
        Set(OriginalText_OC_BR, Substitute(First(marginDetail1.brokerage).proposed_interest_rate, ",", ""));
        Set(FirstDotIndex_OC_BR, Find(".", OriginalText_OC_BR));Set(TextBeforeFirstDot_OC_BR, Left(OriginalText_OC_BR, FirstDotIndex_OC_BR));Set(TextAfterFirstDot_OC_BR, Mid(OriginalText_OC_BR, FirstDotIndex_OC_BR + 1, Len(OriginalText_OC_BR) - FirstDotIndex_OC_BR));Set(ModifiedText_OC_BR, TextBeforeFirstDot_OC_BR & Substitute(TextAfterFirstDot_OC_BR, ".", ""));
        If(!IsNumeric(ModifiedText_OC_BR), Substitute(First(marginDetail1.brokerage).proposed_interest_rate, First(marginDetail1.brokerage).proposed_interest_rate, "");Set(proposedInterestRateBr, Blank()),
        Set(proposedInterestRateBr, ModifiedText_OC_BR));
        // end rate OC - BR
        
        Set(headerContent, If(IsBlank(First(marginDetail1.updateChange).header_content), "Dear Trading Team,
        Risk management Division would like to send Trading team the updated stock margin list as below. For the detail, please see at the attached file.",
        First(marginDetail1.updateChange).header_content));
        
        Set(bottomConent, If(IsBlank(First(marginDetail1.updateChange).bottom_content), "Thanks and Best regards,",
        First(marginDetail1.updateChange).bottom_content));
        
        Set(isLoading, false);
        

    Canvas3_3 As fluidGrid.fluidGridWithBlankCard:
        BorderThickness: =0
        Height: =App.Height
        Width: =Parent.Width
        ZIndex: =1

        DataCard3_3 As dataCard:
            BorderColor: =RGBA(0, 0, 0, 1)
            BorderStyle: =BorderStyle.Solid
            BorderThickness: =0
            DisplayMode: =DisplayMode.Edit
            Fill: =RGBA(0, 0, 0, 0)
            Height: =1000
            Width: =Parent.Width
            X: =0
            Y: =0
            ZIndex: =1

            White_Background_10 As htmlViewer:
                Font: =Font.Arial
                Height: =If(DealDetailTab = 1, listAttachFileItems_1.Y + listAttachFileItems_1.Height - Self.Y + 50, If(DealDetailTab = 3, If(NoData_Label_1.Visible, NoData_Label_1.Y + NoData_Label_1.Height, MR_Logs.Y + MR_Logs.Height - Self.Y + 40) , listAttachFileItems_send.Y + listAttachFileItems_send.Height - Self.Y + 40))
                HtmlText: |-
                    ="<div style='width: calc(100% - 16px); height: "& Self.Height - 20 &"px; background-color: white;border-radius: 12px;box-shadow: "& If(Parent.Width > 600, "7px 5px 7px 0px rgba(0, 0, 0, 0.10)", "none") & ";
                    '></div>"
                PaddingRight: =5.00
                PaddingTop: =5.00
                Size: =14.00
                Width: |-
                    =If(
                        App.Width > 800,
                        App.Width - If(MobileShowMenu, MenuItemsSideBar_19.Width, MenuItemsSideBar_Small_15.Width) - 315,
                        App.Width
                    ) + If(App.Width > 1000 && App.Width < 1100, 40, 0)
                X: =If(App.Width > 800 || showProgress, HrProgress_3.X + HrProgress_3.Width + 10, ListProgessItems_1.X + 5)
                Y: =SubHeaderBg_4.Y + SubHeaderBg_4.Height + If(App.Width > 800, 10, 30)
                ZIndex: =1

            QT2TabsGroup_9 As group:
                Height: =5
                Width: =5
                X: =40
                Y: =-40
                ZIndex: =4

                HrQT2_7 As rectangle:
                    BorderColor: =RGBA(176, 176, 176, 1)
                    BorderThickness: =0.5
                    Fill: =RGBA(246, 246, 246, 1)
                    Height: =0.5
                    Visible: =QT2Tabs_10.Visible
                    Width: =If(App.Width > 800, White_Background_10.Width - If(App.Width > 600, 70, 50), QT2Tabs_10.AllItemsCount * QT2Tabs_10.TemplateWidth - 8)
                    X: =QT2Tabs_10.X + 5
                    Y: =QT2Tabs_10.Y + QT2Tabs_10.Height - 7
                    ZIndex: =2

                QT2Tabs_10 As gallery.galleryHorizontal:
                    '#CopilotOverlayLabel': ="Filtered"
                    DelayItemLoading: =true
                    Height: =If(Self.Visible, 47, 0)
                    Items: =listTabMargin
                    ShowScrollbar: =false
                    TemplatePadding: =0
                    TemplateSize: =If(App.Width > 800, 160, 150)
                    Visible: |-
                        =// First(marginDetail1.proposal).status <> "PENDING_UPDATE_CHANGES"
                        DealDetailTab <> 2
                    Width: =If(Parent.Width > 600,White_Background_10.Width - 70, Parent.Width - 50)
                    X: =White_Background_10.X + If(App.Width > 600, 30, 10)
                    Y: =White_Background_10.Y + 10
                    ZIndex: =3

                    Button8_13 As button:
                        BorderStyle: =BorderStyle.None
                        Color: =If(DealDetailTab = ThisItem.tab, RGBA(14, 63, 115, 1), RGBA(176, 176, 176, 1))
                        DisabledFill: =Self.Fill
                        Fill: =RGBA(0, 0, 0, 0)
                        Font: =Font.Arial
                        Height: =35
                        HoverColor: =If(DealDetailTab = ThisItem.tab, RGBA(14, 63, 115, 1), RGBA(176, 176, 176, 1))
                        HoverFill: =Self.Fill
                        OnSelect: |-
                            =Set(DealDetailTab, ThisItem.tab);
                            If(DealDetailTab = 3 && !IsBlank(First(marginDetail1.proposal).id),
                                Set(isLoading, true);
                                ClearCollect(approvelLog, 'TVS->GetApprovalLogProcess4'.Run(First(marginDetail1.proposal).id, envDEV, envTEST, envUAT1, envUAT2, resKeyOpenAll.open, resKeyOpenAll.close));
                                Set(isLoading, false);
                            );
                        PaddingLeft: =0
                        PaddingRight: =0
                        PressedBorderColor: =Self.Color
                        PressedColor: =Self.Color
                        PressedFill: =Self.Fill
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =10.5
                        Text: =ThisItem.text
                        Tooltip: =ThisItem.text
                        Width: =QT2Tabs_10.TemplateWidth
                        Y: =5
                        ZIndex: =1

                    BottomBorder1_20 As rectangle:
                        BorderColor: =If(DealDetailTab = ThisItem.tab, RGBA(14,63,115,1),RGBA(176, 176, 176, 1))
                        BorderThickness: =If(DealDetailTab = ThisItem.tab, 2, 1)
                        Fill: =RGBA(246, 246, 246, 1)
                        Height: =If(ThisItem.tab = DealDetailTab, 2, 0)
                        Width: =QT2Tabs_10.TemplateWidth - 5
                        X: =5
                        Y: =40
                        ZIndex: =2

            Subject_inpt As text:
                BorderColor: =If(IsBlank(Self.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                BorderThickness: =1
                Default: =First(marginDetail1.updateChange).subject
                DisplayMode: =If(!isUpdateChange || !(marginDetail.status in ["PENDING_UPDATE_CHANGES"]), DisplayMode.Disabled, DisplayMode.Edit)
                FocusedBorderColor: =Self.HoverBorderColor
                FocusedBorderThickness: =1
                Font: =Font.Arial
                Height: =43
                HoverFill: =
                LineHeight: =1.5
                MaxLength: =150
                Size: =If(App.Width > 800,10.5,12)
                Visible: =DealDetailTab=2
                Width: =If(App.Width > 1300, 315, App.Width < 600, White_Background_10.Width - 40, App.Width < 800, White_Background_10.Width - 70, (White_Background_10.Width - If(App.Width > 600, 100, 70)) / 2)
                X: =Label_Subject.X
                Y: =Label_Subject.Y + Label_Subject.Height
                ZIndex: =26

            SendTo_input As text:
                BorderColor: =If(IsBlank(Self.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                BorderThickness: =1
                Default: =First(marginDetail1.updateChange).send_to
                DisplayMode: =If(!isUpdateChange || !(marginDetail.status in ["PENDING_UPDATE_CHANGES"]), DisplayMode.Disabled, DisplayMode.Edit)
                FocusedBorderColor: =Self.HoverBorderColor
                FocusedBorderThickness: =1
                Font: =Font.Arial
                Height: =43
                HoverFill: =
                LineHeight: =1.5
                MaxLength: =150
                Size: =If(App.Width > 800,10.5,12)
                Tooltip: =First(marginDetail1.updateChange).send_to
                Visible: =DealDetailTab = 2
                Width: =Subject_inpt.Width
                X: =Label_Send.X
                Y: =Label_Send.Y + Label_Send.Height
                ZIndex: =27

            Label_Subject As label:
                BorderColor: =RGBA(89, 0, 0, 1)
                Color: =RGBA(82, 82, 82, 1)
                Font: =Font.Arial
                FontWeight: =FontWeight.Semibold
                Height: =30
                PaddingLeft: =0
                PaddingTop: =10
                Size: =10.5
                Text: ="Subject"
                Visible: =DealDetailTab = 2
                Width: =Subject_inpt.Width
                X: =QT2Tabs_10.X
                Y: =QT2Tabs_10.Y + QT2Tabs_10.Height + 10
                ZIndex: =28

            Label_Send As label:
                BorderColor: =RGBA(89, 0, 0, 1)
                Color: =RGBA(82, 82, 82, 1)
                Font: =Font.Arial
                FontWeight: =FontWeight.Semibold
                Height: =30
                PaddingLeft: =0
                PaddingTop: =10
                Size: =10.5
                Text: ="Send To"
                Visible: =DealDetailTab = 2
                Width: =SendTo_input.Width
                X: =Subject_inpt.X + If(App.Width > 800, Subject_inpt.Width + 30, 0)
                Y: =If(App.Width > 800, Label_Subject.Y, Subject_inpt.Y + Subject_inpt.Height)
                ZIndex: =29

            Label_Content As label:
                BorderColor: =RGBA(89, 0, 0, 1)
                Color: =RGBA(82, 82, 82, 1)
                Font: =Font.Arial
                FontWeight: =FontWeight.Semibold
                Height: =35
                PaddingLeft: =0
                PaddingTop: =10
                Size: =10.5
                Text: ="Content"
                Visible: =DealDetailTab=2
                Width: |
                    =142
                X: =Subject_inpt.X
                Y: =SendTo_input.Y + SendTo_input.Height + 10
                ZIndex: =30

            AttachmentLabel_2 As label:
                Color: =RGBA(14, 63, 115, 1)
                Font: =Font.Arial
                FontWeight: =FontWeight.Bold
                PaddingBottom: =20
                PaddingTop: =20
                Size: =10.5
                Text: ="Attach file to send email"
                Visible: =DealDetailTab=2
                Width: =200
                X: =Label_Content.X
                Y: =btnUpdateTable.Y + btnUpdateTable.Height + 10
                ZIndex: =31

            AttachFile_6 As attachments:
                AddAttachmentText: ="Click here to attach file"
                BorderColor: =
                BorderThickness: =0
                DisplayMode: =If(!isUpdateChange, DisplayMode.Disabled, DisplayMode.Edit)
                DropTargetBorderThickness: =0
                Fill: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =0
                Font: =Font.Arial
                Height: =If(Self.Visible, 85 + Max(If(CountRows(Self.Attachments) = 1, 0, CountRows(Self.Attachments) * 15)), 0)
                IsInDataCard: =true
                Italic: =true
                Items: =
                MaxAttachments: =9999
                MaxAttachmentSize: =20
                NoAttachmentsText: =If(CountRows(Filter(colExternalFiles, IsDeleted <> true)) = 0, "There is nothing attached.", "")
                OnRemoveFile: |-
                    =RemoveIf(colExternalFiles, Id = Blank() || Id = "");
                    
                    ForAll(
                        Self.Attachments As att,
                        Collect(
                            colExternalFiles,
                            {   
                                Id:"",
                                Date: Text(
                                    Today(),
                                    "yyyy-mm-dd hh:mm:ss"
                                ),
                                By:  First(currentUserV2Res).id,
                                Name: Text(Now(), "dd/mm/yyyy_hh:mm:ss_") & att.Name,
                                Value: att.Value,
                                File: {
                                    file: {
                                        contentBytes: att.Value,
                                        name: att.Name
                                    }
                                },
                                IsDeleted: false
                            }
                        )
                    );
                PaddingBottom: =5
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 0, 0)
                PaddingRight: =5
                Size: =10.5
                Tooltip: =
                Visible: =DealDetailTab = 2 && marginDetail.status in ["PENDING_UPDATE_CHANGES"]
                Width: =If(App.Width > 1600, input_note.Width * 2/ 3, App.Width > 1300, input_note.Width * 2.3/ 3, App.Width > 800, White_Background_10.Width - 85, White_Background_10.Width - 65)
                X: =Label_Content.X
                Y: =AttachmentLabel_2.Y + AttachmentLabel_2.Height
                ZIndex: =32

            AttachFile_5 As attachments:
                AddAttachmentText: ="Click here to attach file"
                BorderColor: =
                BorderThickness: =0
                DisplayMode: =If(!isUpdateChange, DisplayMode.Disabled, DisplayMode.Edit)
                DropTargetBorderThickness: =0
                Fill: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =0
                Font: =Font.Arial
                Height: =If(Self.Visible, 85 + Max(If(CountRows(Self.Attachments) = 1, 0, CountRows(Self.Attachments) * 15)), 0)
                IsInDataCard: =true
                Italic: =true
                Items: =
                MaxAttachments: =9999
                MaxAttachmentSize: =20
                NoAttachmentsText: =If(CountRows(Filter(colExternalFiles, IsDeleted <> true)) = 0, "There is nothing attached.", "")
                OnRemoveFile: |-
                    =RemoveIf(colExternalFiles, Id = Blank() || Id = "");
                    
                    ForAll(
                        Self.Attachments As att,
                        Collect(
                            colExternalFiles,
                            {   
                                Id:"",
                                Date: Text(
                                    Today(),
                                    "yyyy-mm-dd hh:mm:ss"
                                ),
                                By:  First(currentUserV2Res).id,
                                Name: Text(Now(), "dd/mm/yyyy_hh:mm:ss_") & att.Name,
                                Value: att.Value,
                                File: {
                                    file: {
                                        contentBytes: att.Value,
                                        name: att.Name
                                    }
                                },
                                IsDeleted: false
                            }
                        )
                    );
                PaddingBottom: =5
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 0, 0)
                PaddingRight: =5
                Size: =10.5
                Tooltip: =
                Visible: =DealDetailTab=2 && marginDetail.status in ["PENDING_UPDATE_CHANGES"]
                Width: =If(App.Width > 1600, input_note.Width * 2/ 3, App.Width > 1300, input_note.Width * 2.3/ 3, App.Width > 800, White_Background_10.Width - 85, White_Background_10.Width - 65)
                X: =AttachmentLabel_3.X
                Y: =AttachmentLabel_3.Y + AttachmentLabel_3.Height
                ZIndex: =33

            AttachmentLabel_3 As label:
                Color: =RGBA(14, 63, 115, 1)
                Font: =Font.Arial
                FontWeight: =FontWeight.Bold
                PaddingBottom: =20
                PaddingTop: =20
                Size: =10.5
                Text: ="Attachment"
                Visible: =DealDetailTab=2
                Width: =130
                X: =AttachFile_6.X
                Y: =listAttachFileItems_send_email.Y + listAttachFileItems_send_email.Height
                ZIndex: =34

            btnUpdateTable As button:
                BorderColor: =Self.Fill
                BorderThickness: =0
                DisabledFill: =Self.Fill
                Fill: =RGBA(17, 79, 144, 1)
                FocusedBorderThickness: =0
                Font: =Font.Arial
                FontWeight: =FontWeight.Normal
                Height: =44
                HoverColor: =Self.Color
                HoverFill: =Self.Fill
                OnSelect: |-
                    =ClearCollect(listPolicyEmailOld, listPolicyEmail);
                    Set(tableEmailMargin,true);
                    Set(showTableMail, true);
                PressedColor: =Self.Color
                PressedFill: =Self.Fill
                RadiusBottomLeft: =5
                RadiusBottomRight: =5
                RadiusTopLeft: =5
                RadiusTopRight: =5
                Size: =10.5
                Text: ="Update content"
                Visible: =DealDetailTab = 2 && isUpdateChange && If(App.Width > 800, true, !showProgress) && marginDetail.status = "PENDING_UPDATE_CHANGES"
                Width: =120
                X: =App.Width - Self.Width - If(App.Width > 800, 50, 30)
                Y: =Container18.Y + Container18.Height + 15
                ZIndex: =35

            "listAttachFileItems_send_email As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                '#CopilotOverlayLabel': ="Filtered"
                DelayItemLoading: =true
                Height: =Self.AllItemsCount * Self.TemplateHeight
                Items: =marginDetail1.attachmentEmail
                Layout: =Layout.Vertical
                LoadingSpinner: =LoadingSpinner.Data
                TemplatePadding: =0
                TemplateSize: =If(App.Width > 800, 45, 50)
                Visible: =DealDetailTab=2
                Width: =AttachFile_6.Width
                X: =AttachFile_6.X
                Y: =AttachFile_6.Y + AttachFile_6.Height
                ZIndex: =36

                Rectangle5_3 As rectangle:
                    Height: =
                    OnSelect: =Select(Parent)
                    Visible: =ThisItem.IsSelected
                    Width: =4
                    ZIndex: =1

                HtmlText7_14 As htmlViewer:
                    Font: =Font.Arial
                    Height: =listAttachFileItems_send_email.TemplateHeight
                    HtmlText: |-
                        ="<svg xmlns=""http://www.w3.org/2000/svg"" width=""16"" height=""20"" viewBox=""0 0 16 20"" fill=""none"">
                          <path d=""M10.7503 2.66732H2.50033V17.334H13.5003V5.41732H10.7503V2.66732ZM2.50033 0.833984H11.667L15.3337 4.50065V17.334C15.3337 17.8202 15.1405 18.2865 14.7967 18.6303C14.4529 18.9742 13.9866 19.1673 13.5003 19.1673H2.50033C2.0141 19.1673 1.54778 18.9742 1.20396 18.6303C0.860146 18.2865 0.666992 17.8202 0.666992 17.334V2.66732C0.666992 2.18109 0.860146 1.71477 1.20396 1.37096C1.54778 1.02714 2.0141 0.833984 2.50033 0.833984ZM4.33366 9.08398H11.667V10.9173H4.33366V9.08398ZM4.33366 12.7507H11.667V14.584H4.33366V12.7507Z"" fill=""#114F90""/>
                        </svg>"
                    OnSelect: =Select(Parent)
                    PaddingLeft: =10
                    PaddingTop: =13
                    Width: =If(App.Width > 600, 40, 30)
                    ZIndex: =2

                SizeAttIssuer_3 As label:
                    Font: =Font.Arial
                    FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                    Height: =listAttachFileItems_send_email.TemplateHeight
                    OnSelect: =Select(Parent)
                    PaddingBottom: =0
                    PaddingLeft: =0
                    PaddingRight: =0
                    PaddingTop: =0
                    Size: =10.5
                    Text: =
                    Width: =50
                    X: =449
                    ZIndex: =4

                FileName_Link_3 As button:
                    Align: =Align.Left
                    BorderThickness: =0
                    Color: =RGBA(0, 0, 0, 1)
                    DisabledFill: =Self.Fill
                    DisplayMode: =If("DOWNLOADFILE" in LookUp(currenUserV2.permissionList, process_code = "Process4", action), DisplayMode.Edit, DisplayMode.Disabled)
                    Fill: =RGBA(0, 0, 0, 0)
                    FocusedBorderThickness: =0
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Lighter
                    Height: =45
                    HoverColor: =RGBA(56, 96, 178, 1)
                    HoverFill: =Self.Fill
                    OnSelect: |-
                        =If("DOWNLOADFILE" in LookUp(currenUserV2.permissionList, process_code = "Process4", action),
                        Set(urlML,'TVS->DownloadFileExpTime-V1'.Run(bucketMargin, ThisItem.file_name).url);
                        Launch(urlML))
                    PaddingBottom: =0
                    PaddingLeft: =0
                    PaddingRight: =0
                    PaddingTop: =0
                    PressedBorderColor: =Self.Color
                    PressedColor: =Self.Color
                    PressedFill: =Self.Fill
                    Size: =10.5
                    Text: |-
                        =If(App.Width > 800, ThisItem.file_name, If(Len(If(IsBlank(ThisItem.file_name), If(IsBlank(ThisItem.file_name), "", ThisItem.file_name), ThisItem.file_name)) > 50,
                            Left(If(IsBlank(ThisItem.file_name), If(IsBlank(ThisItem.file_name), "", ThisItem.file_name), ThisItem.file_name), 50) & "...",
                            If(IsBlank(ThisItem.file_name), If(IsBlank(ThisItem.file_name), "", ThisItem.file_name), ThisItem.file_name)
                        ))
                    Visible: =!(IsBlank(proposalInfoEdit) && IsBlank(IdCreateProposal))
                    Width: =Parent.Width - RemoveAttachmentIcon_3.Width - CreatedDate_Text_3.Width - 40
                    X: =HtmlText7_14.X + HtmlText7_14.Width
                    ZIndex: =5

                RemoveAttachmentIcon_3 As icon.Cancel:
                    Color: =RGBA(0, 0, 0, 1)
                    FocusedBorderThickness: =3
                    Height: =18
                    Icon: =Icon.Cancel
                    OnSelect: =
                    Visible: =Note_Input_1.DisplayMode = DisplayMode.Edit
                    Width: =18
                    X: =Parent.Width - 20
                    Y: =If(App.Width > 600, 15, 15)
                    ZIndex: =7

                CreatedDate_Text_3 As label:
                    Align: =Align.Right
                    Font: =Font.Arial
                    Height: =FileName_Link_3.Height
                    OnSelect: =Select(Parent)
                    PaddingBottom: =0
                    PaddingRight: =10
                    PaddingTop: =0
                    Size: =10.5
                    Text: =ThisItem.created_by
                    Width: =If(App.Width > 1300, 120, 0)
                    X: =FileName_Link_3.X + FileName_Link_3.Width
                    ZIndex: =9

            "listAttachFileItems_send As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                '#CopilotOverlayLabel': ="Filtered"
                DelayItemLoading: =true
                Height: =Self.AllItemsCount * Self.TemplateHeight
                Items: =marginDetail1.attachment2
                Layout: =Layout.Vertical
                LoadingSpinner: =LoadingSpinner.Data
                TemplatePadding: =0
                TemplateSize: =If(App.Width > 800, 45, 50)
                Visible: =DealDetailTab=2
                Width: =AttachFile_5.Width
                X: =AttachFile_5.X
                Y: =AttachFile_5.Y + AttachFile_5.Height
                ZIndex: =37

                Rectangle5_4 As rectangle:
                    Height: =
                    OnSelect: =Select(Parent)
                    Visible: =ThisItem.IsSelected
                    Width: =4
                    ZIndex: =1

                HtmlText7_15 As htmlViewer:
                    Font: =Font.Arial
                    Height: =listAttachFileItems_send.TemplateHeight
                    HtmlText: |-
                        ="<svg xmlns=""http://www.w3.org/2000/svg"" width=""16"" height=""20"" viewBox=""0 0 16 20"" fill=""none"">
                          <path d=""M10.7503 2.66732H2.50033V17.334H13.5003V5.41732H10.7503V2.66732ZM2.50033 0.833984H11.667L15.3337 4.50065V17.334C15.3337 17.8202 15.1405 18.2865 14.7967 18.6303C14.4529 18.9742 13.9866 19.1673 13.5003 19.1673H2.50033C2.0141 19.1673 1.54778 18.9742 1.20396 18.6303C0.860146 18.2865 0.666992 17.8202 0.666992 17.334V2.66732C0.666992 2.18109 0.860146 1.71477 1.20396 1.37096C1.54778 1.02714 2.0141 0.833984 2.50033 0.833984ZM4.33366 9.08398H11.667V10.9173H4.33366V9.08398ZM4.33366 12.7507H11.667V14.584H4.33366V12.7507Z"" fill=""#114F90""/>
                        </svg>"
                    OnSelect: =Select(Parent)
                    PaddingLeft: =10
                    PaddingTop: =13
                    Width: =If(App.Width > 600, 40, 30)
                    ZIndex: =2

                FileName_Link_4 As button:
                    Align: =Align.Left
                    BorderThickness: =0
                    Color: =RGBA(0, 0, 0, 1)
                    DisabledFill: =Self.Fill
                    DisplayMode: =If("DOWNLOADFILE" in LookUp(currenUserV2.permissionList, process_code = "Process4", action), DisplayMode.Edit, DisplayMode.Disabled)
                    Fill: =RGBA(0, 0, 0, 0)
                    FocusedBorderThickness: =0
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Lighter
                    Height: =45
                    HoverColor: =RGBA(56, 96, 178, 1)
                    HoverFill: =Self.Fill
                    OnSelect: |-
                        =If("DOWNLOADFILE" in LookUp(currenUserV2.permissionList, process_code = "Process4", action),
                        Set(urlML,'TVS->DownloadFileExpTime-V1'.Run(bucketMargin, ThisItem.file_name).url);
                        Launch(urlML))
                    PaddingBottom: =0
                    PaddingLeft: =0
                    PaddingRight: =0
                    PaddingTop: =0
                    PressedBorderColor: =Self.Color
                    PressedColor: =Self.Color
                    PressedFill: =Self.Fill
                    Size: =10.5
                    Text: |-
                        =If(App.Width > 800, ThisItem.file_name, If(Len(If(IsBlank(ThisItem.file_name), If(IsBlank(ThisItem.file_name), "", ThisItem.file_name), ThisItem.file_name)) > 50,
                            Left(If(IsBlank(ThisItem.file_name), If(IsBlank(ThisItem.file_name), "", ThisItem.file_name), ThisItem.file_name), 50) & "...",
                            If(IsBlank(ThisItem.file_name), If(IsBlank(ThisItem.file_name), "", ThisItem.file_name), ThisItem.file_name)
                        ))
                    Visible: =!(IsBlank(proposalInfoEdit) && IsBlank(IdCreateProposal))
                    Width: =Parent.Width - RemoveAttachmentIcon_4.Width - CreatedDate_Text_4.Width - 40
                    X: =HtmlText7_15.X + HtmlText7_15.Width
                    ZIndex: =5

                RemoveAttachmentIcon_4 As icon.Cancel:
                    Color: =RGBA(0, 0, 0, 1)
                    FocusedBorderThickness: =3
                    Height: =18
                    Icon: =Icon.Cancel
                    OnSelect: =
                    Visible: =Note_Input_1.DisplayMode = DisplayMode.Edit
                    Width: =18
                    X: =Parent.Width - 20
                    Y: =If(App.Width > 600, 15, 15)
                    ZIndex: =7

                CreatedDate_Text_4 As label:
                    Align: =Align.Right
                    Font: =Font.Arial
                    Height: =FileName_Link_4.Height
                    OnSelect: =Select(Parent)
                    PaddingBottom: =0
                    PaddingRight: =10
                    PaddingTop: =0
                    Size: =10.5
                    Text: =ThisItem.created_by
                    Width: =If(App.Width > 1300, 120, 0)
                    X: =FileName_Link_4.X + FileName_Link_4.Width
                    ZIndex: =9

            "MR_Logs As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                '#CopilotOverlayLabel': ="Filtered"
                DelayItemLoading: =true
                Height: =Self.AllItemsCount * Self.TemplateHeight
                Items: =Sort(Filter(approvelLog,action <> "SUBMIT"), created_date, SortOrder.Descending)
                Layout: =Layout.Vertical
                TemplatePadding: =0
                TemplateSize: =If(App.Width > 1100, 95, 110)
                Visible: =DealDetailTab = 3
                Width: =White_Background_10.Width - If(App.Width > 600, 70, 30)
                X: =QT2Tabs_10.X
                Y: =QT2Tabs_10.Y + QT2Tabs_10.Height + 10
                ZIndex: =38

                Title5_5 As label:
                    Font: =Font.Arial
                    Height: =If(App.Width > 1100, 26, 40)
                    OnSelect: =Select(Parent)
                    PaddingBottom: =0
                    PaddingLeft: =0
                    PaddingRight: =0
                    PaddingTop: =0
                    Size: =10.5
                    Text: |-
                        =If(ThisItem.action = "APPROVE" , "Approved by " ,ThisItem.action = "REJECT", "Rejected by ", "Revise by ")
                        & ThisItem.created_by
                        & " on "
                        & Text(DateTimeValue(ThisItem.created_date), "dd/mm/yyyy hh:mm:ss")
                        & " with comments:"
                    VerticalAlign: =VerticalAlign.Top
                    Width: =Parent.Width - 20
                    X: =10
                    Y: =4
                    ZIndex: =2

                TextInput4_5 As text:
                    BorderThickness: =0
                    Default: =If(Title5_7.Visible, "", If(IsBlank(ThisItem.comment), "N/A", ThisItem.comment))
                    DisabledColor: =If(App.Width >= 600, RGBA(166, 166, 166, 1), RGBA(0,0,0,0))
                    DisplayMode: =DisplayMode.Disabled
                    Font: =Font.Arial
                    Height: =60
                    HintText: =""
                    LineHeight: =1.5
                    Mode: =TextMode.MultiLine
                    OnSelect: =Select(Parent)
                    PaddingBottom: =8
                    PaddingRight: =8
                    PaddingTop: =8
                    Size: =10.5
                    Width: =Title5_5.Width
                    X: =Title5_5.X
                    Y: =Title5_5.Y + Title5_5.Height
                    ZIndex: =3

                Title5_7 As label:
                    Color: =RGBA(166, 166, 166, 1)
                    Font: =Font.Arial
                    Height: =TextInput4_5.Height
                    OnSelect: =Select(Parent)
                    Overflow: =Overflow.Scroll
                    PaddingBottom: =TextInput4_5.PaddingBottom
                    PaddingLeft: =TextInput4_5.PaddingLeft
                    PaddingRight: =TextInput4_5.PaddingRight
                    PaddingTop: =TextInput4_5.PaddingTop
                    Size: =10.5
                    Text: =ThisItem.comment
                    VerticalAlign: =VerticalAlign.Top
                    Visible: =TextInput4_5.DisplayMode = DisplayMode.Disabled && App.Width < 600
                    Width: =TextInput4_5.Width
                    X: =TextInput4_5.X
                    Y: =TextInput4_5.Y
                    ZIndex: =4

            ShowHideProgress_1 As button:
                Align: =Align.Left
                Color: =RGBA(0, 0, 0, 1)
                Fill: =RGBA(0, 0, 0, 0)
                Font: =Font.Arial
                FontWeight: =FontWeight.Normal
                HoverColor: =RGBA(0, 0, 0, 1)
                HoverFill: =
                OnSelect: =Set(showProgress, !showProgress)
                PaddingLeft: =15
                PressedColor: =Self.Color
                PressedFill: =Self.Fill
                Size: =10.5
                Text: =If(!showProgress, "Show progress", "Hide progress")
                Visible: =App.Width <= 800
                Width: =135
                X: =40
                Y: =SubHeaderBg_4.Y + SubHeaderBg_4.Height
                ZIndex: =39

            ShowHideProgressIcon_1 As htmlViewer:
                Font: =Font.Arial
                Height: =44
                HtmlText: |-
                    =If(showProgress,
                    "<div style=""cursor: pointer""><svg width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                    <g clip-path=""url(#clip0_1760_3688)"">
                    <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M11.2682 8.62347C11.4558 8.436 11.7101 8.33068 11.9752 8.33068C12.2404 8.33068 12.4947 8.436 12.6822 8.62347L18.3392 14.2805C18.4348 14.3727 18.5109 14.4831 18.5633 14.6051C18.6158 14.7271 18.6433 14.8583 18.6445 14.9911C18.6456 15.1238 18.6203 15.2555 18.5701 15.3784C18.5198 15.5013 18.4455 15.613 18.3516 15.7069C18.2577 15.8008 18.1461 15.875 18.0232 15.9253C17.9003 15.9756 17.7686 16.0009 17.6358 15.9997C17.5031 15.9986 17.3718 15.971 17.2498 15.9186C17.1278 15.8662 17.0175 15.79 16.9252 15.6945L11.9752 10.7445L7.02524 15.6945C6.83664 15.8766 6.58404 15.9774 6.32184 15.9751C6.05965 15.9729 5.80883 15.8677 5.62342 15.6823C5.43802 15.4969 5.33285 15.2461 5.33057 14.9839C5.32829 14.7217 5.42908 14.4691 5.61124 14.2805L11.2682 8.62347Z"" fill=""#525252""/>
                    </g>
                    <defs>
                    <clipPath id=""clip0_1760_3688"">
                    <rect width=""24"" height=""24"" fill=""white""/>
                    </clipPath>
                    </defs>
                    </svg></div>"
                    , "<div style=""cursor: pointer""><svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                    <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.7069 15.7071C12.5193 15.8946 12.265 15.9999 11.9999 15.9999C11.7347 15.9999 11.4804 15.8946 11.2929 15.7071L5.63585 10.0501C5.54034 9.95785 5.46416 9.84751 5.41175 9.7255C5.35934 9.6035 5.33176 9.47228 5.3306 9.3395C5.32945 9.20672 5.35475 9.07504 5.40503 8.95215C5.45531 8.82925 5.52957 8.7176 5.62346 8.6237C5.71735 8.52981 5.829 8.45556 5.9519 8.40528C6.0748 8.355 6.20648 8.32969 6.33926 8.33085C6.47204 8.332 6.60325 8.35959 6.72526 8.412C6.84726 8.46441 6.95761 8.54059 7.04985 8.6361L11.9999 13.5861L16.9499 8.6361C17.1385 8.45394 17.3911 8.35315 17.6533 8.35542C17.9155 8.3577 18.1663 8.46287 18.3517 8.64828C18.5371 8.83369 18.6423 9.0845 18.6445 9.3467C18.6468 9.60889 18.546 9.8615 18.3639 10.0501L12.7069 15.7071Z"" fill=""#525252""/>
                    </svg></div>")
                OnSelect: =Select(ShowHideProgress_1)
                PaddingRight: =5.27
                PaddingTop: =5.27
                Size: =11.60
                Visible: =ShowHideProgress_1.Visible
                Width: =35
                X: =ShowHideProgress_1.X + ShowHideProgress_1.Width - Self.Width + 5
                Y: =ShowHideProgress_1.Y + 2
                ZIndex: =40

            CommonGroup As group:
                Height: =5
                Width: =5
                X: =40
                Y: =-40
                ZIndex: =45

                NoData_Label_1 As label:
                    Font: =Font.Arial
                    Height: =53
                    PaddingLeft: =10
                    Size: =10.5
                    Text: ="There is no items."
                    Visible: =DealDetailTab = 3 &&  CountRows(Filter(approvelLog,action <> "SUBMIT")) <= 0
                    Width: =QT2Tabs_10.AllItemsCount * QT2Tabs_10.TemplateWidth
                    X: =proposalDetailLogsItems_1.X
                    Y: =proposalDetailLogsItems_1.Y - 10
                    ZIndex: =5

                Note_Label_1 As label:
                    Font: =Font.Arial
                    Height: =25
                    PaddingLeft: =0
                    Size: =10.5
                    Text: ="Note"
                    Visible: =DealDetailTab = 1
                    Width: =120
                    X: =ML_Table.X
                    Y: |-
                        =Switch(marginLimitType, "One Client",
                            ML_Table.Y + ML_Table.Height + 0,
                            "One Stock",
                            StockTableControl1.Y + StockTableControl1.Data.currentHeight + 20,
                            StockTableControl1.Y + StockTableControl1.Data.currentHeight + 20)
                    ZIndex: =6

                Note_Input_1 As text:
                    BorderColor: =RGBA(191, 191, 192, 1)
                    BorderThickness: =If(Self.DisplayMode = DisplayMode.Disabled, 0, 1)
                    Default: =If(IsBlank(marginDetail1), "", First(marginDetail1.proposal).note)
                    DisabledColor: =RGBA(0, 0, 0, 1)
                    DisplayMode: =If(((marginDetail.status in ["PENDING_RISK_MANAGERMENTS_OPINION", "REVISED", "PENDING_RESEARCHS_OPINION"] && isRiskManager) || (marginDetail.status in ["PENDING_RESEARCHS_OPINION"] && isResearchCreate)) || IsBlank(marginDetail.status) || (marginDetail.status in ["DRAFT"] && isBrokerage), DisplayMode.Edit, DisplayMode.Disabled)
                    FocusedBorderColor: =RGBA(0, 18, 107, 1)
                    FocusedBorderThickness: =If(Self.DisplayMode = DisplayMode.Disabled, 0, 1)
                    Font: =Font.Arial
                    Height: =123
                    HoverFill: =RGBA(186, 202, 226, 0)
                    LineHeight: =1.5
                    MaxLength: =3500
                    Mode: =TextMode.MultiLine
                    PaddingBottom: =10
                    PaddingTop: =10
                    PressedBorderColor: =RGBA(0, 18, 107, 1)
                    Size: =If(App.Width > 600, 10.5, 12)
                    Visible: =DealDetailTab = 1
                    Width: =CompanyName_Input.X + CompanyName_Input.Width - Self.X
                    X: =Note_Label_1.X
                    Y: =Note_Label_1.Y + Note_Label_1.Height + 5
                    ZIndex: =7

                AttachFile_7 As attachments:
                    AddAttachmentText: ="Click here to attach file"
                    BorderColor: =
                    BorderThickness: =0
                    DropTargetBorderThickness: =0
                    Fill: =RGBA(0, 0, 0, 0)
                    FocusedBorderThickness: =0
                    Font: =Font.Arial
                    Height: =If(Self.Visible, 85 + Max(If(CountRows(Self.Attachments) = 1, 0, CountRows(Self.Attachments) * 15)), 30)
                    IsInDataCard: =true
                    Items: =
                    MaxAttachments: =9999
                    MaxAttachmentSize: =maxSizeFile
                    NoAttachmentsText: =If(listAttachFileItems_1.AllItemsCount > 0, "", "There is nothing attached.")
                    OnAddFile: |-
                        =Collect(listAttachFile, AttachFile_7.Attachments);
                        Reset(AttachFile_7);
                    OnRemoveFile: =
                    PaddingBottom: =5
                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                    PaddingRight: =5
                    PaddingTop: =5
                    Size: =10.5
                    Tooltip: =
                    Visible: =(((marginDetail.status in ["PENDING_RISK_MANAGERMENTS_OPINION", "REVISED", "PENDING_RESEARCHS_OPINION"] && isRiskManager) || (marginDetail.status in ["PENDING_RESEARCHS_OPINION"] && isResearchCreate)) || IsBlank(marginDetail.status) || (marginDetail.status in ["DRAFT"] && isBrokerage)) && DealDetailTab = 1
                    Width: |-
                        =If(App.Width > 1600,
                                input_note.Width * 2/ 3,
                            App.Width > 1300,
                                input_note.Width * 2.3/ 3,
                            App.Width > 800,
                                White_Background_10.Width - 65,
                            App.Width > 600,
                                White_Background_10.Width - 75,
                                White_Background_10.Width - 55
                        )
                    X: =AttachmentLabel_4.X
                    Y: =AttachmentLabel_4.Y + AttachmentLabel_4.Height - If(CountRows(Self.Attachments) = 0 && listAttachFileItems_1.AllItemsCount > 0, 40, 0)
                    ZIndex: =8

                "listAttachFileItems_1 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                    '#CopilotOverlayLabel': ="Filtered"
                    DelayItemLoading: =true
                    Height: =Self.AllItemsCount * Self.TemplateHeight
                    Items: =Filter(listAttachFile, IsDeleted <> true)
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplatePadding: =0
                    TemplateSize: =If(App.Width > 800, 45, 50)
                    Visible: =DealDetailTab = 1
                    Width: =AttachFile_7.Width
                    X: =AttachFile_7.X
                    Y: =AttachFile_7.Y + AttachFile_7.Height
                    ZIndex: =9

                    Rectangle5_1 As rectangle:
                        Height: =
                        OnSelect: =Select(Parent)
                        Visible: =ThisItem.IsSelected
                        Width: =4
                        ZIndex: =1

                    HtmlText7_12 As htmlViewer:
                        Font: =Font.Arial
                        Height: =listAttachFileItems_1.TemplateHeight
                        HtmlText: |-
                            ="<svg xmlns=""http://www.w3.org/2000/svg"" width=""16"" height=""20"" viewBox=""0 0 16 20"" fill=""none"">
                              <path d=""M10.7503 2.66732H2.50033V17.334H13.5003V5.41732H10.7503V2.66732ZM2.50033 0.833984H11.667L15.3337 4.50065V17.334C15.3337 17.8202 15.1405 18.2865 14.7967 18.6303C14.4529 18.9742 13.9866 19.1673 13.5003 19.1673H2.50033C2.0141 19.1673 1.54778 18.9742 1.20396 18.6303C0.860146 18.2865 0.666992 17.8202 0.666992 17.334V2.66732C0.666992 2.18109 0.860146 1.71477 1.20396 1.37096C1.54778 1.02714 2.0141 0.833984 2.50033 0.833984ZM4.33366 9.08398H11.667V10.9173H4.33366V9.08398ZM4.33366 12.7507H11.667V14.584H4.33366V12.7507Z"" fill=""#114F90""/>
                            </svg>"
                        OnSelect: =Select(Parent)
                        PaddingLeft: =10
                        PaddingTop: =13
                        Width: =If(App.Width > 600, 40, 30)
                        ZIndex: =2

                    Image1_3 As image:
                        Height: =listAttachFileItems_1.TemplateHeight
                        Image: =ThisItem.Value
                        OnSelect: =Select(Parent)
                        Visible: =false
                        X: =532.1458333333333
                        ZIndex: =3

                    SizeAttIssuer_1 As label:
                        Font: =Font.Arial
                        FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                        Height: =listAttachFileItems_1.TemplateHeight
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        Size: =10.5
                        Text: =ThisItem.Size
                        Width: =50
                        X: =449
                        ZIndex: =4

                    FileName_Link_1 As button:
                        Align: =Align.Left
                        BorderThickness: =0
                        Color: =RGBA(0, 0, 0, 1)
                        DisabledFill: =Self.Fill
                        DisplayMode: =If("DOWNLOADFILE" in LookUp(currenUserV2.permissionList, process_code = "Process4", action), DisplayMode.Edit, DisplayMode.Disabled)
                        Fill: =RGBA(0, 0, 0, 0)
                        FocusedBorderThickness: =0
                        Font: =Font.Arial
                        FontWeight: =FontWeight.Lighter
                        Height: =listAttachFileItems_1.TemplateHeight
                        HoverColor: =RGBA(56, 96, 178, 1)
                        HoverFill: =Self.Fill
                        OnSelect: |-
                            =If("DOWNLOADFILE" in LookUp(currenUserV2.permissionList, process_code = "Process4", action),
                            Set(urlML,'TVS->DownloadFileExpTime-V1'.Run(bucketMargin, ThisItem.Name).url);
                            Launch(urlML))
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        PressedBorderColor: =Self.Color
                        PressedColor: =Self.Color
                        PressedFill: =Self.Fill
                        Size: =10.5
                        Text: |-
                            =If(App.Width > 800, ThisItem.Name, If(Len(If(IsBlank(ThisItem.Name), If(IsBlank(ThisItem.Name), "", ThisItem.Name), ThisItem.Name)) > 50,
                                Left(If(IsBlank(ThisItem.Name), If(IsBlank(ThisItem.Name), "", ThisItem.Name), ThisItem.Name), 50) & "...",
                                If(IsBlank(ThisItem.Name), If(IsBlank(ThisItem.Name), "", ThisItem.Name), ThisItem.Name)
                            ))
                        Visible: =!(IsBlank(proposalInfoEdit) && IsBlank(IdCreateProposal))
                        Width: =Parent.Width - RemoveAttachmentIcon_1.Width - CreatedDate_Text_1.Width - 40
                        X: =HtmlText7_12.X + HtmlText7_12.Width
                        ZIndex: =5

                    RemoveAttachmentIcon_1 As icon.Cancel:
                        Color: =RGBA(0, 0, 0, 1)
                        FocusedBorderThickness: =3
                        Height: =18
                        Icon: =Icon.Cancel
                        OnSelect: |-
                            =Patch(listAttachFile, ThisItem, {IsDeleted: true});
                            If(!IsBlank(ThisItem.Id),Collect(listAttachDelete, ThisItem));
                        Visible: =Note_Input_1.DisplayMode = DisplayMode.Edit
                        Width: =18
                        X: =Parent.Width - 20
                        Y: =If(App.Width > 600, 15, 15)
                        ZIndex: =7

                    CreatedDate_Text_1 As label:
                        Align: =Align.Right
                        Font: =Font.Arial
                        Height: =FileName_Link_1.Height
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingRight: =10
                        PaddingTop: =0
                        Size: =10.5
                        Text: =ThisItem.By
                        Width: =If(App.Width > 1300, 120, 0)
                        X: =FileName_Link_1.X + FileName_Link_1.Width
                        ZIndex: =9

                AttachmentLabel_4 As label:
                    Color: =RGBA(14, 63, 115, 1)
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Bold
                    PaddingLeft: =0
                    Size: =10.5
                    Text: ="Attachment"
                    Visible: =DealDetailTab = 1
                    Width: =130
                    X: =Note_Input_1.X
                    Y: =Note_Input_1.Y + Note_Input_1.Height + 10
                    ZIndex: =10

                AttachmentIcon_1 As htmlViewer:
                    Font: =Font.Arial
                    HtmlText: |-
                        ="<svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                          <path d=""M18.0204 5.16384C17.2691 4.41686 16.2539 3.99591 15.1945 3.99217C14.1351 3.98842 13.1169 4.40219 12.3604 5.14384L5.70036 11.6878C5.51152 11.8738 5.25671 11.9773 4.99171 11.9758C4.7267 11.9743 4.47309 11.8679 4.28636 11.6798C4.19407 11.5868 4.12109 11.4764 4.07161 11.3551C4.02213 11.2337 3.99714 11.1038 3.99807 10.9728C3.999 10.8417 4.02583 10.7122 4.07703 10.5915C4.12822 10.4709 4.20276 10.3616 4.29636 10.2698L10.9544 3.72784C12.0871 2.61594 13.6124 1.99516 15.1997 2.00003C16.787 2.0049 18.3084 2.63501 19.4344 3.75384C19.9929 4.30904 20.4362 4.96921 20.7387 5.69635C21.0412 6.4235 21.1969 7.20329 21.1969 7.99084C21.1969 8.7784 21.0412 9.55818 20.7387 10.2853C20.4362 11.0125 19.9929 11.6726 19.4344 12.2278L10.7704 20.8558C10.0337 21.5881 9.03711 21.9992 7.99836 21.9992C6.95961 21.9992 5.96306 21.5881 5.22636 20.8558C4.86251 20.494 4.57377 20.0638 4.37674 19.5899C4.17972 19.1161 4.07829 18.608 4.07829 18.0948C4.07829 17.5817 4.17972 17.0736 4.37674 16.5997C4.57377 16.1259 4.86251 15.6957 5.22636 15.3338L13.3064 7.28784C13.4941 7.10147 13.7478 6.99687 14.0124 6.99687C14.2769 6.99687 14.5307 7.10147 14.7184 7.28784C14.811 7.38018 14.8845 7.4899 14.9347 7.61071C14.9848 7.73152 15.0106 7.86104 15.0106 7.99184C15.0106 8.12265 14.9848 8.25216 14.9347 8.37297C14.8845 8.49378 14.811 8.6035 14.7184 8.69584L6.64036 16.7418C6.46203 16.9192 6.32052 17.13 6.22395 17.3622C6.12738 17.5944 6.07767 17.8434 6.07767 18.0948C6.07767 18.3463 6.12738 18.5953 6.22395 18.8275C6.32052 19.0597 6.46203 19.2705 6.64036 19.4478C7.0014 19.8079 7.49048 20.0101 8.00036 20.0101C8.51024 20.0101 8.99932 19.8079 9.36036 19.4478L18.0204 10.8198C18.3931 10.4492 18.6889 10.0086 18.8907 9.52325C19.0926 9.03792 19.1965 8.51747 19.1965 7.99184C19.1965 7.46621 19.0926 6.94576 18.8907 6.46043C18.6889 5.9751 18.3931 5.53445 18.0204 5.16384Z"" fill=""#606060""/>
                        </svg>"
                    OnSelect: =Select(AttachFile_7)
                    Visible: =false
                    Width: =40
                    X: =AttachmentLabel_4.X + AttachmentLabel_4.Width - 40
                    Y: =AttachmentLabel_4.Y + 5
                    ZIndex: =11

            StockGroup As group:
                Height: =5
                Width: =5
                X: =40
                Y: =-40
                ZIndex: =65

                ProposalInformation_ML As label:
                    Color: =RGBA(14, 63, 115, 1)
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Bold
                    Size: =10.5
                    Text: ="Basic information of client"
                    Visible: |-
                        =// DealDetailTab = 1 && (marginLimitType <> "One Client")
                        DealDetailTab = 1
                    Width: =285
                    X: =QT2Tabs_10.X
                    Y: =QT2Tabs_10.Y + QT2Tabs_10.Height + 6
                    ZIndex: =19

                InMarginPolicyCheckbox As checkbox:
                    CheckboxBorderColor: =RGBA(109, 109, 109, 1)
                    CheckboxSize: =33
                    Default: =If(IsBlank(marginDetail1), true, If(First(marginDetail1.proposal).policy_list_check = "1" ,true,false))
                    DisabledColor: =RGBA(0, 0, 0, 1)
                    DisplayMode: |-
                        =If((marginDetail.status in ["DRAFT"] || IsBlank(marginDetail.status)) && "BROKER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action),
                        DisplayMode.Edit,
                        DisplayMode.Disabled)
                    FocusedBorderThickness: =0
                    Font: =Font.Arial
                    OnUncheck: |-
                        =Reset(MarginRatioCheckbox);
                        Reset(MarginedAmtPerClientCheckbox);
                        Reset(MarginedAmtAllClientCheckbox);
                    Size: =10.5
                    Text: ="In margin policy list"
                    Visible: =DealDetailTab = 1 && marginLimitType <> "One Client"
                    Width: =200
                    X: =ProposalInformation_ML.X
                    Y: =ProposalInformation_ML.Y + ProposalInformation_ML.Height
                    ZIndex: =20

                ProposalInformation_ML_1 As label:
                    Color: =RGBA(14, 63, 115, 1)
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Bold
                    Size: =10.5
                    Text: ="Scope of Proposal"
                    Visible: =DealDetailTab = 1 && marginLimitType <> "One Client"
                    Width: =285
                    X: =InMarginPolicyCheckbox.X
                    Y: =InMarginPolicyCheckbox.Y + InMarginPolicyCheckbox.Height
                    ZIndex: =21

                MarginRatioCheckbox As checkbox:
                    CheckboxBorderColor: =RGBA(109, 109, 109, 1)
                    CheckboxSize: =33
                    Default: =If(IsBlank(marginDetail1),true,If(First(marginDetail1.proposal).margin_ratio_check = "1" ,true,false))
                    DisabledColor: =RGBA(0, 0, 0, 1)
                    DisplayMode: |-
                        =If((marginDetail.status in ["DRAFT"] || IsBlank(marginDetail.status)) && "BROKER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) && InMarginPolicyCheckbox.Value,
                        DisplayMode.Edit,
                        DisplayMode.Disabled)
                    FocusedBorderThickness: =0
                    Font: =Font.Arial
                    Size: =10.5
                    Text: ="Margin Ratio"
                    Visible: =DealDetailTab = 1 && marginLimitType <> "One Client"
                    Width: =200
                    X: =ProposalInformation_ML.X
                    Y: =ProposalInformation_ML_1.Y + ProposalInformation_ML_1.Height
                    ZIndex: =22

                MarginedAmtPerClientCheckbox As checkbox:
                    CheckboxBorderColor: =RGBA(109, 109, 109, 1)
                    CheckboxSize: =33
                    Default: =If(IsBlank(marginDetail1),true,If(First(marginDetail1.proposal).margined_amt_per_client_check = "1" ,true,false))
                    DisabledColor: =RGBA(0, 0, 0, 1)
                    DisplayMode: |-
                        =If((marginDetail.status in ["DRAFT"] || IsBlank(marginDetail.status)) && "BROKER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) && InMarginPolicyCheckbox.Value,
                        DisplayMode.Edit,
                        DisplayMode.Disabled)
                    FocusedBorderThickness: =0
                    Font: =Font.Arial
                    Size: =10.5
                    Text: ="Margined Amt Per Client"
                    Visible: =DealDetailTab = 1 && marginLimitType <> "One Client"
                    Width: =200
                    X: =ProposalInformation_ML.X
                    Y: =MarginRatioCheckbox.Y + MarginRatioCheckbox.Height
                    ZIndex: =23

                MarginedAmtAllClientCheckbox As checkbox:
                    CheckboxBorderColor: =RGBA(109, 109, 109, 1)
                    CheckboxSize: =33
                    Default: =If(IsBlank(marginDetail1),true,If(First(marginDetail1.proposal).margined_amt_all_client_check = "1" ,true,false))
                    DisabledColor: =RGBA(0, 0, 0, 1)
                    DisplayMode: |-
                        =If((marginDetail.status in ["DRAFT"] || IsBlank(marginDetail.status)) && "BROKER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) && InMarginPolicyCheckbox.Value,
                        DisplayMode.Edit,
                        DisplayMode.Disabled)
                    FocusedBorderThickness: =0
                    Font: =Font.Arial
                    Size: =10.5
                    Text: ="Margined Amt All Client"
                    Visible: =DealDetailTab = 1 && marginLimitType <> "One Client"
                    Width: =200
                    X: =ProposalInformation_ML.X
                    Y: =MarginedAmtPerClientCheckbox.Y + MarginedAmtPerClientCheckbox.Height
                    ZIndex: =24

                Container5_6 As groupContainer.verticalAutoLayoutContainer:
                    DropShadow: =DropShadow.None
                    Height: =Container6_10.Height + 15
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMode: =LayoutMode.Auto
                    LayoutOverflowX: =LayoutOverflow.Scroll
                    LayoutOverflowY: =LayoutOverflow.Scroll
                    Visible: =InMarginPolicyCheckbox.Value && DealDetailTab = 1 && false 
                    Width: =White_Background_10.Width - If(App.Width > 800, 60, 50)
                    X: =MarginedAmtAllClientCheckbox.X
                    Y: =MarginedAmtAllClientCheckbox.Y + MarginedAmtAllClientCheckbox.Height
                    ZIndex: =25

                    Container6_10 As groupContainer.manualLayoutContainer:
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =Gallery8_10.Height + 60
                        LayoutMinHeight: =Gallery8_10.Height + 60
                        LayoutMinWidth: =layout_MaxPctAll_2.X + layout_MaxPctAll_2.Width + 20
                        ZIndex: =2

                        layout_ticker_2 As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =42
                            Visible: =DealDetailTab = 1
                            Width: =100
                            ZIndex: =1

                        layout_maxQtyPer_2 As rectangle:
                            BorderColor: =RGBA(191, 191, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =42
                            Visible: =DealDetailTab = 1
                            Width: =If(MarginRatioCheckbox.Value, 250, 0)
                            X: =layout_ticker_2.X + layout_ticker_2.Width
                            Y: =layout_ticker_2.Y
                            ZIndex: =5

                        layout_MaxPctPer_2 As rectangle:
                            BorderColor: =RGBA(191, 191, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =42
                            Visible: =DealDetailTab = 1
                            Width: =If(MarginedAmtPerClientCheckbox.Value, 250, 0)
                            X: =layout_maxQtyPer_2.X + layout_maxQtyPer_2.Width
                            Y: =layout_ticker_2.Y
                            ZIndex: =6

                        layout_MaxPctAll_2 As rectangle:
                            BorderColor: =RGBA(191, 191, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =42
                            Visible: =DealDetailTab = 1
                            Width: =If(MarginedAmtAllClientCheckbox.Value, 250, 0)
                            X: =layout_MaxPctPer_2.X + layout_MaxPctPer_2.Width
                            Y: =layout_ticker_2.Y
                            ZIndex: =7

                        label_ticker_2 As label:
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Bold
                            Height: =42
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =If(Parent.Width > 600, 10.5, 9)
                            Text: ="Ticker"
                            Visible: =DealDetailTab = 1
                            Width: =layout_ticker_2.Width
                            X: =layout_ticker_2.X
                            Y: =layout_ticker_2.Y
                            ZIndex: =8

                        label_maxQtyPer_2 As label:
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Bold
                            Height: =42
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =If(Parent.Width > 600, 10.5, 9)
                            Text: ="Max Margined Qty Per Client"
                            Visible: =DealDetailTab = 1
                            Width: =layout_maxQtyPer_2.Width
                            X: =layout_maxQtyPer_2.X
                            Y: =layout_maxQtyPer_2.Y
                            ZIndex: =12

                        label_maxPctPer_2 As label:
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Bold
                            Height: =42
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =If(Parent.Width > 600, 10.5, 9)
                            Text: ="Max Margined Loan Pct Per Client"
                            Visible: =DealDetailTab = 1
                            Width: =layout_MaxPctPer_2.Width
                            X: =layout_MaxPctPer_2.X
                            Y: =layout_MaxPctPer_2.Y
                            ZIndex: =13

                        label_maxPctAll_2 As label:
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Bold
                            Height: =42
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =If(Parent.Width > 600, 10.5, 9)
                            Text: ="Max Margined Loan Pct All Client"
                            Visible: =DealDetailTab = 1
                            Width: =layout_MaxPctAll_2.Width
                            X: =layout_MaxPctAll_2.X
                            Y: =layout_MaxPctAll_2.Y
                            ZIndex: =14

                        "Gallery8_10 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                            '#CopilotOverlayLabel': ="Filtered"
                            Height: =If(Self.AllItemsCount * Self.TemplateHeight > (Self.TemplateHeight * If(App.Width > 600, 8, 6)), (Self.TemplateHeight * If(App.Width > 600, 8, 6)), Self.AllItemsCount * Self.TemplateHeight)
                            Items: =listMarginPolicyInput
                            Layout: =Layout.Vertical
                            TemplatePadding: =0
                            TemplateSize: =If(App.Width > 600, 50, 70)
                            Visible: =DealDetailTab = 1
                            Width: =layout_MaxPctAll_2.X + layout_MaxPctAll_2.Width + 20
                            Y: =layout_ticker_2.Y + layout_ticker_2.Height
                            ZIndex: =15

                            layout_tickerFor_2 As rectangle:
                                BorderColor: =RGBA(192, 192, 192, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =Gallery8_10.TemplateHeight
                                Visible: =DealDetailTab = 1
                                Width: =layout_ticker_2.Width
                                ZIndex: =1

                            layout_maxQtyPerFor_2 As rectangle:
                                BorderColor: =RGBA(191, 191, 192, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =Gallery8_10.TemplateHeight
                                Visible: =DealDetailTab = 1
                                Width: =layout_maxQtyPer_2.Width 
                                X: =layout_tickerFor_2.X + layout_tickerFor_2.Width
                                Y: =layout_tickerFor_2.Y
                                ZIndex: =5

                            layout_maxPctPerFor_2 As rectangle:
                                BorderColor: =RGBA(191, 191, 192, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =Gallery8_10.TemplateHeight
                                Visible: =DealDetailTab = 1
                                Width: =layout_MaxPctPer_2.Width 
                                X: =layout_maxQtyPerFor_2.X + layout_maxQtyPerFor_2.Width
                                Y: =layout_tickerFor_2.Y
                                ZIndex: =6

                            layout_MaxPctAllFor_2 As rectangle:
                                BorderColor: =RGBA(191, 191, 192, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =Gallery8_10.TemplateHeight
                                Visible: =DealDetailTab = 1
                                Width: =layout_MaxPctAll_2.Width 
                                X: =layout_maxPctPerFor_2.X + layout_maxPctPerFor_2.Width
                                Y: =layout_tickerFor_2.Y
                                ZIndex: =7

                            label_tickerFor_2 As label:
                                Font: =Font.Arial
                                Height: =Gallery8_10.TemplateHeight
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                Size: =If(Parent.Width > 600, 10.5, 9)
                                Text: =ThisItem.stock_id
                                Visible: =DealDetailTab = 1
                                Width: =layout_tickerFor_2.Width
                                X: =layout_tickerFor_2.X
                                Y: =layout_tickerFor_2.Y
                                ZIndex: =8

                            label_maxQtyPerFor_2 As label:
                                Font: =Font.Arial
                                Height: =Gallery8_10.TemplateHeight
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                Size: =If(Parent.Width > 600, 10.5, 9)
                                Text: =ThisItem.max_margined_quantity_per_client
                                Visible: =DealDetailTab = 1
                                Width: =layout_maxQtyPerFor_2.Width
                                X: =layout_maxQtyPerFor_2.X
                                Y: =layout_maxQtyPerFor_2.Y
                                ZIndex: =12

                            label_maxPctPerFor_2 As label:
                                Font: =Font.Arial
                                Height: =Gallery8_10.TemplateHeight
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                Size: =If(Parent.Width > 600, 10.5, 9)
                                Text: =ThisItem.max_margined_amt_per_client
                                Visible: =DealDetailTab = 1
                                Width: =layout_maxPctPerFor_2.Width
                                X: =layout_maxPctPerFor_2.X
                                Y: =layout_maxPctPerFor_2.Y
                                ZIndex: =13

                            label_maxPctAllFor_2 As label:
                                Font: =Font.Arial
                                Height: =Gallery8_10.TemplateHeight
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                Size: =If(Parent.Width > 600, 10.5, 9)
                                Text: =ThisItem.max_margined_amt_all_client
                                Visible: =DealDetailTab = 1
                                Width: =layout_MaxPctAllFor_2.Width
                                X: =layout_MaxPctAllFor_2.X
                                Y: =layout_MaxPctAllFor_2.Y
                                ZIndex: =14

            OneClientGroup As group:
                Height: =5
                Width: =5
                X: =40
                Y: =-40
                ZIndex: =67

                ClientID_Label As label:
                    Font: =Font.Arial
                    Height: =42
                    Size: =10.5
                    Text: ="Client ID"
                    Visible: =DealDetailTab = 1 && marginLimitType = "One Client"
                    Width: =120
                    X: =ProposalInformation_ML.X
                    Y: =ProposalInformation_ML.Y + ProposalInformation_ML.Height + 10
                    ZIndex: =12

                ClientID_Input As text:
                    BorderColor: =If(IsBlank(Self.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                    BorderThickness: =If(Self.DisplayMode = DisplayMode.Disabled, 0, 1)
                    Default: =If(IsBlank(marginDetail1), "", First(marginDetail1.proposal).client_id)
                    DisabledColor: =RGBA(0, 0, 0, 1)
                    DisplayMode: =If(IsBlank(marginDetail.status) || marginDetail.status in ["DRAFT"] && (isBrokerage), DisplayMode.Edit, DisplayMode.Disabled)
                    FocusedBorderColor: =RGBA(0, 18, 107, 1)
                    FocusedBorderThickness: =If(Self.DisplayMode = DisplayMode.Disabled, 0, 1)
                    Font: =Font.Arial
                    Height: =ClientID_Label.Height
                    HoverFill: =RGBA(186, 202, 226, 0)
                    PressedBorderColor: =RGBA(0, 18, 107, 1)
                    Size: =If(App.Width > 600, 10.5, 12)
                    Visible: =DealDetailTab = 1 && marginLimitType = "One Client"
                    Width: =If(App.Width > 800, (WhiteBackground_6.Width - 120) * 1/5 + 20, CompanyName_Input.Width)
                    X: =ClientID_Label.X + ClientID_Label.Width
                    Y: =ClientID_Label.Y
                    ZIndex: =13

                CompanyName_Label As label:
                    Font: =Font.Arial
                    Height: =42
                    Size: =10.5
                    Text: ="Client name"
                    Visible: =DealDetailTab = 1 && marginLimitType = "One Client"
                    Width: =120
                    X: =ProposalInformation_ML.X
                    Y: =ClientID_Input.Y + ClientID_Input.Height + 10
                    ZIndex: =14

                CompanyName_Input As text:
                    BorderColor: =If(IsBlank(Self.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                    BorderThickness: =If(Self.DisplayMode = DisplayMode.Disabled, 0, 1)
                    Default: =If(IsBlank(marginDetail1), "", First(marginDetail1.proposal).company_name)
                    DisabledColor: =RGBA(0, 0, 0, 1)
                    DisplayMode: =ClientID_Input.DisplayMode
                    FocusedBorderColor: =RGBA(0, 18, 107, 1)
                    FocusedBorderThickness: =If(Self.DisplayMode = DisplayMode.Disabled, 0, 1)
                    Font: =Font.Arial
                    Height: =CompanyName_Label.Height
                    HoverFill: =RGBA(186, 202, 226, 0)
                    PressedBorderColor: =RGBA(0, 18, 107, 1)
                    Size: =If(App.Width > 600, 10.5, 12)
                    Visible: =DealDetailTab = 1 && marginLimitType = "One Client"
                    Width: =White_Background_10.Width - CompanyName_Label.Width - If(App.Width > 600, 75, 50)
                    X: =CompanyName_Label.X + CompanyName_Label.Width
                    Y: =CompanyName_Label.Y
                    ZIndex: =15

                ProposalInformation As label:
                    Color: =RGBA(14, 63, 115, 1)
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Bold
                    Size: =10.5
                    Text: ="Proposal information"
                    Visible: =DealDetailTab = 1 && marginLimitType = "One Client"
                    Width: =285
                    X: =QT2Tabs_10.X
                    Y: =CompanyName_Input.Y + CompanyName_Input.Height + 10
                    ZIndex: =16

                CloseDropdown_ParentOneClient As rectangle:
                    Fill: =RGBA(255, 255, 255, 0)
                    Height: =Parent.Height
                    OnSelect: =Select(CloseDropdown_InContainer_1)
                    Visible: =CloseDropdown_InContainer_1.Visible && marginType = "One Client"
                    Width: =Parent.Width
                    X: =40
                    Y: =40
                    ZIndex: =17

                ML_Table As groupContainer.horizontalAutoLayoutContainer:
                    DropShadow: =DropShadow.None
                    Height: =PML_InputBack.Y + PML_InputBack.Height + 20
                    LayoutMode: =LayoutMode.Auto
                    LayoutOverflowX: =LayoutOverflow.Scroll
                    RadiusBottomLeft: =0
                    RadiusBottomRight: =0
                    RadiusTopLeft: =0
                    RadiusTopRight: =0
                    Visible: =DealDetailTab = 1 && marginLimitType = "One Client"
                    Width: =CompanyName_Input.Width + CompanyName_Input.X - Self.X
                    X: =Label_billion.X + 5
                    Y: =Label_billion.Y + Label_billion.Height + 10
                    ZIndex: =18

                    Container9_1 As groupContainer.manualLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        LayoutMinHeight: =PML_InputBack.Y + PML_InputBack.Height
                        LayoutMinWidth: =250
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Width: =RiskManagementOpinionBack.X + RiskManagementOpinionBack.Width
                        ZIndex: =4

                        TableBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =PML_InputBack.Y + PML_InputBack.Height
                            Visible: =DealDetailTab = 1
                            Width: =Cmt_Input.X + Cmt_Input.Width - 2
                            X: =CurrentPolicyBack.X + 1
                            Y: =CurrentPolicyBack.Y + 1
                            ZIndex: =1

                        CurrentPolicyBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =44
                            Visible: =DealDetailTab = 1
                            Width: =200
                            ZIndex: =2

                        BrokerageProposalBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =44
                            Visible: =DealDetailTab = 1
                            Width: =450
                            X: =CurrentPolicyBack.X + CurrentPolicyBack.Width
                            Y: =CurrentPolicyBack.Y
                            ZIndex: =3

                        RiskManagementOpinionBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =44
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =If(Self.Visible, 900, 0)
                            X: =BrokerageProposalBack.X + BrokerageProposalBack.Width
                            Y: =BrokerageProposalBack.Y
                            ZIndex: =4

                        MaxMLBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =DealDetailTab = 1
                            Width: =CurrentPolicyBack.Width
                            Y: =CurrentPolicyBack.Y + CurrentPolicyBack.Height
                            ZIndex: =5

                        ProposalMLBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =DealDetailTab = 1
                            Width: =BrokerageProposalBack.Width / 2
                            X: =MaxMLBack.X + MaxMLBack.Width
                            Y: =MaxMLBack.Y
                            ZIndex: =6

                        ProposalInterestRateBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =DealDetailTab = 1
                            Width: =BrokerageProposalBack.Width / 2
                            X: =ProposalMLBack.X + ProposalMLBack.Width
                            Y: =ProposalMLBack.Y
                            ZIndex: =7

                        RMOBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =If(Self.Visible, RiskManagementOpinionBack.Width /4, 0)
                            X: =ProposalInterestRateBack.X + ProposalInterestRateBack.Width
                            Y: =MaxMLBack.Y
                            ZIndex: =8

                        PMLBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =RMOBack.X + RMOBack.Width
                            Y: =RMOBack.Y
                            ZIndex: =9

                        MaxML_InputBack As rectangle:
                            BorderColor: =If(IsBlank(MaxML_Input.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =DealDetailTab = 1
                            Width: =CurrentPolicyBack.Width
                            Y: =MaxMLBack.Y + MaxMLBack.Height
                            ZIndex: =10

                        ProposalML_InputBack As rectangle:
                            BorderColor: =If((IsBlank(ProposalML_Input.Text) || Value(ProposalML_Input.Text) > (Value(equityAmountFormatted) * 0.03)) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =DealDetailTab = 1
                            Width: =BrokerageProposalBack.Width / 2
                            X: =MaxML_InputBack.X + MaxML_InputBack.Width
                            Y: =MaxML_InputBack.Y
                            ZIndex: =11

                        ProposalInterestRate_InputBack As rectangle:
                            BorderColor: =If(IsBlank(ProposalInterestRate_Input.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =DealDetailTab = 1
                            Width: =BrokerageProposalBack.Width / 2
                            X: =ProposalML_InputBack.X + ProposalML_InputBack.Width
                            Y: =ProposalML_InputBack.Y
                            ZIndex: =12

                        RMO_InputBack As rectangle:
                            BorderColor: =If(IsBlank(DropdownOneClientRMOOp.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =ProposalInterestRate_InputBack.X + ProposalInterestRate_InputBack.Width
                            Y: =MaxML_InputBack.Y
                            ZIndex: =13

                        PML_InputBack As rectangle:
                            BorderColor: =If((IsBlank(PML_Input.Text) || (typeOneClient && Value(PML_Input.Text) > (Value(equityAmountFormatted) * 0.03))) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =RMO_InputBack.X + RMO_InputBack.Width
                            Y: =RMO_InputBack.Y
                            ZIndex: =14

                        PIRBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =PMLBack.X + PMLBack.Width
                            Y: =MaxMLBack.Y
                            ZIndex: =15

                        PIR_InputBack As rectangle:
                            BorderColor: =If(IsBlank(PIR_Input.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =PML_InputBack.X + PML_InputBack.Width
                            Y: =RMO_InputBack.Y
                            ZIndex: =16

                        Cmt_Back As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width - 0.5
                            X: =PIRBack.X + PIRBack.Width
                            Y: =MaxMLBack.Y
                            ZIndex: =17

                        Cmt_InputBack As rectangle:
                            BorderColor: =RGBA(192, 192, 192, 1)
                            BorderThickness: =0.5
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width - 0.5
                            X: =PIR_InputBack.X + PIR_InputBack.Width
                            Y: =RMO_InputBack.Y
                            ZIndex: =18

                        CurrentPolicy_Label As label:
                            Align: =Align.Center
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Semibold
                            Height: =CurrentPolicyBack.Height - 2
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Current policy"
                            Visible: =DealDetailTab = 1
                            Width: =CurrentPolicyBack.Width - 2
                            X: =CurrentPolicyBack.X + 1
                            Y: =CurrentPolicyBack.Y + 1
                            ZIndex: =19

                        BrokerageProposal_Label As label:
                            Align: =Align.Center
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Semibold
                            Height: =BrokerageProposalBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Brokerages Proposal"
                            Visible: =DealDetailTab = 1
                            Width: =BrokerageProposalBack.Width
                            X: =BrokerageProposalBack.X
                            Y: =BrokerageProposalBack.Y
                            ZIndex: =20

                        RiskManagementOpinion_Label As label:
                            Align: =Align.Center
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Semibold
                            Height: =RiskManagementOpinionBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Risk Management's Opinion"
                            Visible: =DealDetailTab = 1 && (!(marginDetail.status in ["DRAFT"] || IsBlank(marginDetail.status)) && If(marginDetail.status in ["APPROVED"], !IsBlank(First(marginDetail1.brokerage).proposed_margin_limit_amount_rm) && Value(First(marginDetail1.brokerage).proposed_margin_limit_amount) > 4 , true))
                            Width: =RiskManagementOpinionBack.Width
                            X: =RiskManagementOpinionBack.X
                            Y: =RiskManagementOpinionBack.Y
                            ZIndex: =21

                        MaxML_Label As label:
                            Font: =Font.Arial
                            Height: =MaxMLBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Max Margin Limit (Amount)"
                            Visible: =DealDetailTab = 1
                            Width: =MaxMLBack.Width
                            X: =MaxMLBack.X
                            Y: =MaxMLBack.Y
                            ZIndex: =22

                        ProposalML_Label As label:
                            Font: =Font.Arial
                            Height: =ProposalMLBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Proposed Margin Limit (Amount)"
                            Visible: =DealDetailTab = 1
                            Width: =ProposalMLBack.Width
                            X: =ProposalMLBack.X
                            Y: =ProposalMLBack.Y
                            ZIndex: =23

                        ProposalInterestRate_Label As label:
                            Font: =Font.Arial
                            Height: =ProposalInterestRateBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Proposed Interest rate"
                            Visible: =DealDetailTab = 1
                            Width: =ProposalInterestRateBack.Width
                            X: =ProposalInterestRateBack.X
                            Y: =ProposalInterestRateBack.Y
                            ZIndex: =24

                        RMO_Label As label:
                            Font: =Font.Arial
                            Height: =RMOBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Risk Managements Opinion"
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =RMOBack.X
                            Y: =RMOBack.Y
                            ZIndex: =25

                        PML_Label As label:
                            Font: =Font.Arial
                            Height: =PMLBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Proposed Margin Limit (Amount)"
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =PMLBack.X + 1
                            Y: =PMLBack.Y
                            ZIndex: =26

                        PIR_Label As label:
                            Font: =Font.Arial
                            Height: =PIRBack.Height
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Proposed Interest rate"
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width
                            X: =PIRBack.X
                            Y: =PIRBack.Y
                            ZIndex: =27

                        Cmt_Label As label:
                            Font: =Font.Arial
                            Height: =Cmt_Back.Height - 1
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Size: =10.5
                            Text: ="Comment"
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width - 1
                            X: =Cmt_Back.X - 0.5
                            Y: =Cmt_Back.Y - 0.5
                            ZIndex: =28

                        MaxML_Input As text:
                            Align: =Align.Right
                            BorderColor: =If(IsBlank(MaxML_Input.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0
                            Default: =maxMarginLimitAmount
                            DisabledColor: =RGBA(0, 0, 0, 1)
                            DisplayMode: =ClientID_Input.DisplayMode
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderColor: =RGBA(0, 18, 107, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.Arial
                            Height: =MaxML_InputBack.Height - 2
                            HoverFill: =
                            OnChange: |-
                                =Set(OriginalText, Substitute(Self.Text, ",", ""));
                                Set(FirstDotIndex, Find(".", OriginalText));
                                Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));
                                Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));
                                
                                Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
                                If(!IsNumeric(ModifiedText), Substitute(Self.Text, Self.Text, ""); Reset(Self);
                                Set(maxMarginLimitAmount, Blank()), Set(maxMarginLimitAmount, If(StartsWith(Trim(ModifiedText), "."), "0"&Trim(ModifiedText), Trim(ModifiedText))));
                                Reset(Self);
                            PaddingRight: =12
                            PaddingTop: =5.27
                            PressedBorderColor: =RGBA(0, 18, 107, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =If(App.Width > 600, 10.5, 12)
                            Visible: =DealDetailTab = 1
                            Width: =MaxML_InputBack.Width - 2
                            X: =MaxML_InputBack.X + 1
                            Y: =MaxML_InputBack.Y + 1
                            ZIndex: =29

                        ProposalML_Input As text:
                            Align: =Align.Right
                            BorderColor: =
                            BorderThickness: =0
                            Default: =proposedMarginLimitAmount
                            DisabledColor: =RGBA(0, 0, 0, 1)
                            DisplayMode: =MaxML_Input.DisplayMode
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderColor: =RGBA(0, 18, 107, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.Arial
                            Height: =ProposalML_InputBack.Height - 2
                            HoverFill: =
                            OnChange: |-
                                =Set(OriginalText, Substitute(Self.Text, ",", ""));
                                Set(FirstDotIndex, Find(".", OriginalText));
                                Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));
                                Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));
                                
                                Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
                                If(!IsNumeric(ModifiedText), Substitute(Self.Text, Self.Text, ""); Reset(Self);
                                Set(proposedMarginLimitAmount, Blank()), Set(proposedMarginLimitAmount, If(StartsWith(Trim(ModifiedText), "."), "0"&Trim(ModifiedText), Trim(ModifiedText))));
                                Reset(Self);
                            PaddingRight: =12
                            PaddingTop: =5.27
                            PressedBorderColor: =RGBA(0, 18, 107, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =If(App.Width > 600, 10.5, 12)
                            Visible: =DealDetailTab = 1
                            Width: =ProposalML_InputBack.Width - 2
                            X: =ProposalML_InputBack.X + 1
                            Y: =ProposalML_InputBack.Y + 1
                            ZIndex: =30

                        ProposalInterestRate_Input As text:
                            Align: =Align.Right
                            BorderColor: =If(IsBlank(ProposalInterestRate_Input.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0
                            Default: =proposedInterestRateBr
                            DisabledColor: =RGBA(0, 0, 0, 1)
                            DisplayMode: =MaxML_Input.DisplayMode
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderColor: =RGBA(0, 18, 107, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.Arial
                            Height: =ProposalInterestRate_InputBack.Height - 2
                            HoverFill: =
                            OnChange: |-
                                =Set(listToChanged, true);
                                Set(numbericProposalInterestRateInput, Text(ProposalInterestRate_Input.Text));
                                
                                Set(OriginalText_OC_BR, Substitute(Self.Text, ",", ""));
                                Set(FirstDotIndex_OC_BR, Find(".", OriginalText_OC_BR));
                                Set(TextBeforeFirstDot_OC_BR, Left(OriginalText_OC_BR, FirstDotIndex_OC_BR));
                                Set(TextAfterFirstDot_OC_BR, Mid(OriginalText_OC_BR, FirstDotIndex_OC_BR + 1, Len(OriginalText_OC_BR) - FirstDotIndex_OC_BR));
                                
                                Set(ModifiedText_OC_BR, TextBeforeFirstDot_OC_BR & Substitute(TextAfterFirstDot_OC_BR, ".", ""));
                                If(!IsNumeric(ModifiedText_OC_BR), Substitute(Self.Text, Self.Text, ""); Reset(Self);
                                Set(proposedInterestRateBr, Blank()), Set(proposedInterestRateBr, If(StartsWith(Trim(ModifiedText_OC_BR), "."), "0"&Trim(ModifiedText_OC_BR), Trim(ModifiedText_OC_BR))));
                                Reset(Self);
                            PaddingRight: =PecentIcon_8.Width
                            PaddingTop: =5.27
                            PressedBorderColor: =RGBA(0, 18, 107, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =If(App.Width > 600, 10.5, 12)
                            Visible: =DealDetailTab = 1
                            Width: =ProposalInterestRate_InputBack.Width - 2
                            X: =ProposalInterestRate_InputBack.X + 1
                            Y: =ProposalInterestRate_InputBack.Y + 1
                            ZIndex: =31

                        PML_Input As text:
                            Align: =Align.Right
                            BorderColor: =RGBA(191, 191, 192, 1)
                            BorderThickness: =0
                            Default: =proposedMarginLimitAmountRm
                            DisabledColor: =RGBA(0, 0, 0, 1)
                            DisplayMode: =DropdownOneClientRMOOp.DisplayMode
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderColor: =RGBA(0, 18, 107, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.Arial
                            Height: =PML_InputBack.Height - 2
                            HoverFill: =
                            OnChange: |-
                                =Set(OriginalText, Substitute(Self.Text, ",", ""));
                                Set(FirstDotIndex, Find(".", OriginalText));
                                Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));
                                Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));
                                
                                Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
                                If(!IsNumeric(ModifiedText), Substitute(Self.Text, Self.Text, ""); Reset(Self);
                                Set(proposedMarginLimitAmountRm, Blank()), Set(proposedMarginLimitAmountRm, If(StartsWith(Trim(ModifiedText), "."), "0"&Trim(ModifiedText), Trim(ModifiedText))));
                                Reset(Self);
                            PaddingRight: =12
                            PaddingTop: =5.27
                            PressedBorderColor: =RGBA(0, 18, 107, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =If(App.Width > 600, 10.5, 12)
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width - 1
                            X: =PML_InputBack.X + 1
                            Y: =PML_InputBack.Y + 1
                            ZIndex: =32

                        PIR_Input As text:
                            Align: =Align.Right
                            BorderColor: =If(IsBlank(PIR_Input.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0
                            Default: =proposedInterestRateRm
                            DisabledColor: =RGBA(0, 0, 0, 1)
                            DisplayMode: =DropdownOneClientRMOOp.DisplayMode
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderColor: =RGBA(0, 18, 107, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.Arial
                            Height: =RMO_InputBack.Height - 2
                            HoverFill: =
                            OnChange: |-
                                =Set(listToChanged, true);
                                Set(InvestmentMomoDefaultQT2, PIR_Input.Text);
                                
                                Set(OriginalText, Substitute(Self.Text, ",", ""));
                                Set(FirstDotIndex, Find(".", OriginalText));
                                Set(TextBeforeFirstDot, Left(OriginalText, FirstDotIndex));
                                Set(TextAfterFirstDot, Mid(OriginalText, FirstDotIndex + 1, Len(OriginalText) - FirstDotIndex));
                                
                                Set(ModifiedText, TextBeforeFirstDot & Substitute(TextAfterFirstDot, ".", ""));
                                If(!IsNumeric(ModifiedText), Substitute(Self.Text, Self.Text, ""); Reset(Self);
                                Set(proposedInterestRateRm, Blank()), Set(proposedInterestRateRm, If(StartsWith(Trim(ModifiedText), "."), "0"&Trim(ModifiedText), Trim(ModifiedText))));
                                Reset(Self);
                            PaddingRight: =PecentIcon_9.Width
                            PaddingTop: =5.27
                            PressedBorderColor: =RGBA(0, 18, 107, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =If(App.Width > 600, 10.5, 12)
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width - 1
                            X: =PIR_InputBack.X + 1
                            Y: =RMO_InputBack.Y + 1
                            ZIndex: =33

                        Cmt_Input As text:
                            BorderColor: =If(IsBlank(Cmt_Input.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
                            BorderThickness: =0
                            Default: =If(IsBlank(marginDetail1), "", First(marginDetail1.brokerage).comment_rm)
                            DisabledColor: =RGBA(0, 0, 0, 1)
                            DisplayMode: =DropdownOneClientRMOOp.DisplayMode
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderColor: =RGBA(0, 18, 107, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.Arial
                            Height: =RMO_InputBack.Height - 2
                            HoverFill: =
                            OnChange: |-
                                =Set(listToChanged, true);
                                Set(InvestmentMomoDefaultQT2, Cmt_Input.Text);
                            PaddingRight: =12
                            PaddingTop: =5.27
                            PressedBorderColor: =RGBA(0, 18, 107, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =If(App.Width > 600, 10.5, 12)
                            Tooltip: =If(IsBlank(marginDetail1), "", First(marginDetail1.brokerage).comment_rm)
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMOBack.Width - 2
                            X: =Cmt_InputBack.X + 1
                            Y: =RMO_InputBack.Y + 1
                            ZIndex: =34

                        DropdownOneClientRMOOp As button:
                            Align: =Align.Left
                            BorderColor: =If(reportWeekShowDropdown, RGBA(0, 18, 107, 1), ColorFade(Self.Fill, -15%))
                            BorderThickness: =0
                            Color: =RGBA(82, 82, 82, 1)
                            DisabledColor: =RGBA(0, 0, 0, 1)
                            DisplayMode: =If(marginDetail.status in ["PENDING_RISK_MANAGERMENTS_OPINION", "REVISED"] && isRiskManager, DisplayMode.Edit, DisplayMode.Disabled)
                            Fill: =RGBA(255, 255, 255, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.Arial
                            FontWeight: =FontWeight.Normal
                            Height: =RMO_InputBack.Height - 1
                            HoverColor: =RGBA(0, 0, 0, 1)
                            HoverFill: =RGBA(241, 244, 249, 1)
                            OnSelect: |-
                                =Set(ratioShowDropdown, !ratioShowDropdown);
                                ClearCollect(Count, [{Value: 0, next: true}]);
                                Set(IndexML, 1.3);
                            PaddingLeft: =15
                            PaddingRight: =40
                            PaddingTop: =5.27
                            PressedBorderColor: =
                            PressedColor: =
                            PressedFill: =
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =10.5
                            Text: =oneClientRMOption
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =RMO_InputBack.Width - 1
                            X: =RMO_InputBack.X + 0.5
                            Y: =RMO_InputBack.Y + 0.5
                            ZIndex: =35

                        iconDropdownRatioOp_1 As htmlViewer:
                            Fill: =RGBA(0, 0, 0, 0)
                            Font: =Font.Arial
                            Height: =42
                            HtmlText: |-
                                ="<div style=""cursor: pointer""><svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                                <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.7069 15.7071C12.5193 15.8946 12.265 15.9999 11.9999 15.9999C11.7347 15.9999 11.4804 15.8946 11.2929 15.7071L5.63585 10.0501C5.54034 9.95785 5.46416 9.84751 5.41175 9.7255C5.35934 9.6035 5.33176 9.47228 5.3306 9.3395C5.32945 9.20672 5.35475 9.07504 5.40503 8.95215C5.45531 8.82925 5.52957 8.7176 5.62346 8.6237C5.71735 8.52981 5.829 8.45556 5.9519 8.40528C6.0748 8.355 6.20648 8.32969 6.33926 8.33085C6.47204 8.332 6.60325 8.35959 6.72526 8.412C6.84726 8.46441 6.95761 8.54059 7.04985 8.6361L11.9999 13.5861L16.9499 8.6361C17.1385 8.45394 17.3911 8.35315 17.6533 8.35542C17.9155 8.3577 18.1663 8.46287 18.3517 8.64828C18.5371 8.83369 18.6423 9.0845 18.6445 9.3467C18.6468 9.60889 18.546 9.8615 18.3639 10.0501L12.7069 15.7071Z"" fill=""#525252""/>
                                </svg></div>"
                            OnSelect: =Select(DropdownOneClientRMOOp)
                            PaddingRight: =5.27
                            PaddingTop: =5.27
                            Size: =11.60
                            Visible: =RiskManagementOpinion_Label.Visible
                            Width: =35
                            X: =DropdownOneClientRMOOp.X + DropdownOneClientRMOOp.Width - 40
                            Y: =DropdownOneClientRMOOp.Y + 10
                            ZIndex: =36

                        CloseDropdown_InContainer_1 As rectangle:
                            Fill: =RGBA(255, 255, 255, 0)
                            Height: =Parent.Height
                            OnSelect: |-
                                =Set(RMOShowDropdown, false);
                                Set(rOShowDropdown, false);
                                Set(ratioShowDropdown, false);
                            Visible: =Gl_DropdownDivision_4.Visible
                            Width: =Parent.Width
                            ZIndex: =37

                        "Gl_DropdownDivision_4 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                            '#CopilotOverlayLabel': ="Filtered"
                            BorderColor: =RGBA(191, 191, 192, 1)
                            BorderThickness: =0.5
                            Fill: |-
                                =//If(CountRows(listDivisionFilter) > 0, RGBA(255, 255, 255, 1), RGBA(244, 244, 244, 100))
                                RGBA(255, 255, 255, 1)
                            Height: =Min(Self.AllItemsCount, 4) * Self.TemplateHeight + 10
                            Items: =["Agree", "Disagree", "Partially agree"]
                            Layout: =Layout.Vertical
                            LoadingSpinner: =LoadingSpinner.Data
                            TemplatePadding: =0
                            TemplateSize: =40
                            Visible: =ratioShowDropdown
                            Width: =DropdownOneClientRMOOp.Width
                            X: =DropdownOneClientRMOOp.X
                            Y: =RMO_Label.Y
                            ZIndex: =38

                            Button6_74 As button:
                                Align: =Align.Left
                                BorderThickness: =0
                                Color: =RGBA(82, 82, 82, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledFill: =RGBA(244, 244, 244, 0)
                                Fill: =RGBA(0, 0, 0, 0)
                                FocusedBorderColor: =RGBA(0, 0, 0, 0)
                                FocusedBorderThickness: =0
                                Font: =Font.Arial
                                FontWeight: =FontWeight.Normal
                                HoverColor: =RGBA(0, 0, 0, 1)
                                HoverFill: =RGBA(241, 244, 249, 1)
                                OnSelect: |
                                    =Set(oneClientRMOption, ThisItem.Value);
                                    Set(ratioShowDropdown, false);
                                PaddingLeft: =15
                                PaddingRight: =5.27
                                PaddingTop: =5.27
                                PressedColor: =Self.Color
                                PressedFill: =
                                RadiusBottomLeft: =0
                                RadiusBottomRight: =0
                                RadiusTopLeft: =0
                                RadiusTopRight: =0
                                Size: =10.5
                                Text: =ThisItem.Value
                                Width: =Parent.Width
                                X: =0.00
                                ZIndex: =1

                        PecentIcon_8 As label:
                            Align: =Align.Center
                            Color: =If(ProposalInterestRate_Input.DisplayMode.Disabled, RGBA(166, 166, 166, 1), RGBA(0,0,0,1))
                            Font: =Font.Arial
                            Height: =ProposalInterestRate_Input.Height
                            PaddingBottom: =0
                            PaddingLeft: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =10.5
                            Text: ="%"
                            Visible: =ProposalInterestRate_Input.Visible
                            Width: =25
                            X: =ProposalInterestRate_Input.X + ProposalInterestRate_Input.Width - Self.Width
                            Y: =ProposalInterestRate_Input.Y
                            ZIndex: =39

                        PecentIcon_9 As label:
                            Align: =Align.Center
                            Color: =If(ProposalInterestRate_Input.DisplayMode.Disabled, RGBA(166, 166, 166, 1), RGBA(0,0,0,1))
                            Font: =Font.Arial
                            Height: =PIR_Input.Height
                            PaddingBottom: =0
                            PaddingLeft: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =10.5
                            Text: ="%"
                            Visible: =PIR_Input.Visible
                            Width: =25
                            X: =PIR_Input.X + PIR_Input.Width - Self.Width
                            Y: =PIR_Input.Y
                            ZIndex: =40

            LabelErrorTable_Mr As label:
                Color: =RGBA(255, 0, 0, 1)
                Font: =Font.Arial
                Height: =If(CountRows(invalidValue) > 0 || isMissDataNature || isInValidDataFinancial, 40, 0)
                Italic: =true
                Size: =10.5
                Text: ="Invalid data, please check the data again."
                Visible: =(CountRows(invalidValue) > 0 || isMissDataNature || isInValidDataFinancial) && DealDetailTab = 2 && subTabFinacical = 1
                Width: =If(App.Width > 800, 450, White_Background_8.Width - 50 )
                X: =622
                Y: =511
                ZIndex: =70

            Container18 As groupContainer.manualLayoutContainer:
                Fill: =RGBA(237, 237, 237, 1)
                Height: =Container12_3.Height + lb_header_content.Height + lb_bottom_conent.Height + 10
                PaddingBottom: =5
                PaddingLeft: =5
                PaddingRight: =5
                PaddingTop: =5
                Visible: =DealDetailTab = 2
                Width: =Min(If(App.Width > 1400, Container13_3.LayoutMinWidth + 5, App.Width > 900, 930, 730), White_Background_10.Width - If(App.Width > 600, 70, 40))
                X: =Label_Content.X
                Y: =Label_Content.Y + Label_Content.Height
                ZIndex: =71

                lb_header_content As label:
                    AutoHeight: =true
                    Font: =Font.Arial
                    Height: =89
                    LineHeight: =1.5
                    Size: =10.5
                    Text: =headerContent
                    Width: =Parent.Width - 20
                    X: =10
                    Y: =5
                    ZIndex: =1

                Container12_3 As groupContainer.horizontalAutoLayoutContainer:
                    DropShadow: =DropShadow.None
                    Height: =180 + Gallery5_3.Height
                    LayoutMode: =LayoutMode.Auto
                    LayoutOverflowX: =LayoutOverflow.Scroll
                    RadiusBottomLeft: =0
                    RadiusBottomRight: =0
                    RadiusTopLeft: =0
                    RadiusTopRight: =0
                    Visible: =DealDetailTab = 2
                    Width: =Parent.Width
                    Y: =lb_header_content.Y + lb_header_content.Height
                    ZIndex: =2

                    Container13_3 As groupContainer.manualLayoutContainer:
                        DropShadow: =DropShadow.None
                        LayoutMinHeight: =100
                        LayoutMinWidth: =1700
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        ZIndex: =1

                        Header_after_2 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =0.5
                            Color: =RGBA(255, 255, 255, 1)
                            Fill: =RGBA(0, 94, 146, 1)
                            Font: =Font.Arial
                            Height: =44
                            Size: =10.5
                            Text: ="After adjustment"
                            Width: =(Parent.Width - Header_before_2.X - 20) / 2
                            X: =Header_before_2.X + Header_before_2.Width - 1
                            Y: =Header_before_2.Y
                            ZIndex: =2

                        "Gallery5_3 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                            '#CopilotOverlayLabel': ="Filtered"
                            DelayItemLoading: =true
                            Height: =Min(Self.AllItemsCount, If(App.Width > 600, 5, 8)) * Self.TemplateHeight + If(App.Width > 800, 0, 20)
                            Items: =listPolicyEmail
                            Layout: =Layout.Vertical
                            LoadingSpinner: =LoadingSpinner.Data
                            TemplatePadding: =0
                            TemplateSize: =35
                            Width: =Header_after_2.Width + Header_before_2.Width + Layout_overlay_send_mail_2.Width + 0.5 + 15
                            X: =Label3_36.X - 0.5
                            Y: =Label3_36.Y + Label3_36.Height
                            ZIndex: =3

                            be_loan_all_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.be_qty_all_client
                                Width: =Header_before_2.Width / 5 + 0.5
                                X: =be_loan_per_client_3.X + be_loan_per_client_3.Width
                                ZIndex: =24

                            af_margin_ratio_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.af_margin_ratio&"%"
                                Width: =Header_before_2.Width / 5 - 1
                                X: =be_loan_all_client_3.X + be_loan_all_client_3.Width - 1
                                ZIndex: =25

                            af_qty_per_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.af_loan_per_client
                                Width: =Header_before_2.Width / 5 + 0.5
                                X: =af_margin_ratio_3.X + af_margin_ratio_3.Width - 0.5
                                ZIndex: =26

                            af_loan_per_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.af_qty_all_client
                                Width: =Header_before_2.Width / 5 - 1
                                X: =af_loan_all_client_3.X + af_loan_all_client_3.Width - 0.5
                                ZIndex: =27

                            af_qty_all_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.af_loan_all_client
                                Width: =Header_before_2.Width / 5 + 1
                                X: =af_qty_per_client_3.X + af_qty_per_client_3.Width - 0.5
                                ZIndex: =28

                            af_loan_all_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.af_qty_per_client
                                Width: =Header_before_2.Width / 5 + 1.5
                                X: =af_qty_all_client_3.X + af_qty_all_client_3.Width - 0.5
                                ZIndex: =29

                            market_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.market
                                Width: =Label3_36.Width
                                X: =Label3_36.X - 0.5
                                ZIndex: =30

                            stock_no_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.stock_no
                                Width: =Label3_37.Width + 0.5
                                X: =market_3.X + market_3.Width - 0.5
                                ZIndex: =31

                            be_margin_ratio_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.be_margin_ratio&"%"
                                Width: =Label3_38.Width
                                X: =stock_no_3.X + stock_no_3.Width
                                ZIndex: =32

                            be_qty_per_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.be_loan_per_client
                                Width: =Label3_39.Width + 0.5
                                X: =be_margin_ratio_3.X + be_margin_ratio_3.Width - 0.5
                                ZIndex: =33

                            be_qty_all_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.be_loan_all_client
                                Width: =Label3_40.Width + 1
                                X: =be_qty_per_client_3.X + be_qty_per_client_3.Width - 0.5
                                ZIndex: =34

                            be_loan_per_client_3 As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                BorderThickness: =0.5
                                Fill: =RGBA(255, 255, 255, 1)
                                Font: =Font.Arial
                                Height: =35
                                OnSelect: =Select(Parent)
                                Size: =10.5
                                Text: =ThisItem.be_qty_per_client
                                Width: =Header_before_2.Width / 5 + 0.5
                                X: =be_qty_all_client_3.X + be_qty_all_client_3.Width - 0.5
                                ZIndex: =35

                        Label3_36 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =80
                            Size: =10.5
                            Text: ="Market"
                            Width: =(Layout_overlay_send_mail_2.Width / 2 )
                            X: =Layout_overlay_send_mail_2.X
                            Y: =Layout_overlay_send_mail_2.Y + Layout_overlay_send_mail_2.Height + 0.5
                            ZIndex: =4

                        Label3_37 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Stock No"
                            Width: =Label3_36.Width
                            X: =Label3_36.X + Label3_36.Width
                            Y: =Label3_36.Y
                            ZIndex: =5

                        Label3_43 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Margin Ratio"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_42.X + Label3_42.Width - 1
                            Y: =Label3_42.Y
                            ZIndex: =6

                        Label3_39 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Amt Per Client"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_38.X + Label3_38.Width
                            Y: =Label3_38.Y
                            ZIndex: =7

                        Label3_45 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Amt All Client"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_44.X + Label3_44.Width
                            Y: =Label3_44.Y
                            ZIndex: =8

                        Label3_46 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Qty Per Client"
                            Width: =Header_before_2.Width / 5 + 1
                            X: =Label3_45.X + Label3_45.Width
                            Y: =Label3_45.Y
                            ZIndex: =9

                        Label3_47 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Qty All Client"
                            Width: =Header_before_2.Width / 5 - 1
                            X: =Label3_46.X + Label3_46.Width
                            Y: =Label3_46.Y
                            ZIndex: =10

                        Label3_38 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Margin Ratio"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_37.X + Label3_37.Width
                            Y: =Label3_37.Y
                            ZIndex: =11

                        Label3_44 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Amt Per Client"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_43.X + Label3_43.Width
                            Y: =Label3_43.Y
                            ZIndex: =12

                        Label3_40 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Amt All Client"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_39.X + Label3_39.Width
                            Y: =Label3_39.Y
                            ZIndex: =13

                        Label3_41 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Qty Per Client"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_40.X + Label3_40.Width
                            Y: =Label3_40.Y
                            ZIndex: =14

                        Label3_42 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(255, 0, 0, 1)
                            Fill: =RGBA(215, 223, 240, 1)
                            Font: =Font.Arial
                            Height: =Label3_36.Height
                            Size: =10.5
                            Text: ="Max Margined Qty All Client"
                            Width: =Header_before_2.Width / 5
                            X: =Label3_41.X + Label3_41.Width
                            Y: =Label3_41.Y
                            ZIndex: =15

                        Header_before_2 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            BorderThickness: =0.5
                            Color: =RGBA(255, 255, 255, 1)
                            Fill: =RGBA(0, 94, 146, 1)
                            Font: =Font.Arial
                            Height: =44
                            Size: =10.5
                            Text: ="Before adjustment"
                            Width: =(Parent.Width - Header_before_2.X - 20) / 2
                            X: =Layout_overlay_send_mail_2.X + Layout_overlay_send_mail_2.Width
                            Y: =Layout_overlay_send_mail_2.Y
                            ZIndex: =16

                        Layout_overlay_send_mail_2 As rectangle:
                            BorderColor: =RGBA(255, 255, 255, 1)
                            Fill: =RGBA(0, 0, 0, 0)
                            Height: =43
                            Width: =170
                            X: =1
                            ZIndex: =19

                lb_bottom_conent As label:
                    AutoHeight: =true
                    Font: =Font.Arial
                    Height: =89
                    LineHeight: =1.5
                    Size: =10.5
                    Text: =bottomConent
                    Width: =Container12_3.Width - 20
                    X: =10
                    Y: =Container12_3.Y + Container12_3.Height + 5
                    ZIndex: =3

            Label_Subject_Start As label:
                BorderColor: =RGBA(89, 0, 0, 1)
                Color: =RGBA(255, 0, 0, 1)
                Font: =Font.Arial
                Height: =30
                PaddingLeft: =0
                PaddingTop: =10
                Size: =10.5
                Text: ="*"
                Visible: =Label_Subject.Visible
                Width: =30
                X: =Label_Subject.X + 55
                Y: =Label_Subject.Y
                ZIndex: =72

            Label_SendTo_Start As label:
                BorderColor: =RGBA(89, 0, 0, 1)
                Color: =RGBA(255, 0, 0, 1)
                Font: =Font.Arial
                Height: =30
                PaddingLeft: =0
                PaddingTop: =10
                Size: =10.5
                Text: ="*"
                Visible: =Label_Send.Visible
                Width: =30
                X: =Label_Send.X + 58
                Y: =Label_Send.Y
                ZIndex: =73

            ProgressGroup As group:
                Height: =5
                Width: =5
                X: =40
                Y: =-40
                ZIndex: =74

                "ListProgessItems_1 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                    '#CopilotOverlayLabel': ="Filtered"
                    DelayItemLoading: =true
                    Height: =Self.AllItemsCount * Self.TemplateHeight
                    Items: |-
                        =If(marginLimitType = "One Client",
                        Filter(marginLimitOneClientProgress, showBy in ShowByGroup),
                        Filter(Filter(marginLimitOneStockProgress, If(MarginedAmtPerClientCheckbox.Value && !MarginRatioCheckbox.Value && !MarginedAmtAllClientCheckbox.Value, showBy <> "RS", true)), showBy in ShowByGroup)
                        )
                    Layout: =Layout.Vertical
                    OnSelect: =Set(DealDetailTab, 1);
                    TemplatePadding: =0
                    TemplateSize: =If(IsBlank(marginDetail.status) || marginDetail.status = "DRAFT", 50, 56)
                    Visible: =If(App.Width > 800, true, showProgress)
                    Width: =If(Parent.Width > 1050, 260, Parent.Width > 1000, 220, App.Width - 40)
                    X: =If(Parent.Width > 800, If(MobileShowMenu, 256, 66), 0)
                    Y: =White_Background_10.Y
                    ZIndex: =41

                    Label9_8 As label:
                        Align: =Align.Right
                        Color: |-
                            =If(If(IsBlank(marginDetail.status), "", marginDetail.status) in ThisItem.currentStatus,
                                RGBA(17,79,144,1),
                                Self.Text = "Approve the proposal" && !IsBlank(marginDetail.status) && !(marginDetail.status in ["APPROVED", "DRAFT", "PENDING_RISK_MANAGERMENTS_OPINION", "REVISED", "PENDING_RESEARCHS_OPINION", "PENDING_UPDATE_CHANGES"]),
                                RGBA(17,79,144,1),
                                !IsBlank(marginDetail.status) && Self.Text <> "Approve the proposal" && marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_VICE_MANAGER", "PENDING_RM&IC-SC", "PENDING_INVESTMENT_COMMITEE"],
                                RGBA(36,201,72,1),
                                If(marginDetail.status ="REJECTED", First(marginDetail1.proposal).old_status, If(IsBlank(marginDetail.status), "", marginDetail.status)) in ThisItem.activeArray,
                                RGBA(36,201,72,1),
                                !IsBlank(marginDetail.status) && Self.Text <> "Approve the proposal" && First(marginDetail1.proposal).old_status in ThisItem.currentStatus,
                                RGBA(255, 0, 0, 1),
                                RGBA(126, 130, 153, 1)
                            )
                        Fill: =If(Self.Color = RGBA(17,79,144,1) && Self.Text <> "Approve the proposal", RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                        Font: =Font.Arial
                        FontWeight: =FontWeight.Semibold
                        Height: =41
                        OnSelect: =Select(Parent)
                        PaddingRight: =10
                        PaddingTop: =0
                        Size: =If(App.Width > 1100, 10, 9)
                        Text: =ThisItem.Text
                        VerticalAlign: =If(Label9_9.Visible, VerticalAlign.Top, VerticalAlign.Middle)
                        Width: =Parent.Width - HtmlText5_6.Width - Self.X
                        X: =20
                        Y: =9
                        ZIndex: =1

                    HtmlText5_6 As htmlViewer:
                        Fill: =Label9_8.Fill
                        Font: =Font.Arial
                        Height: =41
                        HtmlText: |-
                            =If(Label9_8.Color = RGBA(255,0,0,1),
                            "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                            <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                            <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                            </svg>",
                                Label9_8.Color = RGBA(17,79,144,1),
                            "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                              <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#114F90""/>
                              <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#114F90""/>
                            </svg>",
                                Label9_8.Color = RGBA(36,201,72,1),
                            "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                              <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                              <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                            </svg>",
                            "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                            <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                            </svg>"
                            )
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingTop: =8
                        Visible: =If(ThisItem.Text = "CEO" && !IsBlank(proposalInfoEdit), If(proposalInfoEdit.proposal_status = "REJECTED",proposalInfoEdit.old_status,proposalInfoEdit.proposal_status) in ["PENDING_REVIEW_BY_INVESTMENT_COMMITEE", "PENDING_REVIEW_BY_CEO", "APPROVED"], ThisItem.Text <> "CEO")
                        Width: =36
                        X: =Label9_8.X + Label9_8.Width
                        Y: =9
                        ZIndex: =2

                    Label9_9 As label:
                        Align: =Align.Right
                        Color: =Label9_8.Color
                        Fill: =RGBA(0,0,0,0)
                        Font: =Font.Arial
                        Height: =25
                        Italic: =true
                        OnSelect: =Select(Parent)
                        PaddingBottom: =If(App.Width > 1000 && App.Width < 1100, 0, 5)
                        PaddingRight: =10
                        PaddingTop: =0
                        Size: =If(App.Width > 1000 && App.Width < 1100, 7, 8)
                        Text: |-
                            =Switch(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in ThisItem.filterLogStatus)).action, "SUBMIT", "Submitted", "APPROVE", "Approved", "REJECT", "Rejected", "Revised")
                            & " by " & First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in ThisItem.filterLogStatus)).created_by
                            & " on " &
                            Text(DateTimeValue(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in ThisItem.filterLogStatus)).created_date), "dd/mm/yyyy")
                        VerticalAlign: =VerticalAlign.Top
                        Visible: =Label9_8.Visible && !IsBlank(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in ThisItem.filterLogStatus)).action)
                        Width: =Parent.Width - 36
                        Y: =33
                        ZIndex: =3

                    ListProgess_CursorButton As button:
                        DisabledFill: =Self.Fill
                        Fill: =RGBA(0, 0, 0, 0)
                        Font: =Font.Arial
                        Height: =Parent.TemplateHeight
                        HoverFill: =Self.Fill
                        OnSelect: |-
                            =Select(Parent);
                            Set(isLoadingCompletedML, false);
                            Set(isLoadingCompletedML, true);
                        PressedFill: =Self.Fill
                        Text: =""
                        Width: =Parent.TemplateWidth
                        ZIndex: =4

                "proposalDetailLogsItems_1 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                    '#CopilotOverlayLabel': ="Filtered"
                    DelayItemLoading: =true
                    Height: =Self.AllItemsCount * Self.TemplateHeight + 10
                    Items: =proposalDetailLogs
                    Layout: =Layout.Vertical
                    TemplatePadding: =0
                    TemplateSize: =If(App.Width > 1100, 95, 110)
                    Visible: =false
                    Width: =If(App.Width > 1100, 720, App.Width > 600, 450 , App.Width)
                    X: =White_Background_10.X + 10
                    Y: =QT2Tabs_10.Y + QT2Tabs_10.Height + 10
                    ZIndex: =42

                    Title5_4 As label:
                        Font: =Font.Arial
                        Height: =If(App.Width > 1100, 26, 40)
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        Size: =10.5
                        Text: |-
                            ="Step " &
                            Switch(Value(ThisItem.level), 1, "Review by Head of Division - ", 2, "Review by Risk Management - ", 3, "Review by CIO - ", 4, "Review by CEO - ", 5, "Investment Committee - ")
                            &If("PARTIALLY_REJECTED" in ThisItem.status || "REVISE" in ThisItem.status, "Revised", "REJECT" in ThisItem.status || "REJECTED" in ThisItem.status, "Rejected", "APPROVE" in ThisItem.status || "APPROVED" in ThisItem.status, "Approved", "Review") &" by "& Proper(ThisItem.name) &" on "& Text(DateTimeValue(ThisItem.created_date), "dd/mm/yyyy hh:mm:ss")  & " with comments"
                        VerticalAlign: =VerticalAlign.Top
                        Width: =Parent.Width - 40
                        X: =10
                        Y: =4
                        ZIndex: =2

                    TextInput4_4 As text:
                        BorderThickness: =0
                        Default: =ThisItem.comment
                        DisplayMode: =DisplayMode.Disabled
                        Font: =Font.Arial
                        Height: =60
                        HintText: ="N/A"
                        LineHeight: =1.5
                        Mode: =TextMode.MultiLine
                        OnSelect: =Select(Parent)
                        PaddingBottom: =8
                        PaddingLeft: =8
                        PaddingRight: =8
                        PaddingTop: =8
                        Size: =10.5
                        Width: =Parent.Width - 40
                        X: =Title5_4.X
                        Y: =Title5_4.Y + Title5_4.Height
                        ZIndex: =3

                "ListHoiDongDauTu As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                    '#CopilotOverlayLabel': ="Filtered"
                    DelayItemLoading: =true
                    Height: =If(Self.Visible, Self.AllItemsCount * Self.TemplateHeight, 0)
                    Items: =If(marginDetail.status in ["APPROVED", "PENDING_UPDATE_CHANGES", "REJECTED"], marginDetail1.listIC_done, marginDetail1.listIC)
                    Layout: =Layout.Vertical
                    OnSelect: =Set(DealDetailTab, 1);
                    TemplatePadding: =0
                    TemplateSize: =If(IsBlank(marginDetail.status) || marginDetail.status = "DRAFT", 45, 50)
                    Visible: =If(App.Width > 800, true, showProgress) && "SC" in ShowByGroup
                    Width: =ListProgessItems_1.Width
                    X: =ListProgessItems_1.X
                    Y: =HtmlText5_8.Y + HtmlText5_8.Height
                    ZIndex: =43

                    Label9_12 As label:
                        Align: =Align.Right
                        Color: =Switch(ThisItem.action, "APPROVE", RGBA(36, 201, 72, 1), "REJECT", RGBA(255, 0, 0, 1) , RGBA(126, 130, 153, 1))
                        Fill: =RGBA(209, 221, 255, 0)
                        Font: =Font.Arial
                        FontWeight: =FontWeight.Semibold
                        Height: =ListHoiDongDauTu.TemplateHeight
                        OnSelect: =Select(Parent)
                        PaddingLeft: =10
                        PaddingRight: =10
                        Size: =If(App.Width > 1000, 10, 9)
                        Text: =ThisItem.name_user
                        VerticalAlign: =If(Label9_13.Visible, VerticalAlign.Top, VerticalAlign.Middle)
                        Width: =ListHoiDongDauTu.Width - HtmlText5_9.Width - Self.X
                        X: =20
                        ZIndex: =1

                    HtmlText5_9 As htmlViewer:
                        Fill: =RGBA(209, 221, 255, 0)
                        Font: =Font.Arial
                        HtmlText: |-
                            =Switch(ThisItem.action,
                                "APPROVE", "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                            <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                            </svg>",
                                "REJECT", "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                            <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                            <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                            </svg>",
                                "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                            <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                            </svg>"
                            )
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingTop: =8
                        Width: =36
                        X: =Label9_12.X + Label9_12.Width - 1
                        ZIndex: =2

                    Label9_13 As label:
                        Align: =Align.Right
                        Color: =Switch(ThisItem.action, "APPROVE", RGBA(36, 201, 72, 1), "REJECT", RGBA(255, 0, 0, 1) , RGBA(126, 130, 153, 1))
                        Fill: =RGBA(209, 221, 255, 0)
                        Font: =Font.Arial
                        Height: =25
                        Italic: =true
                        OnSelect: =Select(Parent)
                        PaddingLeft: =10
                        PaddingRight: =10
                        Size: =8
                        Text: =Proper(If(ThisItem.action = "APPROVE", "APPROVED", ThisItem.action)) & " on " & Text(DateValue(ThisItem.created_date), "dd/mm/yyyy")
                        Visible: =!IsBlank(ThisItem.action)
                        Width: =ListHoiDongDauTu.Width - HtmlText5_9.Width - Self.X
                        X: =40
                        Y: =20
                        ZIndex: =3

                    Button8 As button:
                        Color: =RGBA(0, 0, 0, 0)
                        DisabledFill: =Self.Fill
                        Fill: =RGBA(0, 0, 0, 0)
                        Font: =Font.Arial
                        Height: =Parent.TemplateHeight
                        HoverFill: =Self.Fill
                        OnSelect: =Select(Parent)
                        PressedFill: =Self.Fill
                        Text: =""
                        Width: =Parent.TemplateWidth
                        ZIndex: =4

                Rectangle3_1 As rectangle:
                    Fill: =RGBA(202, 202, 202, 1)
                    Height: =If(ListHoiDongDauTu.Height = 0, 0, 27)
                    Visible: =If(App.Width > 800, true, showProgress) && Label_hoi_dong_dau_tu.Visible
                    Width: =2
                    X: =ListHoiDongDauTu.X + ListHoiDongDauTu.Width - 22
                    Y: =TongGiamDoc_Label.Y + TongGiamDoc_Label.Height - 5
                    ZIndex: =44

                Label_hoi_dong_dau_tu As label:
                    Align: =Align.Right
                    Color: |-
                        =If(marginDetail.status in ["APPROVED", "PENDING_UPDATE_CHANGES"], RGBA(36, 201, 72, 1),
                            marginDetail.status in ["PENDING_INVESTMENT_COMMITEE"], RGBA(17,79,144,1),
                            marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_UPDATE_CHANGES"],
                            RGBA(36,201,72,1),
                            marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_INVESTMENT_COMMITEE"],
                            RGBA(255,0,0,1),
                            RGBA(126, 130, 153, 1))
                    Fill: =If(Self.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Semibold
                    Height: =If(ListHoiDongDauTu.Height = 0, 0, 40)
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingLeft: =10
                    PaddingRight: =10
                    Size: =If(App.Width > 1000, 10, 9)
                    Text: ="IC"
                    Visible: =If(App.Width > 800, true, showProgress) && "SC" in ShowByGroup
                    Width: =HtmlText5_8.X - SubHeaderHr_4.X
                    X: =HtmlText5_8.X - Self.Width
                    Y: =HtmlText5_8.Y
                    ZIndex: =46

                HtmlText5_8 As htmlViewer:
                    Fill: =Label_hoi_dong_dau_tu.Fill
                    Font: =Font.Arial
                    Height: =If(ListHoiDongDauTu.Height = 0, 0, 40)
                    HtmlText: |-
                        =If(Label_hoi_dong_dau_tu.Color = RGBA(255,0,0,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                        <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                        <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                        </svg>",
                            Label_hoi_dong_dau_tu.Color = RGBA(17,79,144,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#114F90""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#114F90""/>
                        </svg>",
                            Label_hoi_dong_dau_tu.Color = RGBA(36,201,72,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                        </svg>",
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                        <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                        </svg>"
                        )
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingBottom: =0
                    PaddingTop: =8
                    Visible: =If(App.Width > 800, true, showProgress) && "SC" in ShowByGroup
                    Width: =36
                    X: =Rectangle3_1.X - 15
                    Y: =Rectangle3_1.Y + Rectangle3_1.Height + 5
                    ZIndex: =47

                HrProgress_3 As rectangle:
                    Fill: =RGBA(191, 191, 192, 1)
                    Height: =ListHoiDongDauTu.Y + ListHoiDongDauTu.Height - Self.Y
                    Visible: =If(App.Width > 800, true, false)
                    Width: =1
                    X: =ListProgessItems_1.X + ListProgessItems_1.Width + 17
                    Y: =SubHeaderBg_4.Y + SubHeaderBg_4.Height
                    ZIndex: =48

                "ListTieuBan As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                    '#CopilotOverlayLabel': ="Filtered"
                    DelayItemLoading: =true
                    Height: =Self.AllItemsCount * Self.TemplateHeight
                    Items: |-
                        =
                        If(marginDetail.status in ["PENDING_CEO", "Updated", "PENDING_UPDATE_CHANGES", "PENDING_INVESTMENT_COMMITEE"], marginDetail1.listIC_SC_done,marginDetail1.listIC_SC)
                    Layout: =Layout.Vertical
                    OnSelect: =Set(DealDetailTab, 1);
                    TemplatePadding: =0
                    TemplateSize: =If(IsBlank(marginDetail.status) || marginDetail.status = "DRAFT", 40, 45)
                    Visible: =If(App.Width > 800, true, showProgress) && "IC" in ShowByGroup
                    Width: =ListProgessItems_1.Width
                    X: =ListProgessItems_1.X
                    Y: =TieuBan_Label.Y + TieuBan_Label.Height
                    ZIndex: =49

                    Label9_14 As label:
                        Align: =Align.Right
                        Color: =Switch(ThisItem.action, "APPROVE", RGBA(36, 201, 72, 1), "REJECT", RGBA(255, 0, 0, 1) , RGBA(126, 130, 153, 1))
                        Fill: =RGBA(209, 221, 255, 0)
                        Font: =Font.Arial
                        FontWeight: =FontWeight.Semibold
                        Height: =ListTieuBan.TemplateHeight
                        OnSelect: =Select(Parent)
                        PaddingLeft: =10
                        PaddingRight: =10
                        Size: =If(App.Width > 1000, 10, 9)
                        Text: =ThisItem.name_user
                        VerticalAlign: =If(Label9_15.Visible, VerticalAlign.Top, VerticalAlign.Middle)
                        Width: =ListTieuBan.Width - HtmlText5_10.Width - Self.X
                        X: =20
                        ZIndex: =1

                    HtmlText5_10 As htmlViewer:
                        Fill: =RGBA(209, 221, 255, 0)
                        Font: =Font.Arial
                        HtmlText: |-
                            =Switch(ThisItem.action,
                                "APPROVE", "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                            <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                            </svg>",
                                "REJECT", "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                            <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                            <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                            </svg>",
                                "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                            <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                            <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                            </svg>"
                            )
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingTop: =8
                        Width: =36
                        X: =Label9_14.X + Label9_14.Width - 1
                        ZIndex: =2

                    Label9_15 As label:
                        Align: =Align.Right
                        Color: =Switch(ThisItem.action, "APPROVE", RGBA(36, 201, 72, 1), "REJECT", RGBA(255, 0, 0, 1) , RGBA(126, 130, 153, 1))
                        Fill: =RGBA(209, 221, 255, 0)
                        Font: =Font.Arial
                        Height: =25
                        Italic: =true
                        OnSelect: =Select(Parent)
                        PaddingLeft: =10
                        PaddingRight: =10
                        PaddingTop: =0
                        Size: =8
                        Text: =Proper(If(ThisItem.action = "APPROVE", "APPROVED", ThisItem.action)) & " on " & Text(DateValue(ThisItem.created_date), "dd/mm/yyyy")
                        Visible: =!IsBlank(ThisItem.action)
                        Width: =ListTieuBan.Width - HtmlText5_10.Width - Self.X
                        Y: =23
                        ZIndex: =3

                    ListTieuBan_CursorButton As button:
                        Color: =RGBA(0, 0, 0, 0)
                        DisabledFill: =Self.Fill
                        Fill: =RGBA(0, 0, 0, 0)
                        Font: =Font.Arial
                        Height: =Parent.TemplateHeight
                        HoverFill: =Self.Fill
                        OnSelect: =Select(Parent)
                        PressedFill: =Self.Fill
                        Text: =""
                        Width: =Parent.TemplateWidth
                        ZIndex: =4

                TieuBan_Vr As rectangle:
                    Fill: =RGBA(202, 202, 202, 1)
                    Height: =27
                    Visible: =If(App.Width > 800, true, showProgress) && TieuBan_Label.Visible
                    Width: =2
                    X: =ListTieuBan.X + ListTieuBan.Width - 22
                    Y: =DCEO_Icon_1.Y + DCEO_Icon_1.Height - 5
                    ZIndex: =50

                TieuBan_Label As label:
                    Align: =Align.Right
                    Color: |-
                        =If(marginDetail.status in ["APPROVED", "PENDING_UPDATE_CHANGES", "PENDING_INVESTMENT_COMMITEE"], RGBA(36, 201, 72, 1),
                            marginDetail.status in ["PENDING_RM&IC-SC"], RGBA(17,79,144,1),
                            marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_CEO", "PENDING_UPDATE_CHANGES", "PENDING_INVESTMENT_COMMITEE"],
                            RGBA(36,201,72,1),
                            marginDetail.status in ["PENDING_CEO"], RGBA(36,201,72,1),
                            marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_RM&IC-SC"],
                            RGBA(255,0,0,1),
                            RGBA(126, 130, 153, 1))
                    Fill: =If(Self.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Semibold
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingLeft: =10
                    PaddingRight: =10
                    Size: =If(App.Width > 1000, 10, 9)
                    Text: ="Risk Committee"
                    Visible: =If(App.Width > 800, true, showProgress) && "IC" in ShowByGroup
                    Width: =TieuBan_Icon.X - SubHeaderHr_4.X
                    X: =TieuBan_Icon.X - Self.Width
                    Y: =TieuBan_Icon.Y
                    ZIndex: =51

                TieuBan_Icon As htmlViewer:
                    Fill: =If(TieuBan_Label.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    HtmlText: |-
                        =If(TieuBan_Label.Color = RGBA(255,0,0,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                        <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                        <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                        </svg>",
                            TieuBan_Label.Color = RGBA(17,79,144,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#114F90""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#114F90""/>
                        </svg>",
                            TieuBan_Label.Color = RGBA(36,201,72,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                        </svg>",
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                        <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                        </svg>"
                        )
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingBottom: =0
                    PaddingTop: =8
                    Visible: =If(App.Width > 800, true, showProgress) && "IC" in ShowByGroup
                    Width: =36
                    X: =TieuBan_Vr.X - 15
                    Y: =TieuBan_Vr.Y + TieuBan_Vr.Height + 5
                    ZIndex: =52

                TongGiamDoc_Vr As rectangle:
                    Fill: =RGBA(202, 202, 202, 1)
                    Height: =If(!Self.Visible, 0, 27)
                    Visible: =If(App.Width > 800, true, showProgress) && "CEO" in ShowByGroup
                    Width: =2
                    X: =ListTieuBan.X + ListTieuBan.Width - 22
                    Y: =ListTieuBan.Y + ListTieuBan.Height - 5
                    ZIndex: =53

                TongGiamDoc_Label As label:
                    Align: =Align.Right
                    Color: |-
                        =If(marginDetail.status in ["APPROVED", "PENDING_UPDATE_CHANGES", "PENDING_INVESTMENT_COMMITEE"], RGBA(36, 201, 72, 1),
                            marginDetail.status in ["PENDING_CEO"], RGBA(17,79,144,1),
                            marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_CEO"],
                            RGBA(255,0,0,1),
                            marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_UPDATE_CHANGES", "PENDING_INVESTMENT_COMMITEE"],
                            RGBA(36,201,72,1),
                            RGBA(126, 130, 153, 1))
                    Fill: =If(Self.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Semibold
                    Height: =If(!Self.Visible, 0, 40)
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingLeft: =10
                    PaddingRight: =10
                    Size: =If(App.Width > 1000, 10, 9)
                    Text: ="CEO"
                    Visible: =If(App.Width > 800, true, showProgress) && "CEO" in ShowByGroup
                    Width: =TongGiamDoc_Icon.X - SubHeaderHr_4.X
                    X: =TongGiamDoc_Icon.X - Self.Width
                    Y: =TongGiamDoc_Icon.Y
                    ZIndex: =54

                TongGiamDoc_Icon As htmlViewer:
                    Fill: =If(TongGiamDoc_Label.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    Height: =If(!Self.Visible, 0, 40)
                    HtmlText: |-
                        =If(TongGiamDoc_Label.Color = RGBA(255,0,0,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                        <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                        <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                        </svg>",
                            TongGiamDoc_Label.Color = RGBA(17,79,144,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#114F90""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#114F90""/>
                        </svg>",
                            TongGiamDoc_Label.Color = RGBA(36,201,72,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                        </svg>",
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                        <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                        </svg>"
                        )
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingBottom: =0
                    PaddingTop: =8
                    Visible: =If(App.Width > 800, true, showProgress) && "CEO" in ShowByGroup
                    Width: =36
                    X: =TongGiamDoc_Vr.X - 15
                    Y: =TongGiamDoc_Vr.Y + TongGiamDoc_Vr.Height + 5
                    ZIndex: =55

                DCEO_Label_1 As label:
                    Align: =Align.Right
                    Color: |-
                        =If(marginDetail.status in ["APPROVED"], RGBA(36, 201, 72, 1),
                            marginDetail.status in ["PENDING_VICE_MANAGER"], RGBA(17,79,144,1),
                            If(marginDetail.status = "REJECTED", First(marginDetail1.proposal).old_status, marginDetail.status) in ["PENDING_RM&IC-SC", "PENDING_CEO"],
                            RGBA(36,201,72,1),
                            marginDetail.status in ["REJECTED", "REVISED"] && First(marginDetail1.proposal).old_status in ["PENDING_VICE_MANAGER", "PENDING_RM&IC-SC"],
                            RGBA(255,0,0,1),
                            RGBA(126, 130, 153, 1))
                    Fill: =If(Self.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Semibold
                    Height: =If(Self.Visible, 40, 0)
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingLeft: =10
                    PaddingRight: =10
                    Size: =If(App.Width > 1000, 10, 9)
                    Text: ="D.CEO"
                    VerticalAlign: =If(IsBlank(Label_sub_DCEO.Text), VerticalAlign.Middle, VerticalAlign.Top)
                    Visible: |
                        =If(App.Width > 800, true, showProgress) && "DCEO" in ShowByGroup
                    Width: =DCEO_Icon_1.X - SubHeaderHr_4.X
                    X: =DCEO_Icon_1.X - Self.Width
                    Y: =DCEO_Icon_1.Y
                    ZIndex: =56

                DCEO_Icon_1 As htmlViewer:
                    Fill: =If(DCEO_Label_1.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    Height: =If(Self.Visible, 40, 0)
                    HtmlText: |-
                        =If(DCEO_Label_1.Color = RGBA(255,0,0,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                        <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                        <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                        </svg>",
                            DCEO_Label_1.Color = RGBA(17,79,144,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#114F90""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#114F90""/>
                        </svg>",
                            DCEO_Label_1.Color = RGBA(36,201,72,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                        </svg>",
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                        <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                        </svg>"
                        )
                    OnSelect: =Set(DealDetailTab, 1);
                    PaddingBottom: =0
                    PaddingTop: =8
                    Visible: |
                        =If(App.Width > 800, true, showProgress) && "DCEO" in ShowByGroup
                    Width: =36
                    X: =TieuBan_Vr.X - 15
                    Y: =ListProgessItems_1.Y + ListProgessItems_1.Height + 15
                    ZIndex: =57

                Update_change_Vr As rectangle:
                    Fill: =RGBA(202, 202, 202, 1)
                    Height: =27
                    Visible: =If(App.Width > 800, true, showProgress) && "SEND" in ShowByGroup
                    Width: =2
                    X: =ListTieuBan.X + ListTieuBan.Width - 22
                    Y: =ListHoiDongDauTu.Y + ListHoiDongDauTu.Height
                    ZIndex: =58

                Update_change_Label As label:
                    Align: =Align.Right
                    Color: |-
                        =If(marginDetail.status in ["APPROVED"], RGBA(36, 201, 72, 1),
                            marginDetail.status in ["PENDING_UPDATE_CHANGES"], RGBA(17,79,144,1),
                             marginDetail.status = "REJECTED" && First(marginDetail1.proposal).old_status in ["PENDING_UPDATE_CHANGES"],
                            RGBA(255,0,0,1),
                            RGBA(126, 130, 153, 1))
                    Fill: =If(Self.Color = RGBA(17,79,144,1), RGBA(209, 221, 255, 0.5), RGBA(209, 221, 255, 0))
                    Font: =Font.Arial
                    FontWeight: =FontWeight.Semibold
                    OnSelect: =If(First(marginDetail1.proposal).status in ["PENDING_UPDATE_CHANGES", "APPROVED"], Set(DealDetailTab, 2))
                    PaddingLeft: =10
                    PaddingRight: =10
                    Size: =If(App.Width > 1000, 10, 9)
                    Text: ="Update Changes"
                    Visible: =If(App.Width > 800, true, showProgress) && "SEND" in ShowByGroup
                    Width: =Update_change_Icon.X - SubHeaderHr_4.X
                    X: =Update_change_Icon.X - Self.Width
                    Y: =Update_change_Icon.Y
                    ZIndex: =59

                Update_change_Icon As htmlViewer:
                    Fill: =Update_change_Label.Fill
                    Font: =Font.Arial
                    HtmlText: |-
                        =If(Update_change_Label.Color = RGBA(255,0,0,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#FF0000""/>
                        <rect x=""6.75684"" y=""7.46484"" width=""1"" height=""11"" transform=""rotate(-45 6.75684 7.46484)"" fill=""#FF0000""/>
                        <rect x=""7.46387"" y=""15.2422"" width=""1"" height=""11"" transform=""rotate(-135 7.46387 15.2422)"" fill=""#FF0000""/>
                        </svg>",
                            Update_change_Label.Color = RGBA(17,79,144,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#114F90""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#114F90""/>
                        </svg>",
                            Update_change_Label.Color = RGBA(36,201,72,1),
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                          <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#24C948""/>
                          <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#24C948""/>
                        </svg>",
                        "<svg xmlns=""http://www.w3.org/2000/svg"" width=""22"" height=""22"" viewBox=""0 0 22 22"" fill=""none"">
                        <circle cx=""11"" cy=""11"" r=""10.5"" stroke=""#7E8299""/>
                        <path d=""M15.3368 7.73041L14.362 7.04782L10.6072 12.4092L7.68277 10.3616L7.00028 11.3365L10.9001 14.0671L15.3368 7.73041Z"" fill=""#7E8299""/>
                        </svg>"
                        )
                    OnSelect: =If(First(marginDetail1.proposal).status in ["PENDING_UPDATE_CHANGES", "APPROVED"], Set(DealDetailTab, 2))
                    PaddingBottom: =0
                    PaddingTop: =8
                    Visible: =If(App.Width > 800, true, showProgress) && "SEND" in ShowByGroup
                    Width: =36
                    X: =Update_change_Vr.X - 15
                    Y: =Update_change_Vr.Y + Update_change_Vr.Height + 5
                    ZIndex: =60

                Label_sub_DCEO As label:
                    Align: =Align.Right
                    Color: =DCEO_Label_1.Color
                    Fill: =RGBA(0,0,0,0)
                    Font: =Font.Arial
                    Height: =25
                    Italic: =true
                    OnSelect: =
                    PaddingRight: =10
                    PaddingTop: =0
                    Size: =8
                    Text: |-
                        =Switch(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_VICE_MANAGER")).action, "SUBMIT", "Submitted", "APPROVE", "Approved", "REJECT", "Rejected", "Revised")
                        & " by " & First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_VICE_MANAGER")).created_by
                        & " on " &
                        Text(DateTimeValue(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_VICE_MANAGER")).created_date), "dd/mm/yyyy")
                    VerticalAlign: =VerticalAlign.Top
                    Visible: =DCEO_Label_1.Visible && !IsBlank(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_VICE_MANAGER")).action)
                    Width: =DCEO_Label_1.Width
                    X: =DCEO_Label_1.X
                    Y: =DCEO_Label_1.Y + 25
                    ZIndex: =61

                Label_sub_CEO As label:
                    Align: =Align.Right
                    Color: =TongGiamDoc_Label.Color
                    Fill: =RGBA(0,0,0,0)
                    Font: =Font.Arial
                    Height: =25
                    Italic: =true
                    OnSelect: =
                    PaddingRight: =10
                    PaddingTop: =0
                    Size: =8
                    Text: |-
                        =Switch(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_CEO")).action, "SUBMIT", "Submitted", "APPROVE", "Approved", "REJECT", "Rejected", "Revised")
                        & " by " & First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_CEO")).created_by
                        & " on " &
                        Text(DateTimeValue(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_CEO")).created_date), "dd/mm/yyyy")
                    VerticalAlign: =VerticalAlign.Top
                    Visible: =TongGiamDoc_Label.Visible && !IsBlank(First(Filter(Sort(approvelLog, created_date, SortOrder.Descending), status in "PENDING_CEO")).action)
                    Width: =DCEO_Label_1.Width
                    X: =TongGiamDoc_Label.X
                    Y: =TongGiamDoc_Label.Y + 33
                    ZIndex: =62

                RiskCommittee_CursorButton As button:
                    DisabledFill: =Self.Fill
                    Fill: =RGBA(0, 0, 0, 0)
                    Font: =Font.Arial
                    Height: =TieuBan_Label.Height
                    HoverFill: =Self.Fill
                    OnSelect: =Select(TieuBan_Label)
                    PressedFill: =Self.Fill
                    Text: =""
                    Visible: =TieuBan_Label.Visible
                    Width: =TieuBan_Label.Width + 40
                    X: =TieuBan_Label.X
                    Y: =TieuBan_Label.Y
                    ZIndex: =63

                CEO_CursorButton As button:
                    DisabledFill: =Self.Fill
                    Fill: =RGBA(0, 0, 0, 0)
                    Font: =Font.Arial
                    Height: =TongGiamDoc_Label.Height
                    HoverFill: =Self.Fill
                    OnSelect: =Select(TongGiamDoc_Label)
                    PressedFill: =Self.Fill
                    Text: =""
                    Visible: =TongGiamDoc_Label.Visible
                    Width: =TongGiamDoc_Label.Width + 40
                    X: =TongGiamDoc_Label.X
                    Y: =TongGiamDoc_Label.Y
                    ZIndex: =64

                IC_CursorButton As button:
                    DisabledFill: =Self.Fill
                    Fill: =RGBA(0, 0, 0, 0)
                    Font: =Font.Arial
                    Height: =Label_hoi_dong_dau_tu.Height
                    HoverFill: =Self.Fill
                    OnSelect: =Select(Label_hoi_dong_dau_tu)
                    PressedFill: =Self.Fill
                    Text: =""
                    Visible: =Label_hoi_dong_dau_tu.Visible
                    Width: =Label_hoi_dong_dau_tu.Width + 40
                    X: =Label_hoi_dong_dau_tu.X
                    Y: =Label_hoi_dong_dau_tu.Y
                    ZIndex: =66

                DCEO_CursorButton As button:
                    DisabledFill: =Self.Fill
                    Fill: =RGBA(0, 0, 0, 0)
                    Font: =Font.Arial
                    Height: =DCEO_Label_1.Height
                    HoverFill: =Self.Fill
                    OnSelect: =Select(DCEO_Label_1)
                    PressedFill: =Self.Fill
                    Text: =""
                    Visible: =DCEO_Label_1.Visible
                    Width: =DCEO_Label_1.Width + 40
                    X: =DCEO_Label_1.X
                    Y: =DCEO_Label_1.Y
                    ZIndex: =68

                UpdateChanges_CursorButton As button:
                    DisabledFill: =Self.Fill
                    Fill: =RGBA(0, 0, 0, 0)
                    Font: =Font.Arial
                    HoverFill: =Self.Fill
                    OnSelect: =Select(Update_change_Label)
                    PressedFill: =Self.Fill
                    Text: =""
                    Visible: =Update_change_Label.Visible
                    Width: =Update_change_Label.Width + 40
                    X: =Update_change_Label.X
                    Y: =Update_change_Label.Y
                    ZIndex: =69

            Label_billion As label:
                Font: =Font.Arial
                Height: =30
                Italic: =true
                Size: =10.5
                Text: |-
                    ="Currency: billion VND"
                Visible: =ML_Table.Visible
                X: =ProposalInformation.X + 5
                Y: =ProposalInformation.Y + ProposalInformation.Height
                ZIndex: =75

            StockTableControl1 As StockTableControl.pcfdataset:
                CodeStock: =If(marginType = "One Client", "ONE_CLIENT", If(marginType = "One Stock", "ONE_STOCK", "MANY_STOCK"))
                DisplayMode: =DisplayMode.Edit
                FontSize4Table: =If(App.Width > 800, 14, 16)
                Height: =StockTableControl1.Data.currentHeight
                InMarginPolicyList: =InMarginPolicyCheckbox.Value
                InStep: =inStepTable
                IsForceDisable: |-
                    =!(If(
                    marginDetail.status in ["DRAFT"], "BROKER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action),
                    marginDetail.status in ["PENDING_RESEARCHS_OPINION"], "RESEARCH_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action),
                    marginDetail.status in ["PENDING_RISK_MANAGERMENTS_OPINION"], "RISK_MANAGER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action)
                    )) && !IsBlank(marginDetail.status)
                IsLoadingCompleted: =isLoadingCompletedML
                Items: =PolicyList1
                MarginedAmtAllClient: =MarginedAmtAllClientCheckbox.Value
                MarginedAmtPerClient: =MarginedAmtPerClientCheckbox.Value
                MarginRatio: =MarginRatioCheckbox.Value
                MasterNotAllowedData_Items: =unTradingList
                MaxAmount: =equityAmountFormatted*0.1
                OnChange: |-
                    =If(StockTableControl1.Data.action in ["SAVE_RECORD", "SUBMIT_RECORD"],
                    Set(isErrorBP_proposed_margined_amt_all_client, false);
                    Set(isErrorBP_RO_proposed_margined_amt_all_client, false);
                    Set(isErrorBP_RMO_proposed_margined_amt_all_client, false);
                    Set(equityAmountFormattedNew, If(isDotFormat, equityAmountFormatted, Substitute(equityAmountFormatted, ".", ",")));
                    If(!typeOneClient,
                        If(CountIf(MarginLimitPolicyList, Value(If(isDotFormat, BP_proposed_margined_amt_all_client, Substitute(BP_proposed_margined_amt_all_client, ".", ","))) > (Value(equityAmountFormattedNew) * 0.1)) > 0, Set(isErrorBP_proposed_margined_amt_all_client, true));
                        If(CountIf(MarginLimitPolicyList, Value(If(isDotFormat, RO_proposed_margined_amt_all_client, Substitute(RO_proposed_margined_amt_all_client, ".", ","))) > (Value(equityAmountFormattedNew) * 0.1)) > 0, Set(isErrorBP_RO_proposed_margined_amt_all_client, true));
                        If(CountIf(MarginLimitPolicyList, Value(If(isDotFormat, RMO_proposed_margined_amt_all_client, Substitute(RMO_proposed_margined_amt_all_client, ".", ","))) > (Value(equityAmountFormattedNew) * 0.1)) > 0, Set(isErrorBP_RMO_proposed_margined_amt_all_client, true));
                    );
                    Set(arrErrorTableStock, Split(StockTableControl1.Data.error, ","));
                    Set(isValid, false);
                    If(
                        // validate
                        // # one client
                        !typeOneClient && !MarginedAmtAllClientCheckbox.Value && !MarginedAmtPerClientCheckbox.Value && !MarginRatioCheckbox.Value, Set(IsError, true); Set(NoticationText,"Please llselect at least one checkbox in the Scope of Proposal section."); UpdateContext({ShowNotification: true}),
                        !typeOneClient && isErrorBP_proposed_margined_amt_all_client, Set(IsError, true); Set(NoticationText,"Proposed Margined Amt All Client Brokerage is over 10% TVS's equity"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && isErrorBP_RO_proposed_margined_amt_all_client, Set(IsError, true); Set(NoticationText,"Proposed Margined Amt All Client Research is over 10% TVS's equity"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && isErrorBP_RMO_proposed_margined_amt_all_client, Set(IsError, true); Set(NoticationText,"Proposed Margined Amt All Client Risk is over 10% TVS's equity"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "INVALID_INPUT_DATA" in arrErrorTableStock, Set(IsError, true); Set(NoticationText,"Invalid Input Data"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "TICKER_IN_MLP" in arrErrorTableStock, Set(IsError, true); Set(NoticationText,"This ticker is not included in the margin policy"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "TICKER_NOT_IN_MLP" in arrErrorTableStock, Set(IsError, true); Set(NoticationText,"This ticker is not included in the margin policy"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "INVALID_MAX_AMOUNT" in arrErrorTableStock, Set(IsError, true); Set(NoticationText,"Proposed Margined Amt All Clilent Brokerage is over 10% TVS's equity"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && ("EMPTY" in arrErrorTableStock || "HAVE_NON_TICKER_ROW" in arrErrorTableStock), Set(IsError, true); Set(NoticationText, TextRequired); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "IN_NOT_ALLOWED_LIST" in arrErrorTableStock, Set(IsError, true); Set(NoticationText, "This ticker is on the list of stock are not allowed for margin trading"); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "ONLY_DIGIT" in arrErrorTableStock, Set(IsError, true); Set(NoticationText, "The data is invalid. Please check again."); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "NOT_INTEGER_NOT_MULTIPLE_OF_5_AND_LESS_THAN_50" in arrErrorTableStock, Set(IsError, true); Set(NoticationText, "Margin ratio field data is invalid."); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "INVALID_COMPARE_BKR" in arrErrorTableStock, Set(IsError, true); Set(NoticationText, "Input fields must be larger than fields in the current policy."); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "INVALID_COMPARE_RS_AND_RM" in arrErrorTableStock, Set(IsError, true); Set(NoticationText, "Input fields >= fields in current policy and <= fields in Broker."); UpdateContext({ShowNotification: true}),
                        !typeOneClient && "INVALID_PERCLIENT_BIGGER_THAN_ALLCLIENT" in arrErrorTableStock, Set(IsError, true); Set(NoticationText, "Proposed Margined Per Client must less than Proposed Margined All Client"); UpdateContext({ShowNotification: true}),
                    	Set(isValid, true);
                        // end # one client
                        // end validate
                    );
                    
                    If(StockTableControl1.Data.action = "SAVE_RECORD" || (StockTableControl1.Data.action = "SUBMIT_RECORD" && isValid),
                    UpdateContext({ShowNotification: false});
                    Set(isLoading, true);
                    Set(oneClientBroke, Blank());
                    Clear(listBrokerageReq);
                    Clear(listAttachmentInsertMargin);
                    If(marginType = "One Client" ,
                        ClearCollect(listBrokerageReq, {
                        risk_management_opinion:If(IsBlank(DropdownOneClientRMOOp.Text),"",DropdownOneClientRMOOp.Text),
                        proposed_margin_limit_amount_rm:If(IsBlank(PML_Input.Text),"0", Text(Value(PML_Input.Text))),
                        proposed_margin_limit_amount:If(IsBlank(ProposalML_Input.Text),"0", Text(Value(ProposalML_Input.Text))),
                        proposed_interest_rate:If(IsBlank(ProposalInterestRate_Input.Text),"",Text(Value(ProposalInterestRate_Input.Text))),
                        proposed_margin_ratio:"",
                        proposed_margined_loan_amt_per_client:"",
                        proposed_margined_loan_amt_all_client:"",
                        id:"",
                        max_margin_ratio_cp: "",
                        max_margined_amt_per_client_cp: "",
                        max_margined_amt_all_client_cp: "",
                        research_opinion:"",
                        proposed_margin_ratio_re:"",
                        proposed_margined_loan_amt_per_client_re:"",
                        proposed_margin_ratio_rm:"",
                        proposed_margined_loan_amt_per_client_rm:"",
                        proposed_margined_loan_amt_all_client_rm:"",
                        proposed_margined_qty_all_client_rm:"",
                        proposed_margined_qty_one_client_rm:"",
                        comment_rm:If(IsBlank(Cmt_Input.Text),"",Cmt_Input.Text),
                        proposed_interest_rate_rm: If(IsBlank(PIR_Input.Text),"",PIR_Input.Text),
                        ticker:"",
                        proposed_margined_loan_amt_all_client_re:""
                        })
                    );
                    ForAll(Filter(listAttachFile,(IsDeleted <> true && !IsBlank(Id) && IsBlank(id_record))), Collect(listAttachmentInsertMargin, {
                        file_name:ThisRecord.Name,
                        created_by:First(currentUserV2Res).id,
                        value:ThisRecord.Value,
                        file_path: urlUploadMarginHead & ThisRecord.Name,
                        container: bucketMargin
                    }));
                    ForAll(Filter(listAttachFile, IsDeleted = true && !IsBlank(id_record)), Collect(listAttachmentDeleteReq,{
                        id:ThisRecord.id_record
                    }));
                    
                    If(First(marginDetail1.brokerage).id <> Blank(), UpdateIf(listBrokerageReq, true, {id: First(marginDetail1.brokerage).id}));
                    
                    If(CountRows(StockTableControl1.Data.tableData) > 0,
                    Set(isMaxRm, First(Filter(StockTableControl1.Data.tableData, Value(If(isDotFormat, proposed_margined_loan_amt_all_client_rm, Substitute(proposed_margined_loan_amt_all_client_rm, ".", ","))) =
                    Max(Filter(StockTableControl1.Data.tableData, !IsBlank(id)), proposed_margined_loan_amt_all_client_rm)
                    )).proposed_margined_loan_amt_all_client_rm),
                    Set(isMaxRm, "")
                    );
                    
                    If(First(marginDetail1.proposal).status <> "PENDING_RISK_MANAGERMENTS_OPINION", Set(dataOC, listBrokerageReq), Set(dataOC, Filter(listBrokerageReq, IsBlank(id))));
                    Set(dataInsertStock, Filter(StockTableControl1.Data.tableData, IsBlank(id)));
                    Set(dataUpdateStock, Filter(StockTableControl1.Data.tableData, !IsBlank(id)));
                    
                    Set(dataTable, StockTableControl1.Data.tableData);
                    
                    If(marginType = "One Client", ClearCollect(listBrokerage, dataOC), ClearCollect(listBrokerage, dataInsertStock));
                    If(marginType = "One Client", ClearCollect(listBrokerageUpdate, listBrokerageReq), ClearCollect(listBrokerageUpdate, Filter(StockTableControl1.Data.tableData, !IsBlank(id))));
                    
                    If(marginType = "One Client", ClearCollect(listBrokerageDeleteNew, RenameColumns(ShowColumns(Filter(listBrokerageReq, IsBlank(id)), id), id, Value)), ClearCollect(listBrokerageDeleteNew, StockTableControl1.Data.deleteRecords));
                    
                    Clear(listBrokerageAddNo);
                    ForAll(listBrokerage, 
                       Collect(listBrokerageAddNo, 
                         Last(FirstN(AddColumns(listBrokerage, No, CountRows(listBrokerageAddNo)+1),
                            CountRows(listBrokerageAddNo)+1
                             ) 
                         )
                       )
                    );
                    
                    // nu l to mi hoc submit t draft th ly master data ca thi im 
                    If(marginType <> "One Client",
                        If(StockTableControl1.Data.action = "SUBMIT_RECORD" && (marginDetail.status = "DRAFT" || IsBlank(marginDetail.status)),
                        ClearCollect(listBrokerageAddNoAddColumns,
                        AddColumns(AddColumns(AddColumns(listBrokerageAddNo, 
                        max_margined_qty_per_client_cp, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client)), 
                        max_margined_qty_all_client_cp, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client)), 
                        market_cp, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).market),
                        current_policy_id, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).id),
                        stock_liquidity_score, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score), "", LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score)
                        ));
                    
                    ClearCollect(listBrokerageUpdateNoAddColumns,
                        AddColumns(AddColumns(AddColumns(listBrokerageUpdate, 
                        max_margined_qty_per_client_cp, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client)), 
                        max_margined_qty_all_client_cp, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client)), 
                        market_cp, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).market),
                        current_policy_id, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).id),
                        stock_liquidity_score, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score), "", LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score)
                        )),
                    ClearCollect(listBrokerageAddNoAddColumns,
                        AddColumns(AddColumns(AddColumns(listBrokerageAddNo, 
                        max_margined_qty_per_client_cp, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_per_client_cp), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_per_client_cp )), 
                        max_margined_qty_all_client_cp, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_all_client_cp), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_all_client_cp)), 
                        market_cp, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).market_cp), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).market), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).market_cp),
                        current_policy_id, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).id),
                        stock_liquidity_score, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).stock_liquidity_score), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score), "", LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).stock_liquidity_score)
                        ));
                        ClearCollect(listBrokerageUpdateNoAddColumns,
                            AddColumns(AddColumns(AddColumns(listBrokerageUpdate, 
                            max_margined_qty_per_client_cp, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_per_client_cp), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_per_client), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_per_client_cp )), 
                            max_margined_qty_all_client_cp, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_all_client_cp), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client), "", LookUp(PolicyList1, stock_id = ticker).max_margined_quantity_all_client), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).max_margined_qty_all_client_cp)), 
                            market_cp, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).market_cp), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).market), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).market_cp),
                            current_policy_id, If(IsBlank(LookUp(PolicyList1, stock_id = ticker).market), "", LookUp(PolicyList1, stock_id = ticker).id),
                            stock_liquidity_score, If(IsBlank(LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).stock_liquidity_score), If(IsBlank(LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score), "", LookUp(PolicyList1, stock_id = ticker).stock_liquidity_score), LookUp(marginDetail1.brokerage As itemBr, itemBr.ticker = ticker).stock_liquidity_score)
                            ));
                        );
                    );
                    
                    Set(oneClientBroke,{
                        proposal_name: If(IsBlank(proposalNameInput),"",proposalNameInput),
                        company_name: If(IsBlank(CompanyName_Input.Text),"",CompanyName_Input.Text),
                        client_id: If(IsBlank(ClientID_Input.Text),"",ClientID_Input.Text),
                        policy_list_check: If(InMarginPolicyCheckbox.Value = true,"1","0"),
                        margin_ratio_check: If(MarginRatioCheckbox.Value = true, "1", "0"),
                        margined_amt_per_client_check: If(MarginedAmtPerClientCheckbox.Value = true,"1","0"),
                        margined_amt_all_client_check: If(MarginedAmtAllClientCheckbox.Value = true, "1","0"),
                        max_margin_limit_amount: If(IsBlank(MaxML_Input.Text),"", Text(Value(MaxML_Input.Text))),
                        note: If(IsBlank(Note_Input_1.Text),"",Note_Input_1.Text),
                        status: If(marginType = "One Client",If(Value(ProposalML_Input.Text) <= 4,"APPROVED", Value(ProposalML_Input.Text) > 4 && Value(ProposalML_Input.Text) < 15, "PENDING_RISK_MANAGERMENTS_OPINION"),"PENDING_RESEARCHS_OPINION"),
                        listAttachment: listAttachmentInsertMargin,
                        listAttachmentDelete:listAttachmentDeleteReq ,
                        listBrokerage: listBrokerageAddNoAddColumns,
                        listBrokerageUpdate: listBrokerageUpdateNoAddColumns,
                        listBrokerageDelete: listBrokerageDeleteNew
                    });
                    
                    Switch(
                        StockTableControl1.Data.action,
                        "SAVE_RECORD",
                        Set(resSaveProposal,'TVS->CreateProposalBrokeOMSProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close,First(currentUserV2Res).id,JSON(oneClientBroke,JSONFormat.IndentFour),If(IsBlank(marginDetail),"0",marginDetail.id),If(IsBlank(marginDetail),"",marginDetail.status), marginType,envDEV,envTEST,envUAT1,envUAT2,false, If(IsBlank(isMaxRm), "", isMaxRm)));
                        //Patch(marginDetail,{id:resSaveProposal.id,status:resSaveProposal.statusupdate});
                        Set(marginDetail,{id:resSaveProposal.id, status:resSaveProposal.statusupdate,proposal_name:If(IsBlank(proposalNameInput),"",proposalNameInput)});
                    If(resSaveProposal.status = "200",
                        Set(marginDetail1,'TVS->FindByIdProposalONSProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close, resSaveProposal.id,envDEV,envTEST,envUAT1,envUAT2));
                        If(CountRows(marginDetail1.brokerage) > 0, Set(dataRecordTable, marginDetail1.brokerage));
                        Clear(marginDetailAttachment);
                        ForAll(marginDetail1.attachment,Collect(marginDetailAttachment,{
                            id_record:ThisRecord.id,
                            Name:ThisRecord.file_name,
                            By: ThisRecord.created_by
                        }));
                        ClearCollect(listAttachFile,marginDetailAttachment);
                        Set(isLoading, false);    
                        Set(IsError, false);
                        Set(NoticationText,"Saved successfully!");
                        UpdateContext({ShowNotification: true}),
                        Set(IsError, true);
                        Set(NoticationText,"Saved failed!");
                        UpdateContext({ShowNotification: true})
                    );
                    
                    ForAll(listAttachmentInsertMargin,AzureBlobStorage.CreateFile(bucketMargin,ThisRecord.file_name,ThisRecord.value));
                    Set(saveEvent, 0)
                        ,
                        "SUBMIT_RECORD",
                        Clear(dataBrokeOldNew);
                    ForAll(StockTableControl1.Data.tableData As item, 
                        Collect(dataBrokeOldNew, {
                            ticker: item.ticker, 
                            max_margined_amt_per_client: Text(item.max_margined_amt_per_client_cp), 
                            max_margined_amt_all_client: Text(item.max_margined_amt_all_client_cp),
                            max_margined_quantity_per_client: If(IsBlank(LookUp(PolicyList1, stock_id = item.ticker).max_margined_quantity_per_client), "", LookUp(PolicyList1, stock_id = item.ticker).max_margined_quantity_per_client),
                            max_margined_quantity_all_client: If(IsBlank(LookUp(PolicyList1, stock_id = item.ticker).max_margined_quantity_all_client), "", LookUp(PolicyList1, stock_id = item.ticker).max_margined_quantity_all_client),
                        market: If(IsBlank(LookUp(PolicyList1, stock_id = item.ticker).market), "", LookUp(PolicyList1, stock_id = item.ticker).market),
                        margin_ratio: item.max_margin_ratio_cp,
                           stock_liquidity_score: If(IsBlank(LookUp(PolicyList1, stock_id = item.ticker).stock_liquidity_score), "", LookUp(PolicyList1, stock_id = item.ticker).stock_liquidity_score)
                        }));
                        Set(listMasterDataBroke, {listMasterDataBroke: dataBrokeOldNew});
                        
                        If(IsBlank(marginDetail.status) || marginDetail.status = "DRAFT",
                            Set(checkErrorMarginPolicy, 'TVS->CheckProposalMasterData_Procoess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close, Text(marginDetail.id), 
                            JSON(listMasterDataBroke,JSONFormat.IndentFour)))
                        );
                    
                    If(checkErrorMarginPolicy.policystatus = "401",
                            Concurrent(
                                ClearCollect(PolicyList1, 'TVS->GetCurrentPolicyList'.Run(resKeyOpenAll.open, resKeyOpenAll.close,envDEV,envTEST,envUAT1,envUAT2).listCurrentPolicy),
                                ClearCollect(unTradingList,'TVS->GetCurrentUnTradingList'.Run(resKeyOpenAll.open, resKeyOpenAll.close,envDEV,envTEST,envUAT1,envUAT2).listUnTrading)
                            );
                            Set(isLoading, false);
                            Set(IsError, true); 
                            Set(NoticationText,"There are discrepancies between the current policy column and the Margin policy list. Please check again.");
                            UpdateContext({ShowNotification: true})
                        ,
                        Set(resCreateProposal,'TVS->CreateProposalBrokeOMSProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close,First(currentUserV2Res).id,JSON(oneClientBroke,JSONFormat.IndentFour),If(IsBlank(resSaveProposal), If(IsBlank(marginDetail),"0",marginDetail.id), resSaveProposal.id),If(IsBlank(marginDetail),"",marginDetail.status), marginType,envDEV,envTEST,envUAT1,envUAT2,true, If(IsBlank(isMaxRm), "", isMaxRm)));
                    If(resCreateProposal.status = "200",
                        Set(ShowNotificationCheck, "CREATED_SUCCESS");
                        Navigate(TableMarginLimit,ScreenTransition.Fade),
                        Set(isLoading, false);
                        Set(IsError, true); 
                        Set(NoticationText,"This record has been processed by another user, please reload this page.");
                        UpdateContext({ShowNotification: true});
                    );
                    ForAll(listAttachmentInsertMargin,
                    AzureBlobStorage.CreateFile(
                                    bucketMargin,
                                    ThisRecord.file_name,
                                    ThisRecord.value
                                );
                    );
                    Set(urlMail, "<a href='" & linkToApp & "?screen=detail-ml&action=approve-ml&ml_id=" & resCreateProposal.id & "'>Link to item</a>");
                    'TVS->SendNotiEmail-Process4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,resCreateProposal.statusupdate,First(currentUserV2Res).id,If(IsBlank(marginDetail),"",marginDetail.status),resCreateProposal.id,If(IsBlank(marginDetail),proposalNameInput,marginDetail.proposal_name),First(currentUserV2Res).name,urlMail,appProperty,emailFromConfix))
                    );
                    Set(saveEvent, 0);
                    Set(submitEvent, 0);
                    ));
                Opinions_Items: |-
                    =[{value: "Agree", label: "Agree"}, {value: "Disagree", label: "Disagree"}, {value: "Partially Agree", label: "Partially Agree"}]
                Records_Items: =dataRecordTable
                SaveEvent: =saveEvent
                SubmitEvent: =submitEvent
                Visible: =DealDetailTab = 1 && marginLimitType <> "One Client"
                Width: =White_Background_10.Width - If(App.Width > 600, 70, 40)
                X: =MarginedAmtAllClientCheckbox.X
                Y: =If(MarginedAmtAllClientCheckbox.Visible, MarginedAmtAllClientCheckbox.Y + MarginedAmtAllClientCheckbox.Height, InMarginPolicyCheckbox.Y + InMarginPolicyCheckbox.Height)
                ZIndex: =76

    Button4_2 As button:
        Font: =Font.Arial
        OnSelect: =Set(isShowApprove, !isShowApprove)
        Text: ="Button"
        Visible: =false
        X: =1280
        Y: =316
        ZIndex: =21

    DetailProposalName_Title_6 As label:
        Color: =RGBA(255, 0, 0, 1)
        Font: =Font.Arial
        Height: =20
        LineHeight: =2.2
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Size: =10.5
        Text: =LabelRequired.Text
        Visible: =(showRejectPopup || showApprovePopup || showRevisePopup) && (isSummitedPopup && Len(DetailProposalReason_Input.Text) = 0)
        Width: =159
        X: =DetailProposalReason_Input.X
        Y: =DetailProposalReason_Input.Y + DetailProposalReason_Input.Height
        ZIndex: =22

    Button2_6 As button:
        Font: =Font.Arial
        OnSelect: |-
            =Set(ShowNotificationCheck, "ACCESS_DENIED_PROPOSAL");
            Navigate(Dashboard, ScreenTransition.Fade)
        Text: ="Button"
        Visible: =false
        X: =140
        Y: =140
        ZIndex: =23

    MenuItemsSideBar_Small_21 As MenuItemsSideBar_Small:
        Height: =Parent.Height - Self.Y
        MenuItems: |-
            =Table(
                {
                    MenuLabel: "Dashboard",
                    MenuIcon: MenuItemsSideBar_Small_21.IconDasboard,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 1,
                    MenuIconDropDown: MenuItemsSideBar_Small_21.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_Small_21.IconDropUp,
                    Submenu: []
                },
                {
                    MenuLabel: "Portal",
                    MenuIcon: MenuItemsSideBar_Small_21.IconSettings,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 2,
                    MenuIconDropDown: MenuItemsSideBar_Small_21.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_Small_21.IconDropUp,
                    Submenu: Table(
                        {
                            MenuLabel: "'Information of non-listed compan",
                            MenuIcon: MenuItemsSideBar_Small_21.IconDasboard,
                            MenuScreenNavigate: Portal,
                            MenuID: 2.1
                        },
                        {
                            MenuLabel: "Comunication Records (Minutes of meeting)",
                            MenuIcon: MenuItemsSideBar_Small_21.IconDasboard,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 2.2
                        },
                        {
                            MenuLabel: "Investment Research",
                            MenuIcon: MenuItemsSideBar_Small_21.IconDasboard,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 2.3
                        }
                    )
                },
                {
                    MenuLabel: "Business process",
                    MenuIcon: MenuItemsSideBar_Small_21.IconFile,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 3,
                    MenuIconDropDown: MenuItemsSideBar_Small_21.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_Small_21.IconDropUp,
                    Submenu: Table(
                        {
                            MenuLabel: "M&A",
                            MenuIcon: MenuItemsSideBar_Small_21.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 3.1
                        },
                        {
                            MenuLabel: "Fixed Income Investment ProcessA",
                            MenuIcon: MenuItemsSideBar_Small_21.IconFile,
                            MenuScreenNavigate: TableProposalQT2,
                            MenuID: 3.2
                        },
                        {
                            MenuLabel: "Margin limit approvalprocess (ad-hoc)",
                            MenuIcon: MenuItemsSideBar_Small_21.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 3.3
                        },
                        {
                            MenuLabel: "PEVC",
                            MenuIcon: MenuItemsSideBar_Small_21.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 3.4
                        }
                    )
                },
                {
                    MenuLabel: "Admin",
                    MenuIcon: MenuItemsSideBar_Small_21.IconSettings,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 4,
                    MenuIconDropDown: MenuItemsSideBar_Small_21.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_Small_21.IconDropUp,
                    Submenu: Table(
                        {
                            MenuLabel: "Manager Authoiation&A",
                            MenuIcon: MenuItemsSideBar_Small_21.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 4.1
                        },
                        {
                            MenuLabel: "Decentralization",
                            MenuIcon: MenuItemsSideBar_Small_21.IconFile,
                            MenuScreenNavigate: TableProposalQT2,
                            MenuID: 4.2
                        }
                    )
                }
            )
        Visible: =App.Width > 800 && !MobileShowMenu
        Y: =56
        ZIndex: =24

    MenuItemsSideBar_16 As MenuItemsSideBar:
        Height: =Parent.Height - Self.Y
        MenuItems: |-
            =Table(
                {
                    MenuLabel: "Dashboard",
                    MenuIcon: MenuItemsSideBar_16.IconDasboard,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 1,
                    MenuIconDropDown: MenuItemsSideBar_16.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_16.IconDropUp,
                    Submenu: []
                },
                {
                    MenuLabel: "Portal",
                    MenuIcon: MenuItemsSideBar_16.IconSettings,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 2,
                    MenuIconDropDown: MenuItemsSideBar_16.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_16.IconDropUp,
                    Submenu: Table(
                        {
                            MenuLabel: "'Information of non-listed compan",
                            MenuIcon: MenuItemsSideBar_16.IconDasboard,
                            MenuScreenNavigate: Portal,
                            MenuID: 2.1
                        },
                        {
                            MenuLabel: "Comunication Records (Minutes of meeting)",
                            MenuIcon: MenuItemsSideBar_16.IconDasboard,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 2.2
                        },
                        {
                            MenuLabel: "Investment Research",
                            MenuIcon: MenuItemsSideBar_16.IconDasboard,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 2.3
                        }
                    )
                },
                {
                    MenuLabel: "Business process",
                    MenuIcon: MenuItemsSideBar_16.IconFile,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 3,
                    MenuIconDropDown: MenuItemsSideBar_16.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_16.IconDropUp,
                    Submenu: Table(
                        {
                            MenuLabel: "M&A",
                            MenuIcon: MenuItemsSideBar_16.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 3.1
                        },
                        {
                            MenuLabel: "Fixed Income Investment ProcessA",
                            MenuIcon: MenuItemsSideBar_16.IconFile,
                            MenuScreenNavigate: TableProposalQT2,
                            MenuID: 3.2
                        },
                        {
                            MenuLabel: "Margin limit approvalprocess (ad-hoc)",
                            MenuIcon: MenuItemsSideBar_16.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 3.3
                        },
                        {
                            MenuLabel: "PEVC",
                            MenuIcon: MenuItemsSideBar_16.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 3.4
                        }
                    )
                },
                {
                    MenuLabel: "Admin",
                    MenuIcon: MenuItemsSideBar_16.IconSettings,
                    MenuScreenNavigate: Dashboard,
                    MenuID: 4,
                    MenuIconDropDown: MenuItemsSideBar_16.IconDropDown,
                    MenuIconDropUp: MenuItemsSideBar_16.IconDropUp,
                    Submenu: Table(
                        {
                            MenuLabel: "Manager Authoration&A",
                            MenuIcon: MenuItemsSideBar_16.IconFile,
                            MenuScreenNavigate: Dashboard,
                            MenuID: 4.1
                        },
                        {
                            MenuLabel: "Decentralization",
                            MenuIcon: MenuItemsSideBar_16.IconFile,
                            MenuScreenNavigate: TableProposalQT2,
                            MenuID: 4.2
                        }
                    )
                }
            )
        Visible: =MobileShowMenu
        Width: =If(App.Width > 600, 240, App.Width)
        Y: =56
        ZIndex: =25

    Header_9 As Header:
        ZIndex: =26

    NotificationScreen_18 As NotificationScreen:
        Visible: =ShowNotificationPopup
        ZIndex: =27

    ButtonMR As button:
        Font: =Font.Arial
        OnSelect: |-
            =Set(ShowNotificationCheck, "ACCESS_DENIED_IR");
            Navigate(WelcomePage, ScreenTransition.Fade)
        Text: ="Button"
        Visible: =false
        X: =120
        Y: =120
        ZIndex: =37

    DeleteConfirm_7 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =39

        RejectPopupBack_20 As rectangle:
            Fill: =RGBA(0.3, 0.3, 0.3, 0.3)
            Height: =Parent.Height
            Visible: =isShowPopupDelete
            Width: =Parent.Width
            ZIndex: =38

        DeleteConfirmBg_17 As htmlViewer:
            Font: =Font.Arial
            Height: =If(Parent.Width > 600, 200, 200)
            HtmlText: |-
                ="<div style='margin-left: 8px; width: calc(100% - 16px); height: "& Self.Height - 20 &"px; background-color: white; border-radius: 12px;box-shadow: 5px 4px 8px 0px rgba(0, 0, 0, 0.10);
                '></div>"
            PaddingRight: =5.00
            PaddingTop: =5.00
            Size: =11.00
            Visible: =isShowPopupDelete
            Width: =If(App.Width > 600, 550, App.Width + 5)
            X: =If(App.Width > 600, App.Width * 0.5 - DeleteConfirmBg_17.Width *0.5, -3)
            Y: =App.Height / 2 - Self.Height
            ZIndex: =39

        CancelResearchOpinionButton_14 As button:
            BorderColor: =Self.Color
            BorderThickness: =1
            Color: =RGBA(214, 27, 27, 1)
            DisabledBorderColor: =RGBA(214, 27, 27, 1)
            DisabledColor: =RGBA(214, 27, 27, 1)
            DisabledFill: =RGBA(0, 0, 0, 0)
            Fill: =RGBA(0, 0, 0, 0)
            FocusedBorderThickness: =1
            Font: =Font.Arial
            Height: =44
            HoverColor: =RGBA(214, 27, 27, 1)
            HoverFill: =ColorFade(Self.Fill , -15%)
            OnSelect: |-
                =Set(varEncryptionDeleteSelectedId, Blank());
                Set(isShowPopupDelete, false);
            PressedBorderColor: =RGBA(214, 27, 27, 1)
            PressedColor: =RGBA(214, 27, 27, 1)
            PressedFill: =
            Size: =10.5
            Text: ="No"
            Visible: =isShowPopupDelete
            Width: =120
            X: =DeleteConfirmBg_17.X + DeleteConfirmBg_17.Width - 280
            Y: =DeleteConfirmBg_17.Y + DeleteConfirmBg_17.Height - 70
            ZIndex: =40

        DeleteResearchOpinionButton_14 As button:
            BorderThickness: =
            DisabledBorderColor: =RGBA(214, 27, 27, 1)
            DisabledColor: =RGBA(255, 255, 255, 1)
            DisabledFill: =RGBA(214, 27, 27, 1)
            Fill: =RGBA(214, 27, 27, 1)
            FocusedBorderThickness: =
            Font: =Font.Arial
            Height: =44
            HoverFill: =ColorFade(Self.Fill , -15%)
            OnSelect: |-
                =Set(isLoading, true);
                //Set(deleteStatus, 'TVS->DeleteProposal_Process3'.Run(idProposalDelete, env, resKeyOpenAll.open, resKeyOpenAll.close).status);
                //If(Value(deleteStatus) = 200,
                Set(ShowNotificationCheck, "DELETED_SUCCESS");
                Navigate(TableProposalQT2, ScreenTransition.Fade);
                Set(isShowPopupDelete, false); Set(IsSuccess, false);Set(NoticationText,"This proposal has been processed by another user, please reload this page again.");UpdateContext({ShowNotification: true});
                Set(isLoading, false);
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =RGBA(214, 27, 27, 1)
            Size: =10.5
            Text: ="Yes"
            Visible: =isShowPopupDelete
            Width: =120
            X: =DeleteConfirmBg_17.X + DeleteConfirmBg_17.Width - 150
            Y: =DeleteConfirmBg_17.Y + DeleteConfirmBg_17.Height - 70
            ZIndex: =41

        DeleteConfirmCloseIcon_19 As icon.Cancel:
            Color: =RGBA(26, 26, 26, 1)
            Height: =20
            Icon: =Icon.Cancel
            OnSelect: |-
                =Set(varEncryptionDeleteSelectedId, Blank());
                Set(isShowPopupDelete, false);
            Visible: =isShowPopupDelete
            Width: =20
            X: =DeleteConfirmBg_17. X + DeleteConfirmBg_17.Width -50
            Y: =DeleteConfirmBg_17.Y + 20
            ZIndex: =42

        DeleteConfirmLabel_20 As label:
            Font: =Font.Arial
            Size: =12
            Text: ="Are you sure to delete this proposal?"
            Visible: =isShowPopupDelete
            Width: =DeleteConfirmBg_17.Width - 100 - DeleteConfirmCloseIcon_19.Width
            X: =Label2_13.X
            Y: =Label2_13.Y + Label2_13.Height
            ZIndex: =43

        Label2_13 As label:
            Font: =Font.Arial
            FontWeight: =FontWeight.Bold
            Size: =14
            Text: ="Delete"
            Visible: =isShowPopupDelete
            X: =DeleteConfirmBg_17.X + 30
            Y: =DeleteConfirmBg_17.Y + 10
            ZIndex: =44

    SubHeaderGroup_5 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =53

        SubHeaderBg_8 As rectangle:
            BorderColor: =RGBA(255, 255, 255, 1)
            Fill: =RGBA(255, 255, 255, 1)
            Height: =56
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Width: =Parent.Width - If(Parent.Width > 800, If(MobileShowMenu, 240, 50), 0)
            X: =If(Parent.Width > 800, If(MobileShowMenu, 240, 50), 0)
            Y: =56
            ZIndex: =2

        IconBack_8 As icon.ArrowLeft:
            Color: =RGBA(0, 0, 0, 1)
            Height: =If(App.Width > 600, 25, 15)
            Icon: =If(App.Width > 600, Icon.ArrowLeft, Icon.ChevronLeft)
            OnSelect: |-
                =//Reset field
                Navigate(TableMarginLimit, ScreenTransition.Fade);
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Width: =If(App.Width > 600, 25, 25)
            X: =SubHeaderBg_8.X + 5
            Y: =SubHeaderBg_8.Y + If(App.Width > 600, 16, 20)
            ZIndex: =3

        LabelTitle_5 As label:
            Font: =Font.Arial
            FontWeight: =FontWeight.Bold
            Height: =19
            Size: =If(App.Width > 600, 10.5, 9)
            Text: =If(IsBlank(marginDetail) && IsBlank(resSaveProposal), CreateProposalName_Input_2.Text, If(!IsBlank(resSaveProposal.id), resSaveProposal.id, marginDetail.id) & " - " & If(IsBlank(marginDetail), CreateProposalName_Input_2.Text, marginDetail.proposal_name))
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Width: =If(btnReject_5.Visible, btnReject_5.X, SaveButton_8.Visible, SaveButton_8.X, btnSubmit_5.Visible, btnSubmit_5.X, btnSend.Visible, btnSend.X, btnSubmit_5.X + btnSubmit_5.Width) - Self.X
            Wrap: =false
            X: =If(App.Width > 600, IconBack_8.X + IconBack_8.Width + 10, BackMobile_Label_5.X + BackMobile_Label_5.Width + 5)
            Y: =IconBack_8.Y - If(App.Width > 600, 5, 8)
            ZIndex: =4

        LabelSubTitle_5 As label:
            Font: =Font.Arial
            Height: =19
            Size: =If(App.Width > 600, 10.5, 9)
            Text: |-
                =If(App.Width > 600, "Last edited user: ", "")& If(IsBlank(marginDetail1), currenUserV2.name
                , First(marginDetail1.proposal).write_by &" "& If(IsBlank(marginDetail1), Text(Now(), "dd/mm/yyyy hh:mm:ss"), Text(DateTimeValue(First(marginDetail1.proposal).write_date),"dd/mm/yyyy hh:mm:ss"))) &""
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Width: =LabelTitle_5.Width
            Wrap: =false
            X: =LabelTitle_5.X
            Y: =LabelTitle_5.Y + LabelTitle_5.Height
            ZIndex: =5

        SaveButton_8 As htmlViewer:
            BorderStyle: =BorderStyle.Solid
            Font: =Font.Arial
            Height: =50
            HtmlText: |-
                ="<div style=""width: 40px; height: 38px; display: flex; justify-content: center; align-items: center; border: 1px solid black; border-radius: 5px; cursor: pointer""><svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                  <path d=""M21 7V19C21 19.55 20.804 20.021 20.412 20.413C20.02 20.805 19.5493 21.0007 19 21H5C4.45 21 3.979 20.804 3.587 20.412C3.195 20.02 2.99934 19.5493 3 19V5C3 4.45 3.196 3.979 3.588 3.587C3.98 3.195 4.45067 2.99934 5 3H17L21 7ZM19 7.85L16.15 5H5V19H19V7.85ZM12 18C12.8333 18 13.5417 17.7083 14.125 17.125C14.7083 16.5417 15 15.8333 15 15C15 14.1667 14.7083 13.4583 14.125 12.875C13.5417 12.2917 12.8333 12 12 12C11.1667 12 10.4583 12.2917 9.875 12.875C9.29167 13.4583 9 14.1667 9 15C9 15.8333 9.29167 16.5417 9.875 17.125C10.4583 17.7083 11.1667 18 12 18ZM6 10H15V6H6V10ZM5 7.85V19V5V7.85Z"" fill=""#525252""/>
                </svg></div>"
            OnSelect: |-
                =UpdateContext({ShowNotification: false});
                If(marginType <> "One Client",
                Set(saveEvent, 1),
                Set(isLoading, true);
                Set(oneClientBroke,Blank());
                Clear(listBrokerageReq);
                Clear(listAttachmentInsertMargin);
                If(marginType = "One Client" ,
                    ClearCollect(listBrokerageReq, {
                    risk_management_opinion:If(IsBlank(DropdownOneClientRMOOp.Text),"",DropdownOneClientRMOOp.Text),
                    proposed_margin_limit_amount_rm:If(IsBlank(PML_Input.Text),"0", Text(Value(PML_Input.Text))),
                    proposed_margin_limit_amount: If(IsBlank(ProposalML_Input.Text),"0", Text(Value(ProposalML_Input.Text))),
                    proposed_interest_rate: If(IsBlank(ProposalInterestRate_Input.Text),"",Text(Value(ProposalInterestRate_Input.Text))),
                    proposed_margin_ratio:"",
                    proposed_margined_loan_amt_per_client:"",
                    proposed_margined_loan_amt_all_client:"",
                    id:"",
                    max_margin_ratio_cp:"",
                    max_margined_amt_per_client_cp:"", 
                    max_margined_amt_all_client_cp:"",
                    research_opinion:"",
                    proposed_margin_ratio_re:"",
                    proposed_margined_loan_amt_per_client_re:"",
                    proposed_margin_ratio_rm:"",
                    proposed_margined_loan_amt_per_client_rm:"",
                    proposed_margined_loan_amt_all_client_rm:"",
                    proposed_margined_qty_all_client_rm:"",
                    proposed_margined_qty_one_client_rm:"",
                    comment_rm:If(IsBlank(Cmt_Input.Text),"",Cmt_Input.Text),
                    proposed_interest_rate_rm: If(IsBlank(PIR_Input.Text),"",PIR_Input.Text),
                    ticker:"",
                    proposed_margined_loan_amt_all_client_re:""
                    })
                );
                Clear(listAttachmentInsertMargin);
                ForAll(Filter(listAttachFile,(IsDeleted <> true||IsBlank(IsDeleted)) && IsBlank(id_record)),Collect(listAttachmentInsertMargin,{
                    file_name:ThisRecord.Name,
                    created_by:First(currentUserV2Res).id,
                    value:ThisRecord.Value,
                    file_path: urlUploadMarginHead & ThisRecord.Name,
                    container: bucketMargin
                }));
                ForAll(Filter(listAttachFile,IsDeleted=true && ! IsBlank(id_record)),Collect(listAttachmentDeleteReq,{
                    id:ThisRecord.id_record
                }));
                
                If(First(marginDetail1.brokerage).id <> Blank(), UpdateIf(listBrokerageReq, true, {id: First(marginDetail1.brokerage).id}));
                
                If(CountRows(Filter(StockTableControl1.Data.tableData, !IsBlank(id))) > 0,
                Set(isMaxRm, First(Filter(Filter(StockTableControl1.Data.tableData, !IsBlank(id)), Max(Value(proposed_margined_loan_amt_all_client_rm)))).proposed_margined_loan_amt_all_client_rm),
                Set(isMaxRm, "")
                );
                
                If(First(marginDetail1.proposal).status <> "PENDING_RISK_MANAGERMENTS_OPINION", Set(dataOC, listBrokerageReq), Set(dataOC, Filter(listBrokerageReq, IsBlank(id))));
                Set(dataInsertStock, Filter(StockTableControl1.Data.tableData, IsBlank(id)));
                Set(dataUpdateStock, Filter(StockTableControl1.Data.tableData, !IsBlank(id)));
                
                ClearCollect(listBrokerage, dataOC);
                ClearCollect(listBrokerageUpdate, listBrokerageReq);
                ClearCollect(listBrokerageDeleteNew, RenameColumns(ShowColumns(Filter(listBrokerageReq, IsBlank(id)), id), id, Value));
                ClearCollect(listBrokerageDeleteNew, RenameColumns(ShowColumns(Filter(listBrokerageReq, IsBlank(id)), id), id, Value));
                
                Clear(listBrokerageAddNo);
                ForAll (listBrokerage, 
                   Collect(listBrokerageAddNo, 
                     Last(FirstN(AddColumns(listBrokerage, No, CountRows(listBrokerageAddNo)+1),
                        CountRows(listBrokerageAddNo)+1
                         ) 
                     )
                   )
                );
                
                Set(oneClientBroke, {
                    proposal_name: If(IsBlank(proposalNameInput),"",proposalNameInput),
                    company_name: If(IsBlank(CompanyName_Input.Text),"",CompanyName_Input.Text),
                    client_id: If(IsBlank(ClientID_Input.Text),"",ClientID_Input.Text),
                    policy_list_check: "0",
                    margin_ratio_check: "0",
                    margined_amt_per_client_check: "0",
                    margined_amt_all_client_check: "0",
                    max_margin_limit_amount: If(IsBlank(MaxML_Input.Text),"", Text(Value(MaxML_Input.Text))),
                    note: If(IsBlank(Note_Input_1.Text),"",Note_Input_1.Text),
                    status: If(marginType = "One Client",If(Value(ProposalML_Input.Text) <= 4,"APPROVED", Value(ProposalML_Input.Text) > 4 && Value(ProposalML_Input.Text) < 15, "PENDING_RISK_MANAGERMENTS_OPINION"),"PENDING_RESEARCHS_OPINION"),
                    listAttachment: listAttachmentInsertMargin,
                    listAttachmentDelete:listAttachmentDeleteReq ,
                    listBrokerage: Filter(listBrokerageAddNo, IsBlank(id)),
                    listBrokerageUpdate: listBrokerageUpdate,
                    listBrokerageDelete: listBrokerageDeleteNew
                });
                
                Set(resSaveProposal,'TVS->CreateProposalBrokeOMSProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close,First(currentUserV2Res).id,JSON(oneClientBroke,JSONFormat.IndentFour),If(IsBlank(marginDetail),"0",marginDetail.id),If(IsBlank(marginDetail),"",marginDetail.status), marginType,envDEV,envTEST,envUAT1,envUAT2,false, If(IsBlank(isMaxRm), "", isMaxRm)));
                    //Patch(marginDetail,{id:resSaveProposal.id,status:resSaveProposal.statusupdate});
                    Set(marginDetail,{id:resSaveProposal.id, status:resSaveProposal.statusupdate,proposal_name:If(IsBlank(proposalNameInput),"",proposalNameInput)});
                    Set(marginDetail1,'TVS->FindByIdProposalONSProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close, resSaveProposal.id,envDEV,envTEST,envUAT1,envUAT2));
                    Clear(marginDetailAttachment);
                    ForAll(marginDetail1.attachment,Collect(marginDetailAttachment,{
                        id_record:ThisRecord.id,
                        Name:ThisRecord.file_name,
                        By: ThisRecord.created_by
                    }));
                    ClearCollect(listAttachFile,marginDetailAttachment);
                    Set(isLoading, false);
                    If(resSaveProposal.status = "200",
                    Set(IsError, false);
                    Set(NoticationText,"Saved successfully!");
                    UpdateContext({ShowNotification: true}),
                    Set(IsError, true);
                    Set(NoticationText,"Saved failed!");
                    UpdateContext({ShowNotification: true})
                    );
                    If(resSaveProposal.status = "200",
                    Set(IsError, false);
                    Set(NoticationText,"Saved successfully!");
                    UpdateContext({ShowNotification: true}),
                    Set(IsError, true);
                    Set(NoticationText,"Saved failed!");
                    UpdateContext({ShowNotification: true})
                );
                
                ForAll(listAttachmentInsertMargin,AzureBlobStorage.CreateFile(bucketMargin,ThisRecord.file_name,ThisRecord.value));
                
                Set(saveEvent, 0);
                Set(submitEvent, 0);
                )                      
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =btnSubmit_5.Visible
            Width: =If(Self.Visible, 43, 0)
            X: =btnSubmit_5.X - Self.Width - 8
            Y: =btnReject_5.Y + If(App.Width > 600, 1, 0)
            ZIndex: =6

        btnSubmit_5 As button:
            BorderColor: =Self.Fill
            BorderThickness: =0
            DisabledFill: =Self.Fill
            Fill: =RGBA(17, 79, 144, 1)
            FocusedBorderThickness: =0
            Font: =Font.Arial
            FontWeight: =FontWeight.Lighter
            HoverColor: =Self.Color
            HoverFill: =Self.Fill
            OnSelect: |+
                =UpdateContext({ShowNotification: false});
                Set(isSubmited, true);
                Set(equityAmountFormattedNew, If(isDotFormat, equityAmountFormatted, Substitute(equityAmountFormatted, ".", ",")));
                If(typeOneClient,
                If(
                // validate
                    typeOneClient && IsBlank(Trim(ClientID_Input.Text)), Set(IsError, true); Set(NoticationText,"Client ID is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(Trim(CompanyName_Input.Text)), Set(IsError, true); Set(NoticationText,"Company Name is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(Trim(MaxML_Input.Text)), Set(IsError, true); Set(NoticationText,"Max Margin Limit (Amount) is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(Trim(ProposalML_Input.Text)), Set(IsError, true); Set(NoticationText,"Proposed Margin Limit (Amount) is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(Trim(ProposalInterestRate_Input.Text)), Set(IsError, true); Set(NoticationText,"Proposed Interest rate is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(equityAmountFormatted), Set(IsError, true); Set(NoticationText,"Please contact the risk management director to set up the TVS's equity field value"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(Trim(DropdownOneClientRMOOp.Text)) && !isBrokerage, Set(IsError, true); Set(NoticationText,"Risk Managements Opinion is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(Trim(PML_Input.Text)) && !isBrokerage, Set(IsError, true); Set(NoticationText,"Proposed Margin Limit (Amount) is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && IsBlank(Trim(PIR_Input.Text)) && !isBrokerage, Set(IsError, true); Set(NoticationText,"Proposed Interest rate is required!"); UpdateContext({ShowNotification: true}),
                    typeOneClient && isBrokerage && Value(If(isDotFormat, ProposalML_Input.Text, Substitute(ProposalML_Input.Text, ".", ","))) > (Value(equityAmountFormattedNew) * 0.03), Set(IsError, true); Set(NoticationText,"Proposed Margin Limit(Amount) is over 3% TVS's equity"); UpdateContext({ShowNotification: true}),
                    typeOneClient && isRiskManager && Value(If(isDotFormat, PML_Input.Text, Substitute(PML_Input.Text, ".", ","))) > (Value(equityAmountFormattedNew) * 0.03), Set(IsError, true); Set(NoticationText,"Proposed Margin Limit(Amount) is over 3% TVS's equity"); UpdateContext({ShowNotification: true}),
                    Set(isLoading, true);
                Set(oneClientBroke,Blank());
                Clear(listBrokerageReq);
                Clear(listAttachmentInsertMargin);
                If(marginType = "One Client",
                    ClearCollect(listBrokerageReq, {
                    risk_management_opinion:If(IsBlank(DropdownOneClientRMOOp.Text),"",DropdownOneClientRMOOp.Text),
                    proposed_margin_limit_amount_rm:If(IsBlank(PML_Input.Text),"0", Text(PML_Input.Text)),
                    proposed_margin_limit_amount:If(IsBlank(ProposalML_Input.Text),"0", Text(ProposalML_Input.Text)),
                    proposed_interest_rate:If(IsBlank(ProposalInterestRate_Input.Text),"",Text(ProposalInterestRate_Input.Text)),
                    proposed_margin_ratio:"",
                    proposed_margined_loan_amt_per_client:"",
                    proposed_margined_loan_amt_all_client:"",
                    id:"",
                    max_margin_ratio_cp:"",
                    max_margined_amt_per_client_cp:"",
                    max_margined_amt_all_client_cp:"",
                    research_opinion:"",
                    proposed_margin_ratio_re:"",
                    proposed_margined_loan_amt_per_client_re:"",
                    proposed_margin_ratio_rm:"",
                    proposed_margined_loan_amt_per_client_rm:"",
                    proposed_margined_loan_amt_all_client_rm:"",
                    proposed_margined_qty_all_client_rm:"",
                    proposed_margined_qty_one_client_rm:"",
                    comment_rm:If(IsBlank(Cmt_Input.Text),"",Cmt_Input.Text),
                    proposed_interest_rate_rm: If(IsBlank(PIR_Input.Text),"",PIR_Input.Text),
                    ticker:"",
                    proposed_margined_loan_amt_all_client_re:""
                    })
                );
                
                ForAll(Filter(listAttachFile,(IsDeleted <> true||IsBlank(IsDeleted)) &&  IsBlank(id_record)),Collect(listAttachmentInsertMargin,{
                    file_name:ThisRecord.Name,
                    created_by:First(currentUserV2Res).id,
                    value:ThisRecord.Value,
                    file_path: urlUploadMarginHead & ThisRecord.Name,
                    container: bucketMargin
                }));
                ForAll(Filter(listAttachFile,IsDeleted=true && !IsBlank(id_record)),Collect(listAttachmentDeleteReq,{
                    id:ThisRecord.id_record
                }));
                
                If(First(marginDetail1.brokerage).id <> Blank(), UpdateIf(listBrokerageReq, true, {id: First(marginDetail1.brokerage).id}));
                
                If(CountRows(Filter(StockTableControl1.Data.tableData, !IsBlank(id))) > 0,
                Set(isMaxRm, First(Filter(Filter(StockTableControl1.Data.tableData, !IsBlank(id)), Max(Value(If(isDotFormat, proposed_margined_loan_amt_all_client_rm, Substitute(proposed_margined_loan_amt_all_client_rm, ".", ",")))))).proposed_margined_loan_amt_all_client_rm),
                Set(isMaxRm, "")
                );
                
                If(First(marginDetail1.proposal).status <> "PENDING_RISK_MANAGERMENTS_OPINION", Set(dataOC, listBrokerageReq), Set(dataOC, Filter(listBrokerageReq, IsBlank(id))));
                Set(dataInsertStock, Filter(StockTableControl1.Data.tableData, IsBlank(id)));
                Set(dataUpdateStock, Filter(StockTableControl1.Data.tableData, !IsBlank(id)));
                
                ClearCollect(listBrokerage, dataOC);
                ClearCollect(listBrokerageUpdate, listBrokerageReq);
                ClearCollect(listBrokerageDeleteNew, RenameColumns(ShowColumns(Filter(listBrokerageReq, IsBlank(id)), id), id, Value));
                ClearCollect(listBrokerageDeleteNew, RenameColumns(ShowColumns(Filter(listBrokerageReq, IsBlank(id)), id), id, Value));
                
                Clear(listBrokerageAddNo);
                ForAll (listBrokerage, 
                   Collect(listBrokerageAddNo, 
                     Last(FirstN(AddColumns(listBrokerage, No, CountRows(listBrokerageAddNo)+1),
                        CountRows(listBrokerageAddNo)+1
                         ) 
                     )
                   )
                );
                
                Set(oneClientBroke,{
                    proposal_name: If(IsBlank(proposalNameInput),"",proposalNameInput),
                    company_name: If(IsBlank(CompanyName_Input.Text),"",CompanyName_Input.Text),
                    client_id: If(IsBlank(ClientID_Input.Text),"",ClientID_Input.Text),
                    policy_list_check: "0",
                    margin_ratio_check: "0",
                    margined_amt_per_client_check: "0",
                    margined_amt_all_client_check: "0",
                    max_margin_limit_amount: If(IsBlank(MaxML_Input.Text),"", Text(MaxML_Input.Text)),
                    note: If(IsBlank(Note_Input_1.Text),"",Note_Input_1.Text),
                    status: If(marginType = "One Client",If(Value(If(isDotFormat, ProposalML_Input.Text, Substitute(ProposalML_Input.Text, ".", ","))) <= 4,"APPROVED", Value(If(isDotFormat, ProposalML_Input.Text, Substitute(ProposalML_Input.Text, ".", ","))) > 4 && Value(If(isDotFormat, ProposalML_Input.Text, Substitute(ProposalML_Input.Text, ".", ","))) < 15, "PENDING_RISK_MANAGERMENTS_OPINION"),"PENDING_RESEARCHS_OPINION"),
                    listAttachment: listAttachmentInsertMargin,
                    listAttachmentDelete:listAttachmentDeleteReq ,
                    listBrokerage: Filter(listBrokerageAddNo, IsBlank(id)),
                    listBrokerageUpdate: listBrokerageUpdate,
                    listBrokerageDelete: listBrokerageDeleteNew
                });
                
                Set(resCreateProposal,'TVS->CreateProposalBrokeOMSProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close,First(currentUserV2Res).id,JSON(oneClientBroke,JSONFormat.IndentFour),If(IsBlank(resSaveProposal), If(IsBlank(marginDetail),"0",marginDetail.id), resSaveProposal.id),If(IsBlank(marginDetail),"",marginDetail.status), marginType,envDEV,envTEST,envUAT1,envUAT2,true, If(IsBlank(isMaxRm), "", isMaxRm)));
                If(resCreateProposal.status = "200",
                    Set(ShowNotificationCheck, "CREATED_SUCCESS");
                    Navigate(TableMarginLimit,ScreenTransition.Fade),
                    Set(IsError, true); Set(NoticationText,"This proposal has been processed by another user, please reload this page."); UpdateContext({ShowNotification: true});
                );
                ForAll(listAttachmentInsertMargin,
                AzureBlobStorage.CreateFile(
                                bucketMargin,
                                ThisRecord.file_name,
                                ThisRecord.value
                            );
                );
                Set(urlMail, "<a href='" & linkToApp & "?screen=detail-ml&action=approve-ml&ml_id=" & resCreateProposal.id & "'>Link to item</a>");
                'TVS->SendNotiEmail-Process4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,resCreateProposal.statusupdate,First(currentUserV2Res).id,If(IsBlank(marginDetail),"",marginDetail.status),resCreateProposal.id,If(IsBlank(marginDetail),proposalNameInput,marginDetail.proposal_name),First(currentUserV2Res).name,urlMail,appProperty,emailFromConfix);
                Set(saveEvent, 0);
                Set(submitEvent, 0);
                ),
                Set(submitEvent, Value(submitEvent) + 1)
                );
                Set(isLoading, false);
                
                
            PaddingLeft: =30
            PressedColor: =Self.Color
            PressedFill: =Self.Fill
            RadiusBottomLeft: =5
            RadiusBottomRight: =5
            RadiusTopLeft: =5
            RadiusTopRight: =5
            Size: =10.5
            Text: =If(App.Width > 800, "Submit", "")
            Tooltip: ="Submit"
            Visible: |
                =("RESEARCH_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) && First(marginDetail1.proposal).status in
                ["PENDING_RESEARCHS_OPINION"])
                ||
                ("RISK_MANAGER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) && First(marginDetail1.proposal).status in
                ["PENDING_RISK_MANAGERMENTS_OPINION","REVISED"] )
                ||
                ("BROKER_CREATE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) && 
                (IsBlank(marginDetail1) ||
                 First(marginDetail1.proposal).status in
                ["DRAFT"]))
            Width: =If(App.Width > 800, 90, 40)
            X: =App.Width - Self.Width - If(App.Width > 800, 30, 15)
            Y: =Header_8.Y + Header_8.Height + 8
            ZIndex: =7

        btnSubmitIcon_5 As htmlViewer:
            Font: =Font.Arial
            HtmlText: |-
                ="<div style=""width: 40px; height: 38px; display: flex; justify-content: center; align-items: center; cursor: pointer""><svg xmlns=""http://www.w3.org/2000/svg"" width=""25"" height=""24"" viewBox=""0 0 25 24"" fill=""none"">
                  <path d=""M5 2.25V21.75H20V7.2L19.775 6.975L15.275 2.475L15.05 2.25H5ZM6.5 3.75H14V8.25H18.5V20.25H6.5V3.75ZM15.5 4.8L17.45 6.75H15.5V4.8ZM12.5 9.75L9.5 12.75H11.75V16.5H13.25V12.75H15.5L12.5 9.75ZM9.5 17.25V18.75H15.5V17.25H9.5Z"" fill=""#FEFEFE""/>
                </svg></div>"
            OnSelect: =Select(btnSubmit_5)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =btnSubmit_5.Visible
            Width: =40
            X: =btnSubmit_5.X
            Y: =btnSubmit_5.Y
            ZIndex: =8

        btnApprove_4 As button:
            BorderColor: =Self.Fill
            BorderThickness: =0
            DisabledFill: =Self.Fill
            Fill: =RGBA(17, 79, 144, 1)
            FocusedBorderThickness: =0
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            HoverColor: =Self.Color
            HoverFill: =Self.Fill
            OnSelect: |-
                =Set(showApprovePopup, true);
                Set(isMLSummitedPopup, false);
                Reset(DetailMLReason_Input);
            PaddingLeft: =30
            PressedColor: =Self.Color
            PressedFill: =Self.Fill
            RadiusBottomLeft: =5
            RadiusBottomRight: =5
            RadiusTopLeft: =5
            RadiusTopRight: =5
            Size: =10.5
            Text: =If(App.Width > 800, "Approve", "")
            Tooltip: =// First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: |-
                =
                (First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action))
                ||
                (First(marginDetail1.proposal).status = "PENDING_CEO" && "CEO_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action))
                ||
                (
                (First(marginDetail1.proposal).status = "PENDING_INVESTMENT_COMMITEE" && "IC" in Split(First(currentUserV2Res).name_team,"#") )
                ) && (CountRows(Filter(marginDetail1.listIC As item, currenUserV2.id = item.employee_id && !IsBlank(item.action))) = 0)
                ||
                (
                (First(marginDetail1.proposal).status = "PENDING_RM&IC-SC" && "IC-SC" in First(currentUserV2Res).name_team )
                ) && (CountRows(Filter(marginDetail1.listIC_SC As item, currenUserV2.id = item.employee_id && !IsBlank(item.action))) = 0)
            Width: =If(Self.Visible, If(App.Width > 800, 100, 40), 0)
            X: =btnSubmit_5.X
            Y: =btnSubmit_5.Y
            ZIndex: =9

        ApproveIcon_4 As htmlViewer:
            Font: =Font.Arial
            HtmlText: |-
                ="<div style=""width: 40px; height: 38px; display: flex; justify-content: center; align-items: center; cursor: pointer""><svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                  <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M21.546 5.11155C21.8272 5.39285 21.9852 5.77431 21.9852 6.17205C21.9852 6.5698 21.8272 6.95126 21.546 7.23255L10.303 18.4756C10.1544 18.6242 9.97805 18.7421 9.7839 18.8225C9.58976 18.9029 9.38167 18.9443 9.17153 18.9443C8.96138 18.9443 8.75329 18.9029 8.55915 18.8225C8.365 18.7421 8.1886 18.6242 8.04003 18.4756L2.45403 12.8906C2.31076 12.7522 2.19649 12.5867 2.11787 12.4037C2.03926 12.2207 1.99788 12.0238 1.99615 11.8247C1.99442 11.6255 2.03237 11.428 2.10779 11.2436C2.18322 11.0593 2.29459 10.8918 2.43543 10.751C2.57627 10.6101 2.74375 10.4987 2.92809 10.4233C3.11244 10.3479 3.30996 10.3099 3.50913 10.3117C3.7083 10.3134 3.90513 10.3548 4.08813 10.4334C4.27114 10.512 4.43666 10.6263 4.57503 10.7696L9.17103 15.3656L19.424 5.11155C19.5633 4.97216 19.7287 4.86159 19.9108 4.78615C20.0928 4.71071 20.288 4.67188 20.485 4.67188C20.6821 4.67188 20.8772 4.71071 21.0593 4.78615C21.2413 4.86159 21.4067 4.97216 21.546 5.11155Z"" fill=""#FEFEFE""/>
                </svg></div>"
            OnSelect: =Select(btnApprove_4)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Tooltip: =// First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =btnApprove_4.Visible
            Width: =40
            X: =btnApprove_4.X
            Y: =btnApprove_4.Y
            ZIndex: =10

        btnRevise_4 As button:
            BorderColor: =Self.Fill
            BorderThickness: =0
            DisabledFill: =Self.Fill
            Fill: =RGBA(214, 117, 27, 1)
            FocusedBorderThickness: =0
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            HoverColor: =Self.Color
            HoverFill: =Self.Fill
            OnSelect: |-
                =Set(showRevisePopup, true);
                Set(isMLSummitedPopup, false);
                Reset(DetailMLReason_Input);
            PaddingLeft: =30
            PressedColor: =Self.Color
            PressedFill: =Self.Fill
            RadiusBottomLeft: =5
            RadiusBottomRight: =5
            RadiusTopLeft: =5
            RadiusTopRight: =5
            Size: =10.5
            Text: =If(App.Width > 800, "Revise", "")
            Tooltip: =// First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Width: =If(Self.Visible, If(App.Width > 800, 90, 40), 0)
            X: =btnApprove_4.X - Self.Width - 8
            Y: =Header_8.Y + Header_8.Height + 8
            ZIndex: =11

        ReviseIcon_4 As htmlViewer:
            Font: =Font.Arial
            HtmlText: |-
                ="<div style=""width: 40px; height: 38px; display: flex; justify-content: center; align-items: center; cursor: pointer""><svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                  <path d=""M9.505 21H4.5C4.10218 21 3.72064 20.842 3.43934 20.5607C3.15804 20.2794 3 19.8978 3 19.5V4.5C3 4.10218 3.15804 3.72064 3.43934 3.43934C3.72064 3.15804 4.10218 3 4.5 3H19.5C19.8978 3 20.2794 3.15804 20.5607 3.43934C20.842 3.72064 21 4.10218 21 4.5V9.515M14.5185 21H20.5C20.6326 21 20.7598 20.9473 20.8536 20.8536C20.9473 20.7598 21 20.6326 21 20.5V14.5175H9"" stroke=""white"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                  <path d=""M11.5 11.5L8.5 14.5L11.5 17.5"" stroke=""white"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                </svg></div>"
            OnSelect: =Select(btnRevise_4)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Tooltip: =// First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =btnRevise_4.Visible
            Width: =40
            X: =btnRevise_4.X + If(App.Width > 600, 2, 0)
            Y: =btnRevise_4.Y
            ZIndex: =12

        btnReject_5 As button:
            BorderColor: =Self.Fill
            BorderThickness: =0
            DisabledFill: =Self.Fill
            Fill: =RGBA(214, 27, 27, 1)
            FocusedBorderThickness: =0
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            HoverColor: =Self.Color
            HoverFill: =Self.Fill
            OnSelect: |-
                =Set(showRejectPopup, true);
                Set(isMLSummitedPopup, false);
                Reset(DetailMLReason_Input);
            PaddingLeft: =30
            PressedColor: =Self.Color
            PressedFill: =Self.Fill
            RadiusBottomLeft: =5
            RadiusBottomRight: =5
            RadiusTopLeft: =5
            RadiusTopRight: =5
            Size: =10.5
            Text: =If(App.Width > 800, "Reject", "")
            Tooltip: =// First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: |-
                =
                (First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action))
                ||
                (First(marginDetail1.proposal).status = "PENDING_CEO" && "CEO_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action))
                ||
                (First(marginDetail1.proposal).status = "PENDING_RM&IC-SC" && "IC-SC" in First(currentUserV2Res).name_team 
                 && (CountRows(Filter(marginDetail1.listIC_SC As item, currenUserV2.id = item.employee_id && !IsBlank(item.action))) = 0))
                ||
                (First(marginDetail1.proposal).status = "PENDING_INVESTMENT_COMMITEE" && "IC" in Split(First(currentUserV2Res).name_team,"#")  
                 && (CountRows(Filter(marginDetail1.listIC As item, currenUserV2.id = item.employee_id && !IsBlank(item.action))) = 0)
                )
            Width: =If(Self.Visible, If(App.Width > 800, 90, 40), 0)
            X: =If(proposalInfoEdit.proposal_status <> "PENDING_REVIEW_BY_INVESTMENT_COMMITEE", btnRevise_4.X, btnApprove_4.X) - Self.Width - 8
            Y: =Header_8.Y + Header_8.Height + 8
            ZIndex: =13

        RejectIcon_5 As icon.CancelBadge:
            Color: =RGBA(255, 255, 255, 1)
            Height: =20
            Icon: =Icon.CancelBadge
            OnSelect: =Select(btnReject_5)
            Tooltip: =// First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =btnReject_5.Visible
            Width: =20
            X: =btnReject_5.X + If(App.Width > 600, 12, 10)
            Y: =btnReject_5.Y + 10
            ZIndex: =14

        SubHeaderHr_9 As rectangle:
            Fill: =RGBA(191, 191, 192, 1)
            Height: =IconBack_8.Height + 10
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =App.Width > 600
            Width: =0.5
            X: =IconBack_8.X + IconBack_8.Width + 5
            Y: =IconBack_8.Y - 5
            ZIndex: =15

        BackMobile_Label_5 As label:
            Font: =Font.Arial
            Height: =30
            OnSelect: =Navigate(TableProposalQT2, ScreenTransition.Fade)
            Size: =10.5
            Text: ="Back"
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =App.Width < 600
            Width: =0
            X: =IconBack_8.X + IconBack_8.Width
            Y: =IconBack_8.Y - 7
            ZIndex: =16

        btnDelete_5 As button:
            BorderColor: =RGBA(255, 0, 0, 1)
            BorderThickness: =1
            DisabledFill: =Self.Fill
            Fill: =RGBA(0, 0, 0, 0)
            FocusedBorderThickness: =0
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            Height: =39
            HoverColor: =Self.Color
            HoverFill: =Self.Fill
            OnSelect: |-
                =Set(idProposalDelete, If(IsBlank(proposalInfoEdit), IdCreateProposal, proposalInfoEdit.id));
                Set(isShowPopupDelete, true);
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingTop: =0
            PressedColor: =Self.Color
            PressedFill: =Self.Fill
            RadiusBottomLeft: =5
            RadiusBottomRight: =5
            RadiusTopLeft: =5
            RadiusTopRight: =5
            Size: =10.5
            Text: =""
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =isShowDeleteButton
            Width: =40
            X: =SaveButton_8.X - Self.Width - 10
            Y: =btnSubmit_5.Y
            ZIndex: =17

        DeleteIcon_8 As htmlViewer:
            Font: =Font.Arial
            Height: =42
            HtmlText: |-
                ="<div style=""cursor:pointer; width:40px; height: 37px; display:flex; justify-content:center; align-items:center""><svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 16 16"" fill=""none"">
                  <path d=""M4.66683 2.66634C4.66683 2.31272 4.8073 1.97358 5.05735 1.72353C5.3074 1.47348 5.64654 1.33301 6.00016 1.33301H10.0002C10.3538 1.33301 10.6929 1.47348 10.943 1.72353C11.193 1.97358 11.3335 2.31272 11.3335 2.66634V3.99967H14.0002C14.177 3.99967 14.3465 4.06991 14.4716 4.19494C14.5966 4.31996 14.6668 4.48953 14.6668 4.66634C14.6668 4.84315 14.5966 5.01272 14.4716 5.13775C14.3465 5.26277 14.177 5.33301 14.0002 5.33301H13.2875L12.7095 13.4277C12.6856 13.7641 12.535 14.0789 12.2882 14.3087C12.0415 14.5386 11.7167 14.6663 11.3795 14.6663H4.62016C4.28292 14.6663 3.95821 14.5386 3.71142 14.3087C3.46463 14.0789 3.31411 13.7641 3.29016 13.4277L2.7135 5.33301H2.00016C1.82335 5.33301 1.65378 5.26277 1.52876 5.13775C1.40373 5.01272 1.3335 4.84315 1.3335 4.66634C1.3335 4.48953 1.40373 4.31996 1.52876 4.19494C1.65378 4.06991 1.82335 3.99967 2.00016 3.99967H4.66683V2.66634ZM6.00016 3.99967H10.0002V2.66634H6.00016V3.99967ZM4.0495 5.33301L4.62083 13.333H11.3802L11.9515 5.33301H4.0495ZM6.66683 6.66634C6.84364 6.66634 7.01321 6.73658 7.13823 6.8616C7.26326 6.98663 7.3335 7.1562 7.3335 7.33301V11.333C7.3335 11.5098 7.26326 11.6794 7.13823 11.8044C7.01321 11.9294 6.84364 11.9997 6.66683 11.9997C6.49002 11.9997 6.32045 11.9294 6.19542 11.8044C6.0704 11.6794 6.00016 11.5098 6.00016 11.333V7.33301C6.00016 7.1562 6.0704 6.98663 6.19542 6.8616C6.32045 6.73658 6.49002 6.66634 6.66683 6.66634ZM9.3335 6.66634C9.51031 6.66634 9.67988 6.73658 9.8049 6.8616C9.92992 6.98663 10.0002 7.1562 10.0002 7.33301V11.333C10.0002 11.5098 9.92992 11.6794 9.8049 11.8044C9.67988 11.9294 9.51031 11.9997 9.3335 11.9997C9.15668 11.9997 8.98712 11.9294 8.86209 11.8044C8.73707 11.6794 8.66683 11.5098 8.66683 11.333V7.33301C8.66683 7.1562 8.73707 6.98663 8.86209 6.8616C8.98712 6.73658 9.15668 6.66634 9.3335 6.66634Z"" fill=""#D00C0C""/>
                </svg></div>"
            OnSelect: |-
                =Set(idProposalDelete, If(IsBlank(proposalInfoEdit), IdCreateProposal, proposalInfoEdit.id));
                Set(isShowPopupDelete, true);
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Tooltip: =First(marginDetail1.proposal).status = "PENDING_VICE_MANAGER" && "VICE_MANAGER_APPROVE" in LookUp(currenUserV2.permissionList,process_code = "Process4",action) 
            Visible: =btnDelete_5.Visible
            Width: =42
            X: =btnDelete_5.X
            Y: =btnDelete_5.Y
            ZIndex: =18

        btnSend As button:
            BorderColor: =Self.Fill
            BorderThickness: =0
            DisabledFill: =Self.Fill
            Fill: =RGBA(17, 79, 144, 1)
            FocusedBorderThickness: =0
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            HoverColor: =Self.Color
            HoverFill: =Self.Fill
            OnSelect: |-
                =UpdateContext({ShowNotification: false});
                Set(isSubmited, true);
                If( IsBlank(Subject_inpt.Text),Set(NoticationText, "Subject is required!"); Set(IsError, true); UpdateContext({ShowNotification: true});,
                    IsBlank(SendTo_input.Text), Set(NoticationText, "Send to is required!"); Set(IsError, true); UpdateContext({ShowNotification: true});,
                Set(isLoading, true);
                Clear(listTemplateEmailRes);
                ForAll(listPolicyEmail, Collect(listTemplateEmailRes, 
                "<tr><td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&Text(ThisRecord.market)&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&ThisRecord.stock_no&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&Text(ThisRecord.be_margin_ratio)&"%</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&ThisRecord.be_loan_per_client&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&ThisRecord.be_qty_all_client&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&ThisRecord.be_qty_per_client&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&ThisRecord.be_loan_all_client&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&Text(ThisRecord.af_margin_ratio)&"%</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&ThisRecord.af_loan_per_client&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&Text(ThisRecord.af_loan_all_client)&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&Text(ThisRecord.af_qty_per_client)&"</span></span></span></td>"
                &
                "<td style=""border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap""><span style=""font-size:15px""><span style=""color:black""><span style=""font-family:Arial,sans-serif"">"&Text(ThisRecord.af_qty_all_client)&"</span></span></span></td></tr>"
                
                ));
                
                Set(headEmail,"<table cellspacing=""0"" style=""border-collapse:collapse; width:1992px"">
                	<tbody>
                		<tr>
                			<td style=""border-bottom:none; border-left:none; border-right:none; border-top:none; height:19px; vertical-align:bottom; white-space:nowrap; width:162px"">&nbsp;</td>
                			<td style=""border-bottom:none; border-left:none; border-right:none; border-top:none; vertical-align:bottom; white-space:nowrap; width:162px"">&nbsp;</td>
                			<td colspan=""5"" style=""background-color:#2f75b5; border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:1px solid black; text-align:center; vertical-align:bottom; white-space:nowrap; width:855px""><span style=""font-size:15px""><span style=""color:white""><span style=""font-family:Arial,sans-serif"">Before adjustment</span></span></span></td>
                			<td colspan=""5"" style=""background-color:#2f75b5; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:1px solid black; text-align:center; vertical-align:bottom; white-space:nowrap; width:855px""><span style=""font-size:15px""><span style=""color:white""><span style=""font-family:Arial,sans-serif"">After adjustment</span></span></span></td>
                		</tr>
                		<tr>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:1px solid black; border-right:1px solid black; border-top:1px solid black; height:100px; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Market</span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:1px solid black; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Stock No</span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; text-align:left; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Margin Ratio</span></strong></span></td>
                        <td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; vertical-align:top; white-space:normal; width:185px""><span style=""font-size:15px""><strong><span style=""color:black""><span style=""font-family:Arial,sans-serif"">Max Margined Amt Per Client</span></span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; vertical-align:top; white-space:normal; width:214px""><span style=""font-size:15px""><strong><span style=""color:black""><span style=""font-family:Arial,sans-serif"">Max Margined Amt All Client</span></span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; text-align:left; vertical-align:top; white-space:normal; width:185px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Max Margined Qty Per Client</span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; text-align:left; vertical-align:top; white-space:normal; width:185px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Max Margined Qty All Client</span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; text-align:left; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Margin Ratio</span></strong></span></td>
                            <td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""color:black""><span style=""font-family:Arial,sans-serif"">Max Margined Amt Per Client</span></span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""color:black""><span style=""font-family:Arial,sans-serif"">Max Margined Amt All Client</span></span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; text-align:left; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Max Margined Qty Per Client</span></strong></span></td>
                			<td style=""background-color:#ddebf7; border-bottom:1px solid black; border-left:none; border-right:1px solid black; border-top:none; text-align:left; vertical-align:top; white-space:normal; width:162px""><span style=""font-size:15px""><strong><span style=""font-family:Arial,sans-serif"">Max Margined Qty All Client</span></strong></span></td>
                		</tr>");
                        
                Set(tailEmail,"</tbody></table>");
                Set(resEmailTem, Substitute(If(IsBlank(lb_header_content.Text), "", lb_header_content.Text), Char(10), "<br>") & headEmail& Concat(listTemplateEmailRes, Value) & tailEmail & "<br>" & Substitute(If(IsBlank(lb_bottom_conent.Text), "", lb_bottom_conent.Text), Char(10), "<br>"));
                Clear(fileSendEmail);
                ForAll(AttachFile_6.Attachments,Collect(fileSendEmail,{ContentData: ThisRecord.Value, FileName:ThisRecord.Name, ContentId: GUID() ,
                ContentType:If(
                ".docx"in Lower(ThisRecord.Name),"application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                ".doc"in Lower(ThisRecord.Name),"application/msword",
                ".xls"in Lower(ThisRecord.Name),"application/vnd.ms-excel",
                ".xlsx"in Lower(ThisRecord.Name),"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                ".ppt"in Lower(ThisRecord.Name),"application/vnd.ms-powerpoint",
                ".pptx"in Lower(ThisRecord.Name),"application/vnd.openxmlformats-officedocument.presentationml.presentation",
                ".pdf"in Lower(ThisRecord.Name),"application/pdf",
                ".txt"in Lower(ThisRecord.Name),"text/plain",
                ".html"in Lower(ThisRecord.Name),"text/html",
                ".xml"in Lower(ThisRecord.Name),"application/xml, text/xml",
                ".csv"in Lower(ThisRecord.Name),"text/csv, application/vnd.ms-excel",
                ".jpg"in Lower(ThisRecord.Name),"image/jpeg",
                ".jpeg"in Lower(ThisRecord.Name),"image/jpeg",
                ".png"in Lower(ThisRecord.Name),"image/png",
                ".zip"in Lower(ThisRecord.Name),"application/zip, application/x-zip-compressed"
                )}));
                
                ForAll(AttachFile_6.Attachments,Collect(listAttachRes1,{file_name:ThisRecord.Name,type:"EMAIL_ATTACH"}));
                ForAll(AttachFile_5.Attachments,Collect(listAttachRes2,{file_name:ThisRecord.Name,type:"UPDATE_CHANGES"}));
                Clear(listAfterRes);
                ForAll(listPolicyEmail,Collect(listAfterRes,
                {after_margin_ratio:ThisRecord.af_margin_ratio,
                 after_quantity_per_client:ThisRecord.af_qty_per_client,
                 after_quantity_all_client:ThisRecord.af_qty_all_client,
                 after_loan_per_client:ThisRecord.af_loan_per_client,
                 after_loan_all_client:ThisRecord.af_loan_all_client,
                 id:ThisRecord.id}));
                ClearCollect(listAttachRes , listAttachRes1 ,listAttachRes2);
                Set(sendEmailTemplateRes,{listAttach:listAttachRes, listAfterRisk:listAfterRes,send_to:SendTo_input.Text,subject:Subject_inpt.Text,header_content: If(IsBlank(lb_header_content.Text), "", lb_header_content.Text),bottom_content: If(IsBlank(lb_bottom_conent.Text), "", lb_bottom_conent.Text)});
                
                'TVS->UpdateChanges-Process4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,marginDetail.id,JSON(sendEmailTemplateRes,JSONFormat.IndentFour),envDEV,envTEST,envUAT1,envUAT2,First(currentUserV2Res).id);
                
                SMTP.SendEmailV2({From:emailFromConfix, To: SendTo_input.Text, Subject: Subject_inpt.Text, Body: resEmailTem, IsHtml: true, Attachments: fileSendEmail});
                
                // Office365Outlook.SendEmailV2(SendTo_input.Text, Subject_inpt.Text, resEmailTem, {Attachments: AddColumns(RenameColumns(AttachFile_6.Attachments, "Value", "ContentBytes"), "@odata.type", "")});
                
                'TVS->SendNotiEmail-Process4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,"APPROVED",First(currentUserV2Res).id,marginDetail.status,marginDetail.id,marginDetail.proposal_name,First(currentUserV2Res).name,"",appProperty,emailFromConfix);
                    Set(ShowNotificationCheck, "SENT_SUCCESS");
                    UpdateContext({ShowNotification: true});
                    Navigate(TableMarginLimit,ScreenTransition.Fade)
                );
                Set(isLoading, false);
            PaddingLeft: =30
            PressedColor: =Self.Color
            PressedFill: =Self.Fill
            RadiusBottomLeft: =5
            RadiusBottomRight: =5
            RadiusTopLeft: =5
            RadiusTopRight: =5
            Size: =10.5
            Text: =If(App.Width > 800, "Send", "")
            Visible: =DealDetailTab=2 && isUpdateChange && marginDetail.status = "PENDING_UPDATE_CHANGES"
            Width: =If(Self.Visible, If(App.Width > 800, 90, 40), 0)
            X: =btnSubmit_5.X
            Y: =btnSubmit_5.Y
            ZIndex: =19

        iconSend As htmlViewer:
            Font: =Font.Arial
            HtmlText: |-
                ="<div style=""width: 40px; height: 38px; display: flex; justify-content: center; align-items: center; cursor: pointer""><svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                  <g clip-path=""url(#clip0_11253_90736)"">
                    <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M17.9912 6.00863L5.39919 10.5616L9.59419 12.9896L13.2932 9.28963C13.4808 9.10212 13.7353 8.99683 14.0005 8.99692C14.2658 8.99702 14.5202 9.10248 14.7077 9.29013C14.8952 9.47777 15.0005 9.73221 15.0004 9.99748C15.0003 10.2627 14.8948 10.5171 14.7072 10.7046L11.0072 14.4046L13.4372 18.5986L17.9912 6.00863ZM18.3142 3.76463C19.5092 3.33163 20.6672 4.48963 20.2342 5.68463L14.9522 20.2896C14.5182 21.4876 12.8822 21.6336 12.2432 20.5306L9.02619 14.9726L3.46819 11.7556C2.36519 11.1166 2.51119 9.48063 3.70919 9.04663L18.3142 3.76463Z"" fill=""white""/>
                  </g>
                  <defs>
                    <clipPath id=""clip0_11253_90736"">
                      <rect width=""24"" height=""24"" fill=""white""/>
                    </clipPath>
                  </defs>
                </svg></div>"
            OnSelect: =Select(btnSend)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Visible: =btnSend.Visible
            Width: =40
            X: =btnSend.X
            Y: =btnSend.Y
            ZIndex: =20

    LoadingComponent_11 As LoadingComponent:
        Visible: =isLoading
        ZIndex: =54

    Timer1_29 As timer:
        Duration: =3000
        Font: =Font.Arial
        OnTimerEnd: |-
            =Reset(Timer1_29); UpdateContext({ShowNotification: false}); Set(IsError, false);
        Start: =ShowNotification
        Visible: =false
        X: =160
        Y: =727
        ZIndex: =56

    DetailMLPopupGroup As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =56

        DetailMLPopupBack As rectangle:
            Fill: =RGBA(0.3, 0.3, 0.3, 0.3)
            Height: =App.Height
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =App.Width
            ZIndex: =45

        DetailMLPopupBg As htmlViewer:
            Font: =Font.Arial
            Height: =320
            HtmlText: |-
                ="<div style='width: calc(100% - 10px); height: "& Self.Height - 20 &"px; background-color: white; border-radius: 12px;box-shadow: 5px 4px 8px 0px rgba(0, 0, 0, 0.10);
                '></div>"
            PaddingRight: =5.00
            PaddingTop: =5.00
            Size: =11.00
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =If(Parent.Width > 600, 600, Parent.Width)
            X: =If(Parent.Width > 600, App.Width / 2 - Self.Width / 2, 0)
            Y: =(App.Height - Self.Height) / 2
            ZIndex: =46

        DetailML_Title As label:
            Font: =Font.Arial
            FontWeight: =FontWeight.Bold
            Height: =43
            LineHeight: =2.2
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =12
            Text: =If(showRejectPopup, "Reject this proposal?", showRevisePopup, "Revise this proposal?", "Approve this proposal?")
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =299
            X: =DetailMLPopupBg.X + 20
            Y: =DetailMLPopupBg.Y + 10
            ZIndex: =47

        DetailMLName_Title As label:
            Font: =Font.Arial
            Height: =43
            LineHeight: =2.2
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =10.5
            Text: ="Add your comment"
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =159
            X: =DetailML_Title.X
            Y: =DetailML_Title.Y + DetailML_Title.Height
            ZIndex: =48

        DetailMLReason_Input As text:
            BorderColor: =RGBA(191, 191, 192, 1)
            BorderThickness: =1
            Default: =
            FocusedBorderColor: =Self.HoverBorderColor
            FocusedBorderThickness: =1
            Font: =Font.Arial
            Height: =If(App.Width > 600, 140, 120)
            HintText: ="Input your comment."
            HoverFill: =RGBA(186, 202, 226, 0)
            Mode: =TextMode.MultiLine
            PaddingBottom: =10
            PaddingTop: =10
            Size: =If(App.Width > 600, 10.5, 12)
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =DetailMLPopupBg.Width - 50
            X: =DetailMLName_Title.X
            Y: =DetailMLName_Title.Y + DetailMLName_Title.Height
            ZIndex: =49

        DetailMLSubmitButton As button:
            BorderThickness: =0
            Fill: =If(showRejectPopup, RGBA(214, 27, 27, 1), showRevisePopup, RGBA(214, 117, 27, 1), RGBA(17, 79, 144, 1))
            FocusedBorderThickness: =0
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            Height: =44
            HoverFill: =ColorFade(Self.Fill , -15%)
            OnSelect: |-
                =UpdateContext({ShowNotification: false});
                Set(statusHandle, "301");
                Set(isValidMLApproveForm, true);
                Set(isLoading, true);
                
                Set(marginAmountReq, First(Filter(marginDetail1.brokerage, Value(proposed_margin_limit_amount) =
                Max(Filter(marginDetail1.brokerage, !IsBlank(id)), proposed_margin_limit_amount)
                )).proposed_margin_limit_amount);
                
                // ---- Setup ------
                If(showApprovePopup || (showRejectPopup || showRevisePopup),
                    Set(typeApproveReject, If(marginDetail.type_of_proposal = "One Client", "ONE_CLIENT", First(marginDetail1.proposal).policy_list_check = "1" && First(marginDetail1.proposal).margin_ratio_check="1"&&First(marginDetail1.proposal).margined_amt_all_client_check = "0"&&First(marginDetail1.proposal).margined_amt_per_client_check = "0", "MARGIN_RATIO","STOCK"));
                    Set(equityAmountFormatted, 'TVS->FindCurrentEquityProcess4'.Run(resKeyOpenAll.open,resKeyOpenAll.close,envDEV,envTEST,envUAT1,envUAT2).equity);
                    If(!IsBlank(First(marginDetail1.brokerage).proposed_margined_loan_amt_all_client_rm),
                    Set(marginAmountReq, First(Filter(marginDetail1.brokerage,
                        Value(If(isDotFormat, proposed_margined_loan_amt_all_client_rm, Substitute(proposed_margined_loan_amt_all_client_rm, ".", ","))) =
                    Max(Filter(marginDetail1.brokerage, !IsBlank(id)),
                        If(isDotFormat, proposed_margined_loan_amt_all_client_rm, Substitute(proposed_margined_loan_amt_all_client_rm, ".", ",")))
                    )).proposed_margined_loan_amt_all_client_rm)
                    ,
                    !IsBlank(First(marginDetail1.brokerage).proposed_margin_limit_amount_rm),
                    Set(marginAmountReq, First(Filter(marginDetail1.brokerage,
                        Value(If(isDotFormat, proposed_margin_limit_amount_rm, Substitute(proposed_margin_limit_amount_rm, ".", ","))) =
                    Max(Filter(marginDetail1.brokerage, !IsBlank(id)), If(isDotFormat, proposed_margin_limit_amount_rm, Substitute(proposed_margin_limit_amount_rm, ".", ",")))
                    )).proposed_margin_limit_amount_rm)
                    ,
                    Set(marginAmountReq, First(Filter(marginDetail1.brokerage,
                        Value(If(isDotFormat, proposed_margin_limit_amount, Substitute(proposed_margin_limit_amount, ".", ","))) =
                    Max(Filter(marginDetail1.brokerage, !IsBlank(id)), If(isDotFormat, proposed_margin_limit_amount, Substitute(proposed_margin_limit_amount, ".", ",")))
                    )).proposed_margin_limit_amount)
                    ),
                
                    Set(isValidMLApproveForm, false);
                    Set(IsError, true);Set(NoticationText,"Comment is required!");UpdateContext({ShowNotification: true});
                );
                // -----END Setup -----
                
                If(IsBlank(marginAmountReq), Set(marginAmountReq, "0"));
                
                If(showRejectPopup,
                    Set(isMLSummitedPopup, true);
                    // If(!IsBlank(DetailMLReason_Input.Text),
                    If(true,
                        Set(statusHandle,'TVS->ApproveReject-4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,"REJECT",typeApproveReject,First(currentUserV2Res).id,marginDetail.id,Text(DetailMLReason_Input.Text),envDEV,envTEST,envUAT1,envUAT2,marginDetail.status,marginAmountReq,equityAmountFormatted).status);
                        , false);
                , showRevisePopup,
                    Set(isMLSummitedPopup, true);
                    // If(!IsBlank(DetailMLReason_Input.Text),
                    If(true,
                        Set(statusHandle,'TVS->ApproveReject-4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,"REVISE",typeApproveReject,First(currentUserV2Res).id,marginDetail.id,Text(DetailMLReason_Input.Text),envDEV,envTEST,envUAT1,envUAT2,marginDetail.status,marginAmountReq,equityAmountFormatted).status);
                        ,false);
                , showApprovePopup,
                    Set(statusHandle,'TVS->ApproveReject-4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,"APPROVE",typeApproveReject,First(currentUserV2Res).id,marginDetail.id,Text(DetailMLReason_Input.Text),envDEV,envTEST,envUAT1,envUAT2,marginDetail.status,marginAmountReq,equityAmountFormatted).status); 
                );
                Set(isLoading, false);
                
                If(statusHandle <> "301",
                    Set(ShowNotificationCheck, If(showRejectPopup, "REJECTED_SUCCESS", showRevisePopup, "REVISED_SUCCESS", showApprovePopup, "APPROVED_SUCCESS"));
                    Set(showRejectPopup, false); Set(showRevisePopup, false); Set(showApprovePopup, false);
                    Navigate(TableMarginLimit,ScreenTransition.Fade);
                    Set(urlMail, "<a href='" & linkToApp & "?screen=detail-ml&action=approve-ml&ml_id=" & marginDetail.id & "'>Link to item</a>");
                    'TVS->SendNotiEmail-Process4-V1'.Run(resKeyOpenAll.open,resKeyOpenAll.close,statusHandle,First(currentUserV2Res).id,If(IsBlank(marginDetail),"",marginDetail.status),marginDetail.id,If(IsBlank(marginDetail),proposalNameInput,marginDetail.proposal_name),First(currentUserV2Res).name,urlMail,appProperty,emailFromConfix)
                    ,
                    If(isValidMLApproveForm,
                        Set(IsError, true);Set(NoticationText,"This proposal has been processed by another user, please reload this page.");
                        UpdateContext({ShowNotification: true});
                    );
                );
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            PressedColor: =Self.Color 
            PressedFill: =Self.Fill
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Size: =10.5
            Text: =If(showRejectPopup, "Reject", showRevisePopup, "Revise", "Approve")
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =120
            X: =DetailMLPopupBg.X + DetailMLPopupBg.Width - 150
            Y: =DetailMLPopupBg.Y + DetailMLPopupBg.Height - 70
            ZIndex: =50

        DetailMLCancelButton As button:
            BorderColor: =Self.Color
            BorderThickness: =1
            Color: =RGBA(139, 139, 139, 1)
            DisabledFill: =Self.Fill
            Fill: =RGBA(255, 255, 255, 1)
            FocusedBorderThickness: =1
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            Height: =44
            HoverBorderColor: =Self.BorderColor
            HoverColor: =Self.Color
            HoverFill: =ColorFade(Self.Fill , -15%)
            OnSelect: =Set(showRejectPopup, false); Set(showApprovePopup, false); Set(showRevisePopup, false);
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            PressedBorderColor: =Self.BorderColor
            PressedColor: =Self.Color 
            PressedFill: =Self.Fill
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Size: =10.5
            Text: ="Cancel"
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =120
            X: =DetailMLSubmitButton.X - 130 
            Y: =DetailMLPopupBg.Y + DetailMLPopupBg.Height - 70
            ZIndex: =51

        DetailMLPopupCloseIcon As icon.Cancel:
            Color: =RGBA(0, 0, 0, 1)
            Height: =20
            Icon: =Icon.Cancel
            OnSelect: =Set(showRejectPopup, false); Set(showApprovePopup, false); Set(showRevisePopup, false);
            Visible: =showRejectPopup || showApprovePopup || showRevisePopup
            Width: =20
            X: =DetailMLPopupBg.X + DetailMLPopupBg.Width - 50
            Y: =DetailML_Title.Y + 10
            ZIndex: =52

        DetailMLComment_Error As label:
            Color: =RGBA(255, 0, 0, 1)
            Font: =Font.Arial
            Height: =20
            LineHeight: =2.2
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =9
            Text: ="This field is required"
            Visible: |-
                =// DetailMLReason_Input.Visible && DetailMLReason_Input.BorderColor = RGBA(214, 27, 27, 1)
                false
            Width: =159
            X: =DetailML_Title.X
            Y: =DetailMLReason_Input.Y + DetailMLReason_Input.Height
            ZIndex: =53

    NotificationBox_27 As button:
        Align: =Align.Left
        BorderColor: =RGBA(40, 167, 69, 1)
        BorderThickness: =0
        DisabledFill: =Self.Fill
        Fill: =If(IsError, RGBA(209, 50, 50, 1), RGBA(40, 167, 69, 1))
        FocusedBorderThickness: =0
        Font: =Font.Arial
        Height: =50
        HoverBorderColor: =Self.Fill
        HoverFill: =Self.Fill
        PaddingLeft: =15
        PaddingRight: =30
        PressedColor: =RGBA(255, 255, 255, 1)
        PressedFill: =Self.Fill
        RadiusBottomLeft: =5
        RadiusBottomRight: =5
        RadiusTopLeft: =5
        RadiusTopRight: =5
        Size: =10.5
        Text: =NoticationText
        Visible: =Timer1_29.Value <> 0
        Width: =320
        X: =App.Width - Self.Width - 2
        Y: =100
        ZIndex: =57

    CloseNotiIcon_27 As icon.Cancel:
        Color: =RGBA(255, 255, 255, 1)
        Height: =15
        Icon: =Icon.Cancel
        OnSelect: =Reset(Timer1_29); Set(IsError, false);
        Visible: =NotificationBox_27.Visible
        Width: =15
        X: =NotificationBox_27.X + NotificationBox_27.Width - 25
        Y: =NotificationBox_27.Y + 17.5
        ZIndex: =58

    Button2_MR As button:
        Font: =Font.Arial
        OnSelect: |-
            =Set(ShowNotificationCheck, "ACCESS_DENIED_PROPOSAL");
            Navigate(Dashboard, ScreenTransition.Fade)
        Text: ="Button"
        Visible: =false
        X: =415
        Y: =664
        ZIndex: =59

    UpdateTable_ML As group:
        Height: =5
        Width: =5
        X: =120
        Y: =120
        ZIndex: =59

        CreateMRPopupBack_1 As rectangle:
            Fill: =RGBA(0, 0, 0, 0.6)
            Height: =App.Height
            Visible: =showTableMail
            Width: =App.Width
            ZIndex: =28

        CreateCRPopupBg_1 As htmlViewer:
            Font: =Font.Arial
            Height: =If(App.Width > 1400, 800, App.Height - 20)
            HtmlText: |-
                ="<div style='height: "& Self.Height - 20 &"px; background-color: white; border-radius: 12px;box-shadow: 5px 4px 8px 0px rgba(0, 0, 0, 0.10);
                '></div>"
            PaddingRight: =5.00
            PaddingTop: =5.00
            Size: =11.00
            Visible: =showTableMail
            Width: =App.Width - 30
            X: =10
            Y: =10
            ZIndex: =29

        UpdateTable_Title As label:
            Font: =Font.Arial
            FontWeight: =FontWeight.Bold
            Size: =12
            Text: ="Update content"
            Visible: =showTableMail
            X: =CreateCRPopupBg_1.X + 30
            Y: =CreateCRPopupBg_1.Y + 10
            ZIndex: =30

        CloseUpdateTable_Icon As icon.Cancel:
            Color: =RGBA(0, 0, 0, 1)
            Height: =20
            Icon: =Icon.Cancel
            OnSelect: =Select(DetailMLCancelButton_1);
            Visible: =showTableMail
            Width: =20
            X: =CreateCRPopupBg_1.X + CreateCRPopupBg_1.Width - Self.Width - 20
            Y: =CreateCRPopupBg_1.Y + 20
            ZIndex: =31

        Container12_1 As groupContainer.horizontalAutoLayoutContainer:
            DropShadow: =DropShadow.None
            Height: =185 + Gallery5_1.Height - If(App.Height < 800, 35, 0)
            LayoutMode: =LayoutMode.Auto
            LayoutOverflowX: =LayoutOverflow.Scroll
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Visible: =showTableMail
            Width: =CreateCRPopupBg_1.Width - 45
            X: =UpdateTable_Title.X
            Y: =input_content_email_mr.Y + input_content_email_mr.Height + 20
            ZIndex: =32

            Container13_1 As groupContainer.manualLayoutContainer:
                DropShadow: =DropShadow.None
                LayoutMinHeight: =100
                LayoutMinWidth: =1700
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                ZIndex: =1

                Header_after As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =0.5
                    Color: =RGBA(255, 255, 255, 1)
                    Fill: =RGBA(0, 94, 146, 1)
                    Font: =Font.Arial
                    Height: =44
                    Size: =10.5
                    Text: ="After adjustment"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =(Parent.Width - Header_before.X - 20) / 2
                    X: =Header_before.X + Header_before.Width
                    Y: =Header_before.Y
                    ZIndex: =2

                "Gallery5_1 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
                    '#CopilotOverlayLabel': ="Filtered"
                    DelayItemLoading: =true
                    Height: =Min(Self.AllItemsCount, 4) * Self.TemplateHeight + If(App.Width > 800, 0, 20)
                    Items: =listPolicyEmail
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplatePadding: =0
                    TemplateSize: =35
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_after.Width + Header_before.Width + Layout_overlay_send_mail.Width + 0.5 + 15
                    X: =Label3_12.X - 0.5
                    Y: =Label3_12.Y + Label3_12.Height
                    ZIndex: =3

                    be_loan_all_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.be_qty_all_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {be_loan_all_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =be_loan_per_client_1.X + be_loan_per_client_1.Width
                        ZIndex: =12

                    af_margin_ratio_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.af_margin_ratio
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {af_margin_ratio: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =be_loan_all_client_1.X + be_loan_all_client_1.Width
                        ZIndex: =13

                    af_qty_per_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.af_loan_per_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {af_loan_per_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =af_margin_ratio_1.X + af_margin_ratio_1.Width
                        ZIndex: =14

                    af_qty_all_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.af_loan_all_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {af_loan_all_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =af_qty_per_client_1.X + af_qty_per_client_1.Width
                        ZIndex: =15

                    af_loan_per_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.af_qty_all_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {af_qty_all_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =af_loan_all_client_1.X + af_loan_all_client_1.Width
                        ZIndex: =16

                    af_loan_all_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.af_qty_per_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {af_qty_per_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =af_qty_all_client_1.X + af_qty_all_client_1.Width
                        ZIndex: =17

                    market_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.market
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {market: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Label3_12.Width
                        X: =0.5
                        ZIndex: =18

                    stock_no_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.stock_no
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {stock_no: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Label3_12.Width
                        X: =market_1.X + market_1.Width
                        ZIndex: =19

                    be_margin_ratio_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.be_margin_ratio
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {be_margin_ratio: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =stock_no_1.X + stock_no_1.Width
                        ZIndex: =20

                    be_qty_per_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.be_loan_per_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {be_qty_per_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =be_margin_ratio_1.X + be_margin_ratio_1.Width
                        ZIndex: =21

                    be_qty_all_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.be_loan_all_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {be_qty_all_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =be_qty_per_client_1.X + be_qty_per_client_1.Width
                        ZIndex: =22

                    be_loan_per_client_1 As text:
                        BorderColor: =RGBA(192, 192, 192, 1)
                        BorderThickness: =0.5
                        Default: =ThisItem.be_qty_per_client
                        DisplayMode: =DisplayMode.Disabled
                        FocusedBorderColor: =Self.HoverBorderColor
                        FocusedBorderThickness: =0.5
                        Font: =Font.Arial
                        Height: =35
                        HoverFill: =
                        OnChange: |-
                            =UpdateIf(listPolicyEmail, guid = ThisItem.guid, {be_loan_per_client: Self.Text});
                        OnSelect: =Select(Parent)
                        PressedFill: =
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Size: =If(App.Width > 800,10.5,12)
                        Width: =Header_before.Width / 5
                        X: =be_qty_all_client_1.X + be_qty_all_client_1.Width
                        ZIndex: =23

                    Before_Ratio_Percent As label:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 1)
                        Color: =If(be_qty_per_client_1.DisplayMode = DisplayMode.Edit, be_qty_per_client_1.Color, be_qty_per_client_1.DisabledColor)
                        DisabledFill: =RGBA(255, 0, 0, 1)
                        Font: =Font.Arial
                        Height: =35
                        Size: =10.5
                        Text: ="%"
                        Visible: =be_qty_per_client_1.Visible
                        Width: =25
                        X: =be_qty_per_client_1.X + be_qty_per_client_1.Width - Self.Width
                        ZIndex: =24

                    After_Ratio_Percent As label:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 1)
                        Color: =If(af_margin_ratio_1.DisplayMode = DisplayMode.Edit, af_margin_ratio_1.Color, af_margin_ratio_1.DisabledColor)
                        DisabledFill: =RGBA(255, 0, 0, 1)
                        Font: =Font.Arial
                        Height: =35
                        Size: =10.5
                        Text: ="%"
                        Visible: =af_margin_ratio_1.Visible
                        Width: =25
                        X: =af_margin_ratio_1.X + af_margin_ratio_1.Width - Self.Width
                        ZIndex: =25

                Label3_12 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Market"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =(Layout_overlay_send_mail.Width / 2 )
                    X: =Layout_overlay_send_mail.X
                    Y: =Layout_overlay_send_mail.Y + Layout_overlay_send_mail.Height + 1
                    ZIndex: =4

                Label3_13 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Stock No"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Label3_12.Width
                    X: =Label3_12.X + Label3_12.Width
                    Y: =Label3_12.Y
                    ZIndex: =5

                Label3_14 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Margin Ratio"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_23.X + Label3_23.Width
                    Y: =Label3_23.Y
                    ZIndex: =6

                Label3_15 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Amt Per Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_19.X + Label3_19.Width
                    Y: =Label3_19.Y
                    ZIndex: =7

                Label3_16 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Amt All Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_20.X + Label3_20.Width
                    Y: =Label3_20.Y
                    ZIndex: =8

                Label3_17 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Qty Per Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_16.X + Label3_16.Width
                    Y: =Label3_16.Y
                    ZIndex: =9

                Label3_18 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Qty All Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5 - 1
                    X: =Label3_17.X + Label3_17.Width
                    Y: =Label3_17.Y
                    ZIndex: =10

                Label3_19 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Margin Ratio"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_13.X + Label3_13.Width
                    Y: =Label3_13.Y
                    ZIndex: =11

                Label3_20 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Amt Per Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_14.X + Label3_14.Width
                    Y: =Label3_14.Y
                    ZIndex: =12

                Label3_21 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Amt All Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_15.X + Label3_15.Width
                    Y: =Label3_15.Y
                    ZIndex: =13

                Label3_22 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Qty Per Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_21.X + Label3_21.Width
                    Y: =Label3_21.Y
                    ZIndex: =14

                Label3_23 As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =1
                    DisabledFill: =RGBA(255, 0, 0, 1)
                    Fill: =RGBA(215, 223, 240, 1)
                    Font: =Font.Arial
                    Height: =80
                    Size: =10.5
                    Text: ="Max Margined Qty All Client"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =Header_before.Width / 5
                    X: =Label3_22.X + Label3_22.Width
                    Y: =Label3_22.Y
                    ZIndex: =15

                Header_before As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 1)
                    BorderThickness: =0.5
                    Color: =RGBA(255, 255, 255, 1)
                    Fill: =RGBA(0, 94, 146, 1)
                    Font: =Font.Arial
                    Height: =44
                    Size: =10.5
                    Text: ="Before adjustment"
                    Visible: =DealDetailTab=2 && tableEmailMargin
                    Width: =(Parent.Width - Header_before.X - 20) / 2
                    X: =Layout_overlay_send_mail.X + Layout_overlay_send_mail.Width
                    Y: =Layout_overlay_send_mail.Y
                    ZIndex: =16

                Layout_overlay_send_mail As rectangle:
                    BorderColor: =RGBA(255, 255, 255, 1)
                    BorderThickness: =0.5
                    Fill: =RGBA(0, 0, 0, 0)
                    Height: =43
                    Width: =170
                    X: =1
                    ZIndex: =19

        DetailMLCancelButton_1 As button:
            BorderColor: =Self.Color
            BorderThickness: =1
            DisabledFill: =Self.Fill
            Fill: =RGBA(214, 27, 27, 1)
            FocusedBorderThickness: =1
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            Height: =44
            HoverBorderColor: =Self.BorderColor
            HoverColor: =Self.Color
            HoverFill: =ColorFade(Self.Fill , -15%)
            OnSelect: |-
                =ClearCollect(listPolicyEmail, listPolicyEmailOld);
                Set(showTableMail, false);
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            PressedBorderColor: =Self.BorderColor
            PressedColor: =Self.Color 
            PressedFill: =Self.Fill
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Size: =10.5
            Text: ="Cancel"
            Visible: =showTableMail
            Width: =120
            X: =DetailMLCancelButton_2.X - Self.Width - 10
            Y: =DetailMLCancelButton_2.Y
            ZIndex: =33

        DetailMLCancelButton_2 As button:
            BorderColor: =Self.Color
            BorderThickness: =1
            DisabledFill: =Self.Fill
            Fill: =RGBA(17, 79, 144, 1)
            FocusedBorderThickness: =1
            Font: =Font.Arial
            FontWeight: =FontWeight.Normal
            Height: =44
            HoverBorderColor: =Self.BorderColor
            HoverColor: =Self.Color
            HoverFill: =ColorFade(Self.Fill , -15%)
            OnSelect: |-
                =Set(showTableMail, false);
                Set(headerContent, input_content_email_mr.Text);
                Set(bottomConent, input_content_bottom_email_mr.Text);
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            PressedBorderColor: =Self.BorderColor
            PressedColor: =Self.Color 
            PressedFill: =Self.Fill
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Size: =10.5
            Text: ="Update"
            Visible: =showTableMail
            Width: =120
            X: =CreateCRPopupBg_1.X + CreateCRPopupBg_1.Width - Self.Width - If(App.Width > 800, 30, 20)
            Y: =CreateCRPopupBg_1.Y + CreateCRPopupBg_1.Height - Self.Height - 30
            ZIndex: =34

        input_content_email_mr As text:
            BorderColor: =If(IsBlank(Self.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
            BorderThickness: =1
            Default: =headerContent
            FocusedBorderColor: =Self.HoverBorderColor
            FocusedBorderThickness: =1
            Font: =Font.Arial
            Height: =(CreateCRPopupBg_1.Height - 40) / 5 + If(App.Width > 800, 0, If(App.Height > 700, 40, -40))
            HoverFill: =
            LineHeight: =1.5
            MaxLength: =2000
            Mode: =TextMode.MultiLine
            Size: =If(App.Width > 800,10.5,12)
            Visible: =showTableMail
            Width: =CreateCRPopupBg_1.Width - If(App.Width > 800, 70, 55)
            X: =UpdateTable_Title.X
            Y: =UpdateTable_Title.Y + UpdateTable_Title.Height
            ZIndex: =35

        input_content_bottom_email_mr As text:
            BorderColor: =If(IsBlank(Self.Text) && isSubmited, RGBA(214, 27, 27, 1), RGBA(191, 191, 192, 1))
            BorderThickness: =1
            Default: =bottomConent
            FocusedBorderColor: =Self.HoverBorderColor
            FocusedBorderThickness: =1
            Font: =Font.Arial
            Height: =CreateCRPopupBg_1.Height - UpdateTable_Title.Height - input_content_email_mr.Height - Container12_1.Height - DetailMLCancelButton_2.Height - 100
            HoverFill: =
            LineHeight: =1.5
            MaxLength: =2000
            Mode: =TextMode.MultiLine
            Size: =If(App.Width > 800,10.5,12)
            Visible: =showTableMail
            Width: =input_content_email_mr.Width
            X: =Container12_1.X
            Y: =Container12_1.Y + Container12_1.Height + 20
            ZIndex: =36

    Timer2 As timer:
        AutoStart: =true
        Duration: =300
        Font: =Font.Arial
        OnTimerStart: =If(CountRows(marginDetail1.brokerage) > 0, Set(dataRecordTable, marginDetail1.brokerage));
        Repeat: =true
        Visible: =false
        X: =80
        Y: =80
        ZIndex: =60

